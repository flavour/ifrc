/*
 2013-14 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2014 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
*/
(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c,s){if(!c.jstree){var C=0,m=!1,p=!1,r=!1,y=[],u=c("script:last").attr("src"),t=document,w=t.createElement("LI"),z;w.setAttribute("role","treeitem");z=t.createElement("I");z.className="jstree-icon jstree-ocl";w.appendChild(z);z=t.createElement("A");z.className="jstree-anchor";z.setAttribute("href","#");t=t.createElement("I");t.className="jstree-icon jstree-themeicon";
z.appendChild(t);w.appendChild(z);z=t=null;c.jstree={version:"3.0.3",defaults:{plugins:[]},plugins:{},path:u&&-1!==u.indexOf("/")?u.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g};c.jstree.create=function(a,b){var e=new c.jstree.core(++C),d=b;b=c.extend(!0,{},c.jstree.defaults,b);d&&d.plugins&&(b.plugins=d.plugins);c.each(b.plugins,function(a,d){"core"!==a&&(e=e.plugin(d,b[d]))});e.init(a,b);return e};c.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data=
{core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[]}}};c.jstree.reference=function(a){var b=null,e=null;a&&a.id&&(a=a.id);if(!e||!e.length)try{e=c(a)}catch(d){}if(!e||!e.length)try{e=c("#"+a.replace(c.jstree.idregex,"\\$&"))}catch(g){}e&&e.length&&(e=e.closest(".jstree")).length&&(e=e.data("jstree"))?b=e:c(".jstree").each(function(){var e=c(this).data("jstree");if(e&&e._model.data[a])return b=e,!1});return b};c.fn.jstree=function(a){var b="string"===typeof a,
e=Array.prototype.slice.call(arguments,1),d=null;this.each(function(){var g=c.jstree.reference(this),f=b&&g?g[a]:null;d=b&&f?f.apply(g,e):null;g||b||a!==s&&!c.isPlainObject(a)||c(this).data("jstree",new c.jstree.create(this,a));if(g&&!b||!0===a)d=g||!1;if(null!==d&&d!==s)return!1});return null!==d&&d!==s?d:this};c.expr[":"].jstree=c.expr.createPseudo(function(a){return function(a){return c(a).hasClass("jstree")&&c(a).data("jstree")!==s}});c.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,
error:c.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1};c.jstree.core.prototype={plugin:function(a,b){var e=c.jstree.plugins[a];return e?(this._data[a]={},e.prototype=this,new e(b,this)):this},init:function(a,b){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,
opened:!1,selected:!1,disabled:!1}};this.element=c(a).addClass("jstree jstree-"+this._id);this.settings=b;this.element.bind("destroyed",c.proxy(this.teardown,this));this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===
this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24;this.trigger("loading");this.load_node("#")},
destroy:function(a){a||this.element.empty();this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=
window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}}).on("click.jstree",".jstree-ocl",c.proxy(function(a){this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",c.proxy(function(a){a.preventDefault();c(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",c.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var b=null;switch(a.which){case 13:case 32:a.type="click";c(a.currentTarget).trigger(a);break;case 37:a.preventDefault();
this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 38:a.preventDefault();(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();
break;case 40:a.preventDefault();(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 46:a.preventDefault();(b=this.get_node(a.currentTarget))&&b.id&&"#"!==b.id&&(b=this.is_selected(b)?this.get_selected():b);break;case 113:a.preventDefault(),b=this.get_node(a.currentTarget)}},this)).on("load_node.jstree",c.proxy(function(a,b){if(b.status&&("#"!==b.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&
!this.get_container_ul().find(".jstree-loading:eq(0)").length)){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var e=[],d,g;d=0;for(g=this._data.core.selected.length;d<g;d++)e=e.concat(this._model.data[this._data.core.selected[d]].parents);e=c.vakata.array_unique(e);d=0;for(g=e.length;d<g;d++)this.open_node(e[d],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(c.proxy(function(){this.trigger("ready")},
this),0)}},this)).on("init.jstree",c.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",c.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},
this)).on("blur.jstree",".jstree-anchor",c.proxy(function(a){c(a.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",c.proxy(function(a){this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();c(a.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",c.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",c.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");
c(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(a){var b=this.settings.core.strings;return c.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=
a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);var e;try{if(this._model.data[a])a=this._model.data[a];else if(((e=c(a,this.element)).length||(e=c("#"+a.replace(c.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[e.closest(".jstree-node").attr("id")])a=this._model.data[e.closest(".jstree-node").attr("id")];
else if((e=c(a,this.element)).length&&e.hasClass("jstree"))a=this._model.data["#"];else return!1;b&&(a="#"===a.id?this.element:c("#"+a.id.replace(c.jstree.idregex,"\\$&"),this.element));return a}catch(d){return!1}},get_path:function(a,b,e){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;var d,g,f=[];f.push(e?a.id:a.text);d=0;for(g=a.parents.length;d<g;d++)f.push(e?a.parents[d]:this.get_text(a.parents[d]));f=f.reverse().slice(1);return b?f.join(b):f},get_next_dom:function(a,b){var e;
a=this.get_node(a,!0);return a[0]===this.element[0]?(e=this._firstChild(this.get_container_ul()[0]))?c(e):!1:a&&a.length?b?(e=this._nextSibling(a[0]))?c(e):!1:a.hasClass("jstree-open")?(e=this._firstChild(a.children(".jstree-children")[0]))?c(e):!1:null!==(e=this._nextSibling(a[0]))?c(e):a.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0):!1},get_prev_dom:function(a,b){var e;a=this.get_node(a,!0);if(a[0]===this.element[0])return(e=this.get_container_ul()[0].lastChild)?c(e):!1;if(!a||
!a.length)return!1;if(b)return(e=this._previousSibling(a[0]))?c(e):!1;if(null!==(e=this._previousSibling(a[0]))){for(a=c(e);a.hasClass("jstree-open");)a=a.children(".jstree-children:eq(0)").children(".jstree-node:last");return a}return(e=a[0].parentNode.parentNode)&&e.className&&-1!==e.className.indexOf("jstree-node")?c(e):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):
a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},
load_node:function(a,b){var e,d,g,f,h;if(c.isArray(a))return this._load_nodes(a.slice(),b),!0;a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;e=0;for(d=a.children_d.length;e<d;e++){g=0;for(f=a.parents.length;g<f;g++)this._model.data[a.parents[g]].children_d=c.vakata.array_remove_item(this._model.data[a.parents[g]].children_d,a.children_d[e]);this._model.data[a.children_d[e]].state.selected&&(h=!0,this._data.core.selected=c.vakata.array_remove_item(this._data.core.selected,
a.children_d[e]));delete this._model.data[a.children_d[e]]}a.children=[];a.children_d=[];h&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading");this._load_node(a,c.proxy(function(e){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=e;var d=this.get_node(a,!0);a.state.loaded&&!a.children.length&&d&&d.length&&!d.hasClass("jstree-leaf")&&d.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");
d.removeClass("jstree-loading");this.trigger("load_node",{node:a,status:e});b&&b.call(this,a,e)},this));return!0},_load_nodes:function(a,b,e){var d=!0,g=function(){this._load_nodes(a,b,!0)},f=this._model.data,c,k;c=0;for(k=a.length;c<k;c++)!f[a[c]]||f[a[c]].state.loaded&&e||(this.is_loading(a[c])||this.load_node(a[c],g),d=!1);d&&b&&!b.done&&(b.call(this,a),b.done=!0)},_load_node:function(a,b){var e=this.settings.core.data;if(!e)return"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0),
function(a){b.call(this,a)}):b.call(this,!1);if(c.isFunction(e))return e.call(this,a,c.proxy(function(e){!1===e&&b.call(this,!1);this["string"===typeof e?"_append_html_data":"_append_json_data"](a,"string"===typeof e?c(e):e,function(a){b.call(this,a)})},this));if("object"===typeof e){if(e.url)return e=c.extend(!0,{},e),c.isFunction(e.url)&&(e.url=e.url.call(this,a)),c.isFunction(e.data)&&(e.data=e.data.call(this,a)),c.ajax(e).done(c.proxy(function(e,g,f){g=f.getResponseHeader("Content-Type");if(-1!==
g.indexOf("json")||"object"===typeof e)return this._append_json_data(a,e,function(a){b.call(this,a)});if(-1!==g.indexOf("html")||"string"===typeof e)return this._append_html_data(a,c(e),function(a){b.call(this,a)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:f})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,!1)},this)).fail(c.proxy(function(e){b.call(this,!1);this._data.core.last_error=
{error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:e})};this.settings.core.error.call(this,this._data.core.last_error)},this));e=c.isArray(e)||c.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e;if("#"===a.id)return this._append_json_data(a,e,function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);
return b.call(this,!1)}if("string"===typeof e){if("#"===a.id)return this._append_html_data(a,c(e),function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,b,e){a=this.get_node(a);a.children=[];a.children_d=
[];b=b.is("ul")?b.children():b;var d=a.id,g=[],f=[],h=this._model.data,k=h[d];a=this._data.core.selected.length;var l,q;b.each(c.proxy(function(a,e){if(l=this._parse_model_from_html(c(e),d,k.parents.concat()))g.push(l),f.push(l),h[l].children_d.length&&(f=f.concat(h[l].children_d))},this));k.children=g;k.children_d=f;b=0;for(q=k.parents.length;b<q;b++)h[k.parents[b]].children_d=h[k.parents[b]].children_d.concat(f);this.trigger("model",{nodes:f,parent:d});"#"!==d?(this._node_changed(d),this.redraw()):
(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});e.call(this,!0)},_append_json_data:function(a,b,e){a=this.get_node(a);a.children=[];a.children_d=[];b.d&&(b=b.d,"string"===typeof b&&(b=JSON.parse(b)));c.isArray(b)||(b=[b]);var d=null,g={df:this._model.default_state,dat:b,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},
f=function(a,e){a.data&&(a=a.data);var d=a.dat,b=a.par,g=[],f=[],c=[],h=a.df,k=a.t_id,m=a.t_cnt,p=a.m,r=p[b],u=a.sel,t,v,s,y=function(a,d,b){b=b?b.concat():[];d&&b.unshift(d);var g=a.id.toString(),f,k,n;d={id:g,text:a.text||"",icon:a.icon!==e?a.icon:!0,parent:d,parents:b,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(d.state[f]=h[f]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(d.icon=a.data.jstree.icon);
if(a&&a.data&&(d.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(d.state[f]=a.data.jstree[f]);if(a&&"object"===typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(d.state[f]=a.state[f]);if(a&&"object"===typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(d.li_attr[f]=a.li_attr[f]);d.li_attr.id||(d.li_attr.id=g);if(a&&"object"===typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(d.a_attr[f]=a.a_attr[f]);a&&a.children&&!0===a.children&&
(d.state.loaded=!1,d.children=[],d.children_d=[]);p[d.id]=d;f=0;for(g=d.children.length;f<g;f++)k=y(p[d.children[f]],d.id,b),n=p[k],d.children_d.push(k),n.children_d.length&&(d.children_d=d.children_d.concat(n.children_d));delete a.data;delete a.children;p[d.id].original=a;d.state.selected&&c.push(d.id);return d.id},w=function(a,d,b){b=b?b.concat():[];d&&b.unshift(d);var g=!1,f,n,l;do g="j"+k+"_"+ ++m;while(p[g]);d={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==e?a.icon:!0,
parent:d,parents:b,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(d.state[f]=h[f]);a&&a.id&&(d.id=a.id.toString());a&&a.text&&(d.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(d.icon=a.data.jstree.icon);if(a&&a.data&&(d.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(d.state[f]=a.data.jstree[f]);if(a&&"object"===typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(d.state[f]=
a.state[f]);if(a&&"object"===typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(d.li_attr[f]=a.li_attr[f]);d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString());d.id||(d.id=g);d.li_attr.id||(d.li_attr.id=d.id);if(a&&"object"===typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(d.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){f=0;for(g=a.children.length;f<g;f++)n=w(a.children[f],d.id,b),l=p[n],d.children.push(n),l.children_d.length&&(d.children_d=d.children_d.concat(l.children_d));
d.children_d=d.children_d.concat(d.children)}a&&a.children&&!0===a.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]);delete a.data;delete a.children;d.original=a;p[d.id]=d;d.state.selected&&c.push(d.id);return d.id};if(d.length&&d[0].id!==e&&d[0].parent!==e){v=0;for(s=d.length;v<s;v++)d[v].children||(d[v].children=[]),p[d[v].id.toString()]=d[v];v=0;for(s=d.length;v<s;v++)p[d[v].parent.toString()].children.push(d[v].id.toString()),r.children_d.push(d[v].id.toString());v=0;for(s=r.children.length;v<
s;v++)t=y(p[r.children[v]],b,r.parents.concat()),f.push(t),p[t].children_d.length&&(f=f.concat(p[t].children_d))}else{v=0;for(s=d.length;v<s;v++)if(t=w(d[v],b,r.parents.concat()))g.push(t),f.push(t),p[t].children_d.length&&(f=f.concat(p[t].children_d));r.children=g;r.children_d=f}v=0;for(s=r.parents.length;v<s;v++)p[r.parents[v]].children_d=p[r.parents[v]].children_d.concat(f);return{cnt:m,mod:p,sel:u,par:b,dpc:f,add:c}},h=function(a,d){this._cnt=a.cnt;this._model.data=a.mod;if(d){var b,g,f=a.add,
h=a.sel,k=this._data.core.selected.slice(),B=this._model.data;if(h.length!==k.length||c.vakata.array_unique(h.concat(k)).length!==h.length){b=0;for(g=h.length;b<g;b++)-1===c.inArray(h[b],f)&&-1===c.inArray(h[b],k)&&(B[h[b]].state.selected=!1);b=0;for(g=k.length;b<g;b++)-1===c.inArray(k[b],h)&&(B[k[b]].state.selected=!0)}}a.add.length&&(this._data.core.selected=this._data.core.selected.concat(a.add));this.trigger("model",{nodes:a.dpc,parent:a.par});"#"!==a.par?(this._node_changed(a.par),this.redraw()):
this.redraw(!0);a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});e.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+f.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),d=new window.Worker(this._wrk),d.onmessage=c.proxy(function(a){h.call(this,a.data,!0);this._data.core.working=!1;this._data.core.worker_queue.length&&
this._append_json_data.apply(this,this._data.core.worker_queue.shift())},this),this._data.core.working?this._data.core.worker_queue.push([a,b,e]):(this._data.core.working=!0,d.postMessage(g))}catch(k){h.call(this,f(g),!1)}else h.call(this,f(g),!1)},_parse_model_from_html:function(a,b,e){e=e?[].concat(e):[];b&&e.unshift(b);var d,g,f=this._model.data,h={id:!1,text:!1,icon:!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},k;for(k in this._model.default_state)this._model.default_state.hasOwnProperty(k)&&
(h.state[k]=this._model.default_state[k]);b=c.vakata.attributes(a,!0);c.each(b,function(a,e){e=c.trim(e);if(!e.length)return!0;h.li_attr[a]=e;"id"===a&&(h.id=e.toString())});b=a.children("a").eq(0);b.length&&(b=c.vakata.attributes(b,!0),c.each(b,function(a,e){e=c.trim(e);e.length&&(h.a_attr[a]=e)}));b=a.children("a:eq(0)").length?a.children("a:eq(0)").clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=c("<div />").html(b);h.text=this.settings.core.force_text?b.text():b.html();b=a.data();
h.data=b?c.extend(!0,{},b):null;h.state.opened=a.hasClass("jstree-open");h.state.selected=a.children("a").hasClass("jstree-clicked");h.state.disabled=a.children("a").hasClass("jstree-disabled");if(h.data&&h.data.jstree)for(k in h.data.jstree)h.data.jstree.hasOwnProperty(k)&&(h.state[k]=h.data.jstree[k]);b=a.children("a").children(".jstree-themeicon");b.length&&(h.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));h.state.icon&&(h.icon=h.state.icon);b=a.children("ul").children("li");do k=
"j"+this._id+"_"+ ++this._cnt;while(f[k]);h.id=h.li_attr.id?h.li_attr.id.toString():k;b.length?(b.each(c.proxy(function(a,b){d=this._parse_model_from_html(c(b),h.id,e);g=this._model.data[d];h.children.push(d);g.children_d.length&&(h.children_d=h.children_d.concat(g.children_d))},this)),h.children_d=h.children_d.concat(h.children)):a.hasClass("jstree-closed")&&(h.state.loaded=!1);h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));h.a_attr["class"]&&
(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));f[h.id]=h;h.state.selected&&this._data.core.selected.push(h.id);return h.id},_parse_model_from_flat_json:function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var d=a.id.toString(),g=this._model.data,f=this._model.default_state,c,k;b={id:d,text:a.text||"",icon:a.icon!==s?a.icon:!0,parent:b,parents:e,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},
original:!1};for(c in f)f.hasOwnProperty(c)&&(b.state[c]=f[c]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(c in a.data.jstree)a.data.jstree.hasOwnProperty(c)&&(b.state[c]=a.data.jstree[c]);if(a&&"object"===typeof a.state)for(c in a.state)a.state.hasOwnProperty(c)&&(b.state[c]=a.state[c]);if(a&&"object"===typeof a.li_attr)for(c in a.li_attr)a.li_attr.hasOwnProperty(c)&&(b.li_attr[c]=a.li_attr[c]);b.li_attr.id||(b.li_attr.id=
d);if(a&&"object"===typeof a.a_attr)for(c in a.a_attr)a.a_attr.hasOwnProperty(c)&&(b.a_attr[c]=a.a_attr[c]);a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);g[b.id]=b;c=0;for(d=b.children.length;c<d;c++)f=this._parse_model_from_flat_json(g[b.children[c]],b.id,e),k=g[f],b.children_d.push(f),k.children_d.length&&(b.children_d=b.children_d.concat(k.children_d));delete a.data;delete a.children;g[b.id].original=a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},
_parse_model_from_json:function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var d=!1,g,f,c,k=this._model.data;f=this._model.default_state;do d="j"+this._id+"_"+ ++this._cnt;while(k[d]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==s?a.icon:!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in f)f.hasOwnProperty(g)&&(b.state[g]=f[g]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&
a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(b.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(b.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(b.li_attr[g]=a.li_attr[g]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=d);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===
typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(b.a_attr[g]=a.a_attr[g]);if(a&&a.children&&a.children.length){g=0;for(d=a.children.length;g<d;g++)f=this._parse_model_from_json(a.children[g],b.id,e),c=k[f],b.children.push(f),c.children_d.length&&(b.children_d=b.children_d.concat(c.children_d));b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;k[b.id]=b;b.state.selected&&
this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),b=document.createElement("UL"),e,d,g;d=0;for(g=a.length;d<g;d++)(e=this.redraw_node(a[d],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&b.appendChild(e);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,this.element.empty().append(b));this._model.force_full_redraw=!1;this._model.changed=
[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},redraw_node:function(a,b,e){var d=this.get_node(a),g=!1,f=!1,h=!1,k=!1,l=!1,q=!1,q="",n=document,x=this._model.data,p=!1,m=!1,r=null;if(!d)return!1;if("#"===d.id)return this.redraw(!0);b=b||0===d.children.length;if(a=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(d.id[0])?"\\3"+d.id[0]+" "+d.id.substr(1).replace(c.jstree.idregex,"\\$&"):d.id.replace(c.jstree.idregex,
"\\$&"))):document.getElementById(d.id))a=c(a),e||(g=a.parent().parent()[0],g===this.element[0]&&(g=null),f=a.index()),b||!d.children.length||a.children(".jstree-children").length||(b=!0),b||(h=a.children(".jstree-children")[0]),m=a.attr("aria-selected"),p=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(b=!0,!e){g="#"!==d.parent?c("#"+d.parent.replace(c.jstree.idregex,"\\$&"),this.element)[0]:null;if(!(null===g||g&&x[d.parent].state.opened))return!1;f=c.inArray(d.id,null===
g?x["#"].children:x[d.parent].children)}a=w.cloneNode(!0);q="jstree-node ";for(k in d.li_attr)d.li_attr.hasOwnProperty(k)&&"id"!==k&&("class"!==k?a.setAttribute(k,d.li_attr[k]):q+=d.li_attr[k]);m&&"false"!==m&&a.setAttribute("aria-selected",!0);d.state.loaded&&!d.children.length?q+=" jstree-leaf":(q+=d.state.opened&&d.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",d.state.opened&&d.state.loaded));null!==d.parent&&x[d.parent].children[x[d.parent].children.length-1]===d.id&&
(q+=" jstree-last");a.id=d.id;a.className=q;q=(d.state.selected?" jstree-clicked":"")+(d.state.disabled?" jstree-disabled":"");for(l in d.a_attr)!d.a_attr.hasOwnProperty(l)||"href"===l&&"#"===d.a_attr[l]||("class"!==l?a.childNodes[1].setAttribute(l,d.a_attr[l]):q+=" "+d.a_attr[l]);q.length&&(a.childNodes[1].className="jstree-anchor "+q);if(d.icon&&!0!==d.icon||!1===d.icon)!1===d.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===d.icon.indexOf("/")&&-1===d.icon.indexOf(".")?
a.childNodes[1].childNodes[0].className+=" "+d.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+d.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");this.settings.core.force_text?a.childNodes[1].appendChild(n.createTextNode(d.text)):a.childNodes[1].innerHTML+=d.text;if(b&&d.children.length&&d.state.opened&&
d.state.loaded){q=n.createElement("UL");q.setAttribute("role","group");q.className="jstree-children";k=0;for(l=d.children.length;k<l;k++)q.appendChild(this.redraw_node(d.children[k],b,!0));a.appendChild(q)}h&&a.appendChild(h);if(!e){g||(g=this.element[0]);k=0;for(l=g.childNodes.length;k<l;k++)if(g.childNodes[k]&&g.childNodes[k].className&&-1!==g.childNodes[k].className.indexOf("jstree-children")){r=g.childNodes[k];break}r||(r=n.createElement("UL"),r.setAttribute("role","group"),r.className="jstree-children",
g.appendChild(r));g=r;f<g.childNodes.length?g.insertBefore(a,g.childNodes[f]):g.appendChild(a);p&&a.childNodes[1].focus()}d.state.opened&&!d.state.loaded&&(d.state.opened=!1,setTimeout(c.proxy(function(){this.open_node(d.id,!1,0)},this),0));return a},open_node:function(a,b,e){var d,g,f;if(c.isArray(a)){a=a.slice();d=0;for(g=a.length;d<g;d++)this.open_node(a[d],b,e);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=e===s?this.settings.core.animation:e;if(!this.is_closed(a))return b&&b.call(this,
a,!1),!1;if(this.is_loaded(a))d=this.get_node(a,!0),f=this,d.length&&(a.children.length&&!this._firstChild(d.children(".jstree-children")[0])&&(a.state.opened=!0,this.redraw_node(a,!0),d=this.get_node(a,!0)),e?(this.trigger("before_open",{node:a}),d.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(e,function(){this.style.display="";f.trigger("after_open",{node:a})})):
(this.trigger("before_open",{node:a}),d[0].className=d[0].className.replace("jstree-closed","jstree-open"),d[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,b&&b.call(this,a,!0),d.length||this.trigger("before_open",{node:a}),this.trigger("open_node",{node:a}),e&&d.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(c.proxy(function(){this.open_node(a,b,e)},this),500);this.load_node(a,function(a,d){return d?this.open_node(a,b,e):b?b.call(this,a,!1):!1})}},
_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,e,d=a.parents;b=0;for(e=d.length;b<e;b+=1)"#"!==b&&this.open_node(d[b],!1,0);return c("#"+a.id.replace(c.jstree.idregex,"\\$&"),this.element)},close_node:function(a,b){var e,d,g,f;if(c.isArray(a)){a=a.slice();e=0;for(d=a.length;e<d;e++)this.close_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;b=b===s?this.settings.core.animation:b;g=this;f=this.get_node(a,!0);f.length&&(b?f.children(".jstree-children").attr("style",
"display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(b,function(){this.style.display="";f.children(".jstree-children").remove();g.trigger("after_close",{node:a})}):(f[0].className=f[0].className.replace("jstree-open","jstree-closed"),f.attr("aria-expanded",!1).children(".jstree-children").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});b&&f.length||this.trigger("after_close",
{node:a})},toggle_node:function(a){var b,e;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.toggle_node(a[b]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,b,e){a||(a="#");a=this.get_node(a);if(!a)return!1;var d="#"===a.id?this.get_container_ul():this.get_node(a,!0),g,f;if(!d.length){d=0;for(g=a.children_d.length;d<g;d++)this.is_closed(this._model.data[a.children_d[d]])&&(this._model.data[a.children_d[d]].state.opened=
!0);return this.trigger("open_all",{node:a})}e=e||d;f=this;d=this.is_closed(a)?d.find(".jstree-closed").addBack():d.find(".jstree-closed");d.each(function(){f.open_node(this,function(a,d){d&&this.is_parent(a)&&this.open_all(a,b,e)},b||0)});0===e.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(e)})},close_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var e="#"===a.id?this.get_container_ul():this.get_node(a,!0),d=this,g;if(!e.length){e=0;for(g=a.children_d.length;e<
g;e++)this._model.data[a.children_d[e]].state.opened=!1;return this.trigger("close_all",{node:a})}e=this.is_open(a)?e.find(".jstree-open").addBack():e.find(".jstree-open");c(e.get().reverse()).each(function(){d.close_node(this,b||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b,e;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.enable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===
a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:a})},disable_node:function(a){var b,e;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.disable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:a})},activate_node:function(a,b){if(this.is_disabled(a))return!1;
this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==s?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||
this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var e=this.get_node(a).id,d=this._data.core.last_clicked.id,g=this.get_node(this._data.core.last_clicked.parent).children,f=!1,c,k;c=0;for(k=g.length;c<k;c+=1)g[c]===e&&(f=!f),g[c]===d&&(f=!f),f||g[c]===e||g[c]===d?this.select_node(g[c],!1,!1,b):this.deselect_node(g[c],!1,b)}else this.is_selected(a)?this.deselect_node(a,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&
(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),e=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",
{node:this.get_node(a)});setTimeout(function(){e.attr("aria-activedescendant",a[0].id);a.attr("aria-selected",!0)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,e,d){var g,f;if(c.isArray(a)){a=a.slice();g=0;for(f=a.length;g<f;g++)this.select_node(a[g],b,e,d);return!0}a=
this.get_node(a);if(!a||"#"===a.id)return!1;g=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),e||(g=this._open_to(a)),g&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:d}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:d}))},deselect_node:function(a,b,e){var d,g;if(c.isArray(a)){a=a.slice();d=0;for(g=a.length;d<
g;d++)this.deselect_node(a[d],b,e);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;d=this.get_node(a,!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=c.vakata.array_remove_item(this._data.core.selected,a.id),d.length&&d.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:e}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:e}))},select_all:function(a){var b=
this._data.core.selected.concat([]),e,d;this._data.core.selected=this._model.data["#"].children_d.concat();e=0;for(d=this._data.core.selected.length;e<d;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),
e,d;e=0;for(d=this._data.core.selected.length;e<d;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:
!1},get_selected:function(a){return a?c.map(this._data.core.selected,c.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var b=this.get_selected(!0),e={},d,g,f,h;d=0;for(g=b.length;d<g;d++)e[b[d].id]=b[d];d=0;for(g=b.length;d<g;d++)for(f=0,h=b[d].children_d.length;f<h;f++)e[b[d].children_d[f]]&&delete e[b[d].children_d[f]];b=[];for(d in e)e.hasOwnProperty(d)&&b.push(d);return a?c.map(b,c.proxy(function(a){return this.get_node(a)},this)):
b},get_bottom_selected:function(a){var b=this.get_selected(!0),e=[],d,g;d=0;for(g=b.length;d<g;d++)b[d].children.length||e.push(b[d].id);return a?c.map(e,c.proxy(function(a){return this.get_node(a)},this)):e},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&"#"!==b&&(this._model.data[b].state.opened&&a.core.open.push(b),this._model.data[b].state.selected&&a.core.selected.push(b));
return a},set_state:function(a,b){if(a){if(a.core){var e,d,g,f;if(a.core.open){if(!c.isArray(a.core.open))return delete a.core.open,this.set_state(a,b),!1;e=!0;d=!1;g=this;c.each(a.core.open.concat([]),function(f,k){if(d=g.get_node(k))g.is_loaded(k)?(g.is_closed(k)&&g.open_node(k,!1,0),a&&a.core&&a.core.open&&c.vakata.array_remove_item(a.core.open,k)):(g.is_loading(k)||g.open_node(k,c.proxy(function(e,d){!d&&a&&a.core&&a.core.open&&c.vakata.array_remove_item(a.core.open,e.id);this.set_state(a,b)},
g),0),e=!1)});e&&(delete a.core.open,this.set_state(a,b));return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==s&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==s&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected)return f=this,this.deselect_all(),c.each(a.core.selected,function(a,e){f.select_node(e)}),delete a.core.selected,this.set_state(a,b),!1;if(c.isEmptyObject(a.core))return delete a.core,
this.set_state(a,b),!1}return c.isEmptyObject(a)?(a=null,b&&b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,b){this._data.core.state=!0===b?{}:this.get_state();b&&c.isFunction(b)&&(this._data.core.state=b.call(this,this._data.core.state));this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var e=this.get_container_ul()[0].className;a||this.element.html("<ul class='"+e+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+
this.get_string("Loading ...")+"</a></li></ul>");this.load_node("#",function(a,b){b&&(this.get_container_ul()[0].className=e,this.set_state(c.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b=[],e=[];this._data.core.selected.concat([]);e.push(a.id);!0===a.state.opened&&b.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){b.push(this.id)});this._load_nodes(e,
c.proxy(function(e){this.open_node(b,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:a,nodes:e})},this))},set_id:function(a,b){a=this.get_node(a);if(!a||"#"===a.id)return!1;var e,d,g=this._model.data;b=b.toString();g[a.parent].children[c.inArray(a.id,g[a.parent].children)]=b;e=0;for(d=a.parents.length;e<d;e++)g[a.parents[e]].children_d[c.inArray(a.id,g[a.parents[e]].children_d)]=b;e=0;for(d=a.children.length;e<d;e++)g[a.children[e]].parent=b;e=0;for(d=a.children_d.length;e<
d;e++)g[a.children_d[e]].parents[c.inArray(a.id,g[a.children_d[e]].parents)]=b;e=c.inArray(a.id,this._data.core.selected);-1!==e&&(this._data.core.selected[e]=b);(e=this.get_node(a.id,!0))&&e.attr("id",b);delete g[a.id];a.id=b;g[b]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,b){var e,d;if(c.isArray(a)){a=a.slice();e=0;for(d=a.length;e<d;e++)this.set_text(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=b;this.get_node(a,
!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:b});return!0},get_json:function(a,b,e){a=this.get_node(a||"#");if(!a)return!1;b&&b.flat&&!e&&(e=[]);var d={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:a.li_attr,a_attr:a.a_attr,state:{},data:b&&b.no_data?!1:a.data},g,f;b&&b.flat?d.parent=a.parent:d.children=[];if(!b||!b.no_state)for(g in a.state)a.state.hasOwnProperty(g)&&(d.state[g]=a.state[g]);b&&b.no_id&&(delete d.id,d.li_attr&&d.li_attr.id&&delete d.li_attr.id);b&&b.flat&&
"#"!==a.id&&e.push(d);if(!b||!b.no_children)for(g=0,f=a.children.length;g<f;g++)b&&b.flat?this.get_json(a.children[g],b,e):d.children.push(this.get_json(a.children[g],b));return b&&b.flat?e:"#"===a.id?d.children:d},create_node:function(a,b,e,d,g){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;e=e===s?"last":e;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,e,d,!0)});b||(b={text:this.get_string("New node")});b.text===s&&
(b.text=this.get_string("New node"));var f,h,k;"#"===a.id&&("before"===e&&(e="first"),"after"===e&&(e="last"));switch(e){case "before":g=this.get_node(a.parent);e=c.inArray(a.id,g.children);a=g;break;case "after":g=this.get_node(a.parent);e=c.inArray(a.id,g.children)+1;a=g;break;case "inside":case "first":e=0;break;case "last":e=a.children.length;break;default:e||(e=0)}e>a.children.length&&(e=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,e))return this.settings.core.error.call(this,
this._data.core.last_error),!1;!0===b.id&&delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;g=this.get_node(b);f=[];f.push(b);f=f.concat(g.children_d);this.trigger("model",{nodes:f,parent:a.id});a.children_d=a.children_d.concat(f);h=0;for(k=a.parents.length;h<k;h++)this._model.data[a.parents[h]].children_d=this._model.data[a.parents[h]].children_d.concat(f);b=g;g=[];h=0;for(k=a.children.length;h<k;h++)g[h>=e?h+1:h]=a.children[h];g[e]=b.id;a.children=g;this.redraw_node(a,
!0);d&&d.call(this,this.get_node(b));this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:e});return b.id},rename_node:function(a,b){var e,d;if(c.isArray(a)){a=a.slice();e=0;for(d=a.length;e<d;e++)this.rename_node(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;e=a.text;if(!this.check("rename_node",a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:e});return!0},
delete_node:function(a){var b,e,d,g,f,h,k,l;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.delete_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a.parent);e=c.inArray(a.id,b.children);l=!1;if(!this.check("delete_node",a,b,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==e&&(b.children=c.vakata.array_remove(b.children,e));d=a.children_d.concat([]);d.push(a.id);h=0;for(k=d.length;h<k;h++){g=0;for(f=a.parents.length;g<f;g++)e=
c.inArray(d[h],this._model.data[a.parents[g]].children_d),-1!==e&&(this._model.data[a.parents[g]].children_d=c.vakata.array_remove(this._model.data[a.parents[g]].children_d,e));this._model.data[d[h]].state.selected&&(l=!0,e=c.inArray(d[h],this._data.core.selected),-1!==e&&(this._data.core.selected=c.vakata.array_remove(this._data.core.selected,e)))}this.trigger("delete_node",{node:a,parent:b.id});l&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:b.id});
h=0;for(k=d.length;h<k;h++)delete this._model.data[d[h]];this.redraw_node(b,!0);return!0},check:function(a,b,e,d,g){b=b&&b.id?b:this.get_node(b);e=e&&e.id?e:this.get_node(e);var f=a.match(/^move_node|copy_node|create_node$/i)?e:b,h=this.settings.core.check_callback;if(!("move_node"!==a&&"copy_node"!==a||g&&g.is_multi||b.id!==e.id&&c.inArray(b.id,e.children)!==d&&-1===c.inArray(e.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",
data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:e&&e.id?e.id:!1})},!1;f&&f.data&&(f=f.data);return f&&f.functions&&(!1===f.functions[a]||!0===f.functions[a])?(!1===f.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:e&&e.id?e.id:!1})}),f.functions[a]):!1===h||c.isFunction(h)&&!1===h.call(this,a,b,e,d,g)||h&&!1===h[a]?(this._data.core.last_error={error:"check",
plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:e&&e.id?e.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,b,e,d,g){var f,h,k,l,q,n,x,p,m,r;b=this.get_node(b);e=e===s?0:e;if(!b)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,e,d,!0)});if(c.isArray(a)){a=a.reverse().slice();
f=0;for(h=a.length;f<h;f++)this.move_node(a[f],b,e,d,g);return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;f=(a.parent||"#").toString();k=e.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;l=a.instance?a.instance:this._model.data[a.id]?this:c.jstree.reference(a.id);q=!l||!l._id||this._id!==l._id;h=l&&l._id&&f&&l._model.data[f]&&l._model.data[f].children?c.inArray(a.id,l._model.data[f].children):-1;if(q)return this.copy_node(a,b,e,d,g)?(l&&l.delete_node(a),!0):
!1;"#"===k.id&&("before"===e&&(e="first"),"after"===e&&(e="last"));switch(e){case "before":e=c.inArray(b.id,k.children);break;case "after":e=c.inArray(b.id,k.children)+1;break;case "inside":case "first":e=0;break;case "last":e=k.children.length;break;default:e||(e=0)}e>k.children.length&&(e=k.children.length);if(!this.check("move_node",a,k,e,{core:!0,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===k.id){g=
k.children.concat();q=c.inArray(a.id,g);-1!==q&&(g=c.vakata.array_remove(g,q),e>q&&e--);q=[];n=0;for(x=g.length;n<x;n++)q[n>=e?n+1:n]=g[n];q[e]=a.id;k.children=q;this._node_changed(k.id);this.redraw("#"===k.id)}else{q=a.children_d.concat();q.push(a.id);n=0;for(x=a.parents.length;n<x;n++){g=[];r=l._model.data[a.parents[n]].children_d;p=0;for(m=r.length;p<m;p++)-1===c.inArray(r[p],q)&&g.push(r[p]);l._model.data[a.parents[n]].children_d=g}l._model.data[f].children=c.vakata.array_remove_item(l._model.data[f].children,
a.id);n=0;for(x=k.parents.length;n<x;n++)this._model.data[k.parents[n]].children_d=this._model.data[k.parents[n]].children_d.concat(q);g=[];n=0;for(x=k.children.length;n<x;n++)g[n>=e?n+1:n]=k.children[n];g[e]=a.id;k.children=g;k.children_d.push(a.id);k.children_d=k.children_d.concat(a.children_d);a.parent=k.id;q=k.parents.concat();q.unshift(k.id);r=a.parents.length;a.parents=q;q=q.concat();n=0;for(x=a.children_d.length;n<x;n++)this._model.data[a.children_d[n]].parents=this._model.data[a.children_d[n]].parents.slice(0,
-1*r),Array.prototype.push.apply(this._model.data[a.children_d[n]].parents,q);this._node_changed(f);this._node_changed(k.id);this.redraw("#"===f||"#"===k.id)}d&&d.call(this,a,k,e);this.trigger("move_node",{node:a,parent:k.id,position:e,old_parent:f,old_position:h,is_multi:l&&l._id&&l._id!==this._id,is_foreign:!l||!l._id,old_instance:l,new_instance:this});return!0},copy_node:function(a,b,e,d,g){var f,h,k,l,q,n;b=this.get_node(b);e=e===s?0:e;if(!b)return!1;if(!e.toString().match(/^(before|after)$/)&&
!g&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,b,e,d,!0)});if(c.isArray(a)){a=a.reverse().slice();f=0;for(h=a.length;f<h;f++)this.copy_node(a[f],b,e,d,g);return!0}a=a&&a.id?a:this.get_node(a);if(!a||"#"===a.id)return!1;h=(a.parent||"#").toString();q=e.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;n=a.instance?a.instance:this._model.data[a.id]?this:c.jstree.reference(a.id);"#"===q.id&&("before"===e&&(e="first"),"after"===e&&(e="last"));switch(e){case "before":e=
c.inArray(b.id,q.children);break;case "after":e=c.inArray(b.id,q.children)+1;break;case "inside":case "first":e=0;break;case "last":e=q.children.length;break;default:e||(e=0)}e>q.children.length&&(e=q.children.length);if(!this.check("copy_node",a,q,e,{core:!0,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;k=n?n.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!k)return!1;!0===k.id&&delete k.id;k=this._parse_model_from_json(k,
q.id,q.parents.concat());if(!k)return!1;f=this.get_node(k);a&&a.state&&!1===a.state.loaded&&(f.state.loaded=!1);g=[];g.push(k);g=g.concat(f.children_d);this.trigger("model",{nodes:g,parent:q.id});k=0;for(l=q.parents.length;k<l;k++)this._model.data[q.parents[k]].children_d=this._model.data[q.parents[k]].children_d.concat(g);g=[];k=0;for(l=q.children.length;k<l;k++)g[k>=e?k+1:k]=q.children[k];g[e]=f.id;q.children=g;q.children_d.push(f.id);q.children_d=q.children_d.concat(f.children_d);this._node_changed(q.id);
this.redraw("#"===q.id);d&&d.call(this,f,q,e);this.trigger("copy_node",{node:f,original:a,parent:q.id,position:e,old_parent:h,old_position:n&&n._id&&h&&n._model.data[h]&&n._model.data[h].children?c.inArray(a.id,n._model.data[h].children):-1,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id,old_instance:n,new_instance:this});return f.id},cut:function(a){a||(a=this._data.core.selected.concat());c.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],e,d,g;d=0;for(g=a.length;d<g;d++)(e=this.get_node(a[d]))&&
e.id&&"#"!==e.id&&b.push(e);if(!b.length)return!1;m=b;r=this;p="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());c.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],e,d,g;d=0;for(g=a.length;d<g;d++)(e=this.get_node(a[d]))&&e.id&&"#"!==e.id&&b.push(e);if(!b.length)return!1;m=b;r=this;p="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:p,node:m,inst:r}},can_paste:function(){return!1!==p&&!1!==m},paste:function(a,b){a=this.get_node(a);
if(!(a&&p&&p.match(/^(copy_node|move_node)$/)&&m))return!1;this[p](m,a,b)&&this.trigger("paste",{parent:a.id,node:m,mode:p});r=p=m=!1},edit:function(a,b){a=this.get_node(a);if(!a)return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;b="string"===typeof b?b:a.text;this.set_text(a,"");a=this._open_to(a);var e=
this._data.core.rtl,d=this.element.width(),g=a.children(".jstree-anchor"),f=c("<span>"),h=b,k=c("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=c("<input />",{value:h,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:c.proxy(function(){var e=f.children(".jstree-rename-input").val();
""===e&&(e=h);k.remove();f.replaceWith(g);f.remove();this.set_text(a,h);!1===this.rename_node(a,c("<div></div>").text(e)[this.settings.core.force_text?"text":"html"]())&&this.set_text(a,h)},this),keydown:function(a){var e=a.which;27===e&&(this.value=h);27!==e&&13!==e&&37!==e&&38!==e&&39!==e&&40!==e&&32!==e||a.stopImmediatePropagation();if(27===e||13===e)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text("pW"+
this.value).width(),d))},keypress:function(a){if(13===a.which)return!1}}),e={fontFamily:g.css("fontFamily")||"",fontSize:g.css("fontSize")||"",fontWeight:g.css("fontWeight")||"",fontStyle:g.css("fontStyle")||"",fontStretch:g.css("fontStretch")||"",fontVariant:g.css("fontVariant")||"",letterSpacing:g.css("letterSpacing")||"",wordSpacing:g.css("wordSpacing")||""};f.attr("class",g.attr("class")).append(g.contents().clone()).append(l);g.replaceWith(f);k.css(e);l.css(e).width(Math.min(k.text("pW"+l[0].value).width(),
d))[0].select()},set_theme:function(a,b){if(!a)return!1;if(!0===b){var e=this.settings.core.themes.dir;e||(e=c.jstree.path+"/themes");b=e+"/"+a+"/style.css"}b&&-1===c.inArray(b,y)&&(c("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />'),y.push(b));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+
a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=
!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?
this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,b){var e,d;if(c.isArray(a)){a=a.slice();e=0;for(d=a.length;e<d;e++)this.set_icon(a[e],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;
d=a.icon;a.icon=b;e=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?this.hide_icon(a):!0===b?e.removeClass("jstree-themeicon-custom "+d).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?(e.removeClass(d).css("background",""),e.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(e.removeClass(d).css("background",""),e.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b));return!0},
get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var b,e;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.hide_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b,e;if(c.isArray(a)){a=a.slice();b=0;for(e=a.length;b<e;b++)this.show_icon(a[b]);return!0}a=this.get_node(a);if(!a||
"#"===a)return!1;b=this.get_node(a,!0);a.icon=b.length?b.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);b.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return!0}};c.vakata={};c.vakata.attributes=function(a,b){a=c(a)[0];var e=b?{}:[];a&&a.attributes&&c.each(a.attributes,function(a,g){-1===c.inArray(g.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==g.nodeValue&&""!==c.trim(g.nodeValue)&&
(b?e[g.nodeName]=g.nodeValue:e.push(g.nodeName))});return e};c.vakata.array_unique=function(a){var b=[],e,d,g;e=0;for(g=a.length;e<g;e++){for(d=0;d<=e&&a[e]!==a[d];d++);d===e&&b.push(a[e])}return b};c.vakata.array_remove=function(a,b,e){e=a.slice((e||b)+1||a.length);a.length=0>b?a.length+b:b;a.push.apply(a,e);return a};c.vakata.array_remove_item=function(a,b){var e=c.inArray(b,a);return-1!==e?c.vakata.array_remove(a,e):a};var G=document.createElement("I");G.className="jstree-icon jstree-checkbox";
c.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0};c.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",c.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||
this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",c.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",
c.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(c.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",c.proxy(function(a,d){var b=this._model.data,f=d.nodes,c,k;c=0;for(k=f.length;c<k;c++)b[f[c]].state.checked=b[f[c]].original&&b[f[c]].original.state&&b[f[c]].original.state.checked,b[f[c]].state.checked&&this._data.checkbox.selected.push(f[c])},this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||
-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",c.proxy(function(a,d){var b=this._model.data,f=b[d.parent],h=d.nodes,k=[],l,q,n,x,p=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection;if(-1!==p.indexOf("down"))if(f.state[m?"selected":"checked"]){l=0;for(q=h.length;l<q;l++)b[h[l]].state[m?"selected":"checked"]=!0;this._data[m?"core":"checkbox"].selected=this._data[m?"core":"checkbox"].selected.concat(h)}else for(l=0,q=h.length;l<q;l++)if(b[h[l]].state[m?
"selected":"checked"]){n=0;for(x=b[h[l]].children_d.length;n<x;n++)b[b[h[l]].children_d[n]].state[m?"selected":"checked"]=!0;this._data[m?"core":"checkbox"].selected=this._data[m?"core":"checkbox"].selected.concat(b[h[l]].children_d)}if(-1!==p.indexOf("up")){l=0;for(q=f.children_d.length;l<q;l++)b[f.children_d[l]].children.length||k.push(b[f.children_d[l]].parent);k=c.vakata.array_unique(k);n=0;for(x=k.length;n<x;n++)for(f=b[k[n]];f&&"#"!==f.id;){l=h=0;for(q=f.children.length;l<q;l++)h+=b[f.children[l]].state[m?
"selected":"checked"];if(h===q)f.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(f.id),(l=this.get_node(f,!0))&&l.length&&l.children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked");else break;f=this.get_node(f.parent)}}this._data[m?"core":"checkbox"].selected=c.vakata.array_unique(this._data[m?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",c.proxy(function(a,d){var b=d.node,f=this._model.data,
h=this.get_node(b.parent),k=this.get_node(b,!0),l,q,n,m=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==m.indexOf("down"))for(this._data[p?"core":"checkbox"].selected=c.vakata.array_unique(this._data[p?"core":"checkbox"].selected.concat(b.children_d)),l=0,q=b.children_d.length;l<q;l++)n=f[b.children_d[l]],n.state[p?"selected":"checked"]=!0,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==m.indexOf("up"))for(;h&&
"#"!==h.id;){l=b=0;for(q=h.children.length;l<q;l++)b+=f[h.children[l]].state[p?"selected":"checked"];if(b===q)h.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(h.id),(n=this.get_node(h,!0))&&n.length&&n.children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked");else break;h=this.get_node(h.parent)}-1!==m.indexOf("down")&&k.length&&k.find(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked")},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":
"uncheck_all.jstree",c.proxy(function(a,d){var b=this.get_node("#"),f=this._model.data,c,k,l;c=0;for(k=b.children_d.length;c<k;c++)(l=f[b.children_d[c]])&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",c.proxy(function(a,d){var b=d.node,f=this.get_node(b,!0),h,k,l,q=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection;b&&b.original&&b.original.state&&
b.original.state.undetermined&&(b.original.state.undetermined=!1);if(-1!==q.indexOf("down"))for(h=0,k=b.children_d.length;h<k;h++)l=this._model.data[b.children_d[h]],l.state[n?"selected":"checked"]=!1,l&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=!1);if(-1!==q.indexOf("up"))for(h=0,k=b.parents.length;h<k;h++)l=this._model.data[b.parents[h]],l.state[n?"selected":"checked"]=!1,l&&l.original&&l.original.state&&l.original.state.undetermined&&(l.original.state.undetermined=
!1),(l=this.get_node(b.parents[h],!0))&&l.length&&l.children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked");l=[];h=0;for(k=this._data[n?"core":"checkbox"].selected.length;h<k;h++)-1!==q.indexOf("down")&&-1!==c.inArray(this._data[n?"core":"checkbox"].selected[h],b.children_d)||-1!==q.indexOf("up")&&-1!==c.inArray(this._data[n?"core":"checkbox"].selected[h],b.parents)||l.push(this._data[n?"core":"checkbox"].selected[h]);this._data[n?"core":"checkbox"].selected=c.vakata.array_unique(l);
-1!==q.indexOf("down")&&f.length&&f.find(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked")},this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",c.proxy(function(a,d){for(var b=this.get_node(d.parent),f=this._model.data,c,k,l,q=this.settings.checkbox.tie_selection;b&&"#"!==b.id;){c=l=0;for(k=b.children.length;c<k;c++)l+=f[b.children[c]].state[q?"selected":"checked"];if(l===k)b.state[q?"selected":"checked"]=!0,this._data[q?"core":"checkbox"].selected.push(b.id),
(c=this.get_node(b,!0))&&c.length&&c.children(".jstree-anchor").addClass(q?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}},this)).on("move_node.jstree",c.proxy(function(a,d){var b=d.is_multi,f=d.old_parent,h=this.get_node(d.parent),k=this._model.data,l,q,n=this.settings.checkbox.tie_selection;if(!b)for(b=this.get_node(f);b&&"#"!==b.id;){l=f=0;for(q=b.children.length;l<q;l++)f+=k[b.children[l]].state[n?"selected":"checked"];if(f===q)b.state[n?"selected":"checked"]=!0,this._data[n?
"core":"checkbox"].selected.push(b.id),(f=this.get_node(b,!0))&&f.length&&f.children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}for(b=h;b&&"#"!==b.id;){l=f=0;for(q=b.children.length;l<q;l++)f+=k[b.children[l]].state[n?"selected":"checked"];if(f===q)b.state[n?"selected":"checked"]||(b.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(b.id),(f=this.get_node(b,!0))&&f.length&&f.children(".jstree-anchor").addClass(n?
"jstree-clicked":"jstree-checked"));else if(b.state[n?"selected":"checked"])b.state[n?"selected":"checked"]=!1,this._data[n?"core":"checkbox"].selected=c.vakata.array_remove_item(this._data[n?"core":"checkbox"].selected,b.id),(f=this.get_node(b,!0))&&f.length&&f.children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}},this))};this._undetermined=function(){var a,b,g=this._model.data,f=this.settings.checkbox.tie_selection,h=this._data[f?"core":
"checkbox"].selected,k=[],l=this;a=0;for(b=h.length;a<b;a++)g[h[a]]&&g[h[a]].parents&&(k=k.concat(g[h[a]].parents));this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var c=l.get_node(this),f;if(c.state.loaded)for(a=0,b=c.children_d.length;a<b;a++)f=g[c.children_d[a]],!f.state.loaded&&f.original&&f.original.state&&f.original.state.undetermined&&!0===f.original.state.undetermined&&(k.push(f.id),k=k.concat(f.parents));else c.original&&c.original.state&&c.original.state.undetermined&&
!0===c.original.state.undetermined&&(k.push(c.id),k=k.concat(c.parents))});k=c.vakata.array_unique(k);k=c.vakata.array_remove_item(k,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");a=0;for(b=k.length;a<b;a++)g[k[a]].state[f?"selected":"checked"]||(h=this.get_node(k[a],!0))&&h.length&&h.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,d,g){if(a=b.redraw_node.call(this,a,d,g)){var f,h=null;d=0;for(f=
a.childNodes.length;d<f;d++)if(a.childNodes[d]&&a.childNodes[d].className&&-1!==a.childNodes[d].className.indexOf("jstree-anchor")){h=a.childNodes[d];break}h&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(h.className+=" jstree-checked"),h.insertBefore(G.cloneNode(!1),h.childNodes[0]))}g||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(c.proxy(this._undetermined,
this),50));return a};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(a){a=this.get_node(a);var b=this.settings.checkbox.cascade,g;g=this.settings.checkbox.tie_selection;
var f=this._data[g?"core":"checkbox"].selected,h=this._model.data;if(!a||!0===a.state[g?"selected":"checked"]||-1===b.indexOf("undetermined")||-1===b.indexOf("down")&&-1===b.indexOf("up"))return!1;if(!a.state.loaded&&!0===a.original.state.undetermined)return!0;b=0;for(g=a.children_d.length;b<g;b++)if(-1!==c.inArray(a.children_d[b],f)||!h[a.children_d[b]].state.loaded&&h[a.children_d[b]].original.state.undetermined)return!0;return!1};this.activate_node=function(a,d){this.settings.checkbox.tie_selection&&
(this.settings.checkbox.whole_node||c(d.target).hasClass("jstree-checkbox"))&&(d.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!c(d.target).hasClass("jstree-checkbox"))return b.activate_node.call(this,a,d);this.is_checked(a)?this.uncheck_node(a,d):this.check_node(a,d);this.trigger("activate_node",{node:this.get_node(a)})};this.check_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,b);var g,f;if(c.isArray(a)){a=a.slice();
g=0;for(f=a.length;g<f;g++)this.check_node(a[g],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;g=this.get_node(a,!0);a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),g&&g.length&&g.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.uncheck_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,b);var g,f;if(c.isArray(a)){a=a.slice();
g=0;for(f=a.length;g<f;g++)this.uncheck_node(a[g],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;g=this.get_node(a,!0);a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=c.vakata.array_remove_item(this._data.checkbox.selected,a.id),g.length&&g.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();
this._data.checkbox.selected.concat([]);var a,b;this._data.checkbox.selected=this._model.data["#"].children_d.concat();a=0;for(b=this._data.checkbox.selected.length;a<b;a++)this._model.data[this._data.checkbox.selected[a]]&&(this._model.data[this._data.checkbox.selected[a]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a=this._data.checkbox.selected.concat([]),
b,c;b=0;for(c=this._data.checkbox.selected.length;b<c;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})};this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a))&&"#"!==a.id?a.state.checked:!1};this.get_checked=
function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?c.map(this._data.checkbox.selected,c.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected};this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var b=this.get_checked(!0),g={},f,h,k,l;f=0;for(h=b.length;f<h;f++)g[b[f].id]=b[f];f=0;for(h=b.length;f<h;f++)for(k=0,l=b[f].children_d.length;k<l;k++)g[b[f].children_d[k]]&&delete g[b[f].children_d[k]];
b=[];for(f in g)g.hasOwnProperty(f)&&b.push(f);return a?c.map(b,c.proxy(function(a){return this.get_node(a)},this)):b};this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var b=this.get_checked(!0),g=[],f,h;f=0;for(h=b.length;f<h;f++)b[f].children.length||g.push(b[f].id);return a?c.map(g,c.proxy(function(a){return this.get_node(a)},this)):g}};c.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,
separator_after:!0,_disabled:!1,label:"Create",action:function(a){var b=c.jstree.reference(a.reference);a=b.get_node(a.reference);b.create_node(a,{},"last",function(a){setTimeout(function(){b.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var b=c.jstree.reference(a.reference);a=b.get_node(a.reference);b.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var b=c.jstree.reference(a.reference);
a=b.get_node(a.reference);b.is_selected(a)?b.delete_node(b.get_selected()):b.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){var b=c.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.cut(b.get_selected()):b.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var b=c.jstree.reference(a.reference);a=b.get_node(a.reference);
b.is_selected(a)?b.copy(b.get_selected()):b.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!c.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",action:function(a){var b=c.jstree.reference(a.reference);a=b.get_node(a.reference);b.paste(a)}}}}}}};c.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",c.proxy(function(b){b.preventDefault();a=b.ctrlKey?b.timeStamp:
0;this.is_loading(b.currentTarget)||this.show_contextmenu(b.currentTarget,b.pageX,b.pageY,b)},this)).on("click.jstree",".jstree-anchor",c.proxy(function(b){this._data.contextmenu.visible&&(!a||250<b.timeStamp-a)&&c.vakata.context.hide()},this));c(document).on("context_hide.vakata",c.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&c.vakata.context.hide();b.teardown.call(this)};this.show_contextmenu=function(a,b,g,f){a=this.get_node(a);
if(!a||"#"===a.id)return!1;var h=this.settings.contextmenu,k=this.get_node(a,!0).children(".jstree-anchor"),l=!1,l=!1;if(h.show_at_node||b===s||g===s)l=k.offset(),b=l.left,g=l.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,f);l=h.items;c.isFunction(l)&&(l=l.call(this,a,c.proxy(function(c){this._show_contextmenu(a,b,g,c)},this)));c.isPlainObject(l)&&this._show_contextmenu(a,b,g,l)};this._show_contextmenu=function(a,b,g,f){var h=this.get_node(a,
!0).children(".jstree-anchor");c(document).one("context_show.vakata",c.proxy(function(a,b){var e="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";c(b.element).addClass(e)},this));this._data.contextmenu.visible=!0;c.vakata.context.show(h,{x:b,y:g},f);this.trigger("show_contextmenu",{node:a,x:b,y:g})}};(function(a){var b=!1,e=!1,d=!1,c=0,f=0,h=[],k="",l=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:d,
element:e,position:{x:c,y:f}})},_execute:function(b){return(b=h[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d,element:e}))&&b.action?b.action.call(null,{item:b,reference:d,element:e,position:{x:c,y:f}}):!1},_parse:function(b,c){if(!b)return!1;c||(k="",h=[]);var f="",g=!1,l;c&&(f+="<ul>");a.each(b,function(b,c){if(!c)return!0;h.push(c);!g&&c.separator_before&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+
">&#160;</a></li>");g=!1;f+="<li class='"+(c._class||"")+(!0===c._disabled||a.isFunction(c._disabled)&&c._disabled({item:c,reference:d,element:e})?" vakata-contextmenu-disabled ":"")+"' "+(c.shortcut?" data-shortcut='"+c.shortcut+"' ":"")+">";f+="<a href='#' rel='"+(h.length-1)+"'>";a.vakata.context.settings.icons&&(f+="<i ",c.icon&&(f=-1!==c.icon.indexOf("/")||-1!==c.icon.indexOf(".")?f+(" style='background:url(\""+c.icon+"\") center center no-repeat' "):f+(" class='"+c.icon+"' ")),f+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");
f+=(a.isFunction(c.label)?c.label({item:b,reference:d,element:e}):c.label)+(c.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+c.shortcut+'">'+(c.shortcut_label||"")+"</span>":"")+"</a>";c.submenu&&(l=a.vakata.context._parse(c.submenu,!0))&&(f+=l);f+="</li>";c.separator_after&&(f+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",g=!0)});f=f.replace(/<li class\='vakata-context-separator'\><\/li\>$/,
"");c&&(f+="</ul>");c||(k=f,a.vakata.context._trigger("parse"));return 10<f.length?f:!1},_show_submenu:function(e){e=a(e);if(e.length&&e.children("ul").length){var d=e.children("ul"),c=e.offset().left+e.outerWidth(),f=e.offset().top,g=d.width(),h=d.height(),k=a(window).width()+a(window).scrollLeft(),l=a(window).height()+a(window).scrollTop();if(b)e[0>c-(g+10+e.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else e[c+g+10>k?"addClass":"removeClass"]("vakata-context-right");f+h+10>l&&
d.css("bottom","-1px");d.show()}},show:function(q,n,m){var p,r,t,B;e&&e.length&&e.width("");switch(!0){case !n&&!q:return!1;case !!n&&!!q:d=q;c=n.x;f=n.y;break;case !n&&!!q:d=q;n=q.offset();c=n.left+q.outerHeight();f=n.top;break;case !!n&&!q:c=n.x,f=n.y}q&&!m&&a(q).data("vakata_contextmenu")&&(m=a(q).data("vakata_contextmenu"));a.vakata.context._parse(m)&&e.html(k);h.length&&(q=e,m=c,n=f,p=q.width(),r=q.height(),t=a(window).width()+a(window).scrollLeft(),B=a(window).height()+a(window).scrollTop(),
b&&(m-=q.outerWidth(),m<a(window).scrollLeft()+20&&(m=a(window).scrollLeft()+20)),m+p+20>t&&(m=t-(p+20)),n+r+20>B&&(n=B-(r+20)),e.css({left:m,top:n}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),l=!0,a.vakata.context._trigger("show"))},hide:function(){l&&(e.hide().find("ul").hide().end().find(":focus").blur(),l=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a("body").css("direction");var d=!1;e=a("<ul class='vakata-context'></ul>");e.on("mouseenter","li",
function(b){b.stopImmediatePropagation();a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),e.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(b){a.contains(this,b.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",
function(b){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(b){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(b){b.preventDefault();a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){var d=null;switch(b.which){case 13:case 32:b.type=
"mouseup";b.preventDefault();a(b.currentTarget).trigger(b);break;case 37:l&&(e.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:l&&(d=e.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),d.length||(d=e.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),
d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:l&&(e.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:l&&(d=e.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),
d.length||(d=e.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(a){a.preventDefault();a=e.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.mouseup()}).appendTo("body");a(document).on("mousedown",function(b){l&&!a.contains(e[0],
b.target)&&a.vakata.context.hide()}).on("context_show.vakata",function(a,d){e.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&e.addClass("vakata-context-rtl").css("direction","rtl");e.find("ul").hide().end()})})})(c);c.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0};c.jstree.plugins.dnd=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",c.proxy(function(a){var b=
this.get_node(a.target),g=this.is_selected(b)?this.get_selected().length:1;if(b&&b.id&&"#"!==b.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||c.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<g?this.get_selected(!0):[b])))return this.element.trigger("mousedown.jstree"),c.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(b,!0),nodes:1<g?this.get_selected():[b.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+
(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(1<g?g+" "+this.get_string("nodes"):this.get_text(a.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}};c(function(){var a=!1,b=!1,e=!1,d=c('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");c(document).bind("dnd_start.vakata",function(b,e){a=!1}).bind("dnd_move.vakata",function(g,f){e&&clearTimeout(e);if(f&&f.data&&f.data.jstree&&(!f.event.target.id||
"jstree-marker"!==f.event.target.id)){var h=c.jstree.reference(f.event.target),k=!1,l=!1,q=!1,n,m,p,r,t,B,s,A,u,y,w,z,v,D;if(h&&h._data&&h._data.dnd)if(d.attr("class","jstree-"+h.get_theme()+(h.settings.core.themes.responsive?" jstree-dnd-responsive":"")),f.helper.children().attr("class","jstree-"+h.get_theme()+(h.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[f.data.origin&&(f.data.origin.settings.dnd.always_copy||f.data.origin.settings.dnd.copy&&(f.event.metaKey||
f.event.ctrlKey))?"show":"hide"](),f.event.target!==h.element[0]&&f.event.target!==h.get_container_ul()[0]||0!==h.get_container_ul().children().length){if((k=c(f.event.target).closest(".jstree-anchor"))&&k.length&&k.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(l=k.offset(),q=f.event.pageY-l.top,p=k.height(),B=q<p/3?["b","i","a"]:q>p-p/3?["a","i","b"]:q>p/2?["i","a","b"]:["i","b","a"],c.each(B,function(g,q){switch(q){case "b":n=l.left-6;m=l.top;r=h.get_parent(k);t=k.parent().index();
break;case "i":v=h.settings.dnd.inside_pos;D=h.get_node(k.parent());n=l.left-2;m=l.top+p/2+1;r=D.id;t="first"===v?0:"last"===v?D.children.length:Math.min(v,D.children.length);break;case "a":n=l.left-6,m=l.top+p,r=h.get_parent(k),t=k.parent().index()+1}s=!0;A=0;for(u=f.data.nodes.length;A<u;A++)if(y=f.data.origin&&(f.data.origin.settings.dnd.always_copy||f.data.origin.settings.dnd.copy&&(f.event.metaKey||f.event.ctrlKey))?"copy_node":"move_node",w=t,"move_node"===y&&"a"===q&&f.data.origin&&f.data.origin===
h&&r===h.get_parent(f.data.nodes[A])&&(z=h.get_node(r),w>c.inArray(f.data.nodes[A],z.children)&&(w-=1)),s=s&&(h&&h.settings&&h.settings.dnd&&!1===h.settings.dnd.check_while_dragging||h.check(y,f.data.origin&&f.data.origin!==h?f.data.origin.get_node(f.data.nodes[A]):f.data.nodes[A],r,w,{dnd:!0,ref:h.get_node(k.parent()),pos:q,is_multi:f.data.origin&&f.data.origin!==h,is_foreign:!f.data.origin})),!s){h&&h.last_error&&(b=h.last_error());break}if(s)return"i"===q&&k.parent().is(".jstree-closed")&&h.settings.dnd.open_timeout&&
(e=setTimeout(function(a,b){return function(){a.open_node(b)}}(h,k),h.settings.dnd.open_timeout)),a={ins:h,par:r,pos:"i"!==q||"last"!==v||0!==t||h.is_loaded(D)?t:"last"},d.css({left:n+"px",top:m+"px"}).show(),f.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),b={},B=!0,!1}),!0===B))return}else{s=!0;A=0;for(u=f.data.nodes.length;A<u&&(s=s&&h.check(f.data.origin&&(f.data.origin.settings.dnd.always_copy||f.data.origin.settings.dnd.copy&&(f.event.metaKey||f.event.ctrlKey))?
"copy_node":"move_node",f.data.origin&&f.data.origin!==h?f.data.origin.get_node(f.data.nodes[A]):f.data.nodes[A],"#","last",{dnd:!0,ref:h.get_node("#"),pos:"i",is_multi:f.data.origin&&f.data.origin!==h,is_foreign:!f.data.origin}),s);A++);if(s){a={ins:h,par:"#",pos:"last"};d.hide();f.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}a=!1;f.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");d.hide()}}).bind("dnd_scroll.vakata",function(b,
e){e&&e.data&&e.data.jstree&&(d.hide(),a=!1,e.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(g,f){e&&clearTimeout(e);if(f&&f.data&&f.data.jstree){d.hide();var h,k,l=[];if(a){h=0;for(k=f.data.nodes.length;h<k;h++)l[h]=f.data.origin?f.data.origin.get_node(f.data.nodes[h]):f.data.nodes[h],f.data.origin&&(l[h].instance=f.data.origin);a.ins[f.data.origin&&(f.data.origin.settings.dnd.always_copy||f.data.origin.settings.dnd.copy&&(f.event.metaKey||
f.event.ctrlKey))?"copy_node":"move_node"](l,a.par,a.pos)}else h=c(f.event.target).closest(".jstree"),h.length&&b&&b.error&&"check"===b.error&&(h=h.jstree(!0))&&h.settings.core.error.call(this,b)}}).bind("keyup keydown",function(a,b){if((b=c.vakata.dnd._get())&&b.data&&b.data.jstree)b.helper.find(".jstree-copy:eq(0)")[b.data.origin&&(b.data.origin.settings.dnd.always_copy||b.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})});(function(a){var b=!1,e=!1,d=!1,c=!1,f=!1,h=0,k=
!1,l=0,q=0,n=0,m=0,p=!1,r=!1,t=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(b,e){var d=a.vakata.dnd._get();d.event=e;a(document).triggerHandler("dnd_"+b+".vakata",d)},_get:function(){return{data:k,element:b,helper:f}},_clean:function(){f&&f.remove();r&&(clearInterval(r),r=!1);f=c=d=e=b=!1;h=0;k=!1;m=n=q=l=0;t=r=p=!1;a(document).off("mousemove touchmove",a.vakata.dnd.drag);a(document).off("mouseup touchend",
a.vakata.dnd.stop)},_scroll:function(b){if(!p||!n&&!m)return r&&(clearInterval(r),r=!1),!1;if(!r)return r=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===b)return!1;b=p.scrollTop();var e=p.scrollLeft();p.scrollTop(b+m*a.vakata.dnd.settings.scroll_speed);p.scrollLeft(e+n*a.vakata.dnd.settings.scroll_speed);b===p.scrollTop()&&e===p.scrollLeft()||a.vakata.dnd._trigger("scroll",p)},start:function(h,n,m){"touchstart"===h.type&&h.originalEvent&&h.originalEvent.changedTouches&&h.originalEvent.changedTouches[0]&&
(h.pageX=h.originalEvent.changedTouches[0].pageX,h.pageY=h.originalEvent.changedTouches[0].pageY,h.target=document.elementFromPoint(h.originalEvent.changedTouches[0].pageX-window.pageXOffset,h.originalEvent.changedTouches[0].pageY-window.pageYOffset));c&&a.vakata.dnd.stop({});try{h.currentTarget.unselectable="on",h.currentTarget.onselectstart=function(){return!1},h.currentTarget.style&&(h.currentTarget.style.MozUserSelect="none")}catch(p){}l=h.pageX;q=h.pageY;k=n;d=!0;b=h.currentTarget;e=h.target;
t="touchstart"===h.type;!1!==m&&(f=a("<div id='vakata-dnd'></div>").html(m).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).bind("mousemove touchmove",a.vakata.dnd.drag);a(document).bind("mouseup touchend",a.vakata.dnd.stop);return!1},drag:function(b){"touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,
b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(d){if(!c)if(Math.abs(b.pageX-l)>(t?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-q)>(t?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))f&&(f.appendTo("body"),h=f.outerWidth()),c=!0,a.vakata.dnd._trigger("start",b);else return;var e=!1,k=!1,r=!1,s=!1,u=!1,w=k=!1,v=!1,s=e=!1;n=m=
0;p=!1;a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var e=a(this),d=e.offset();this.scrollHeight>this.offsetHeight&&(d.top+e.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(m=1),b.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(m=-1));this.scrollWidth>this.offsetWidth&&(d.left+e.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&
(n=1),b.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(n=-1));if(m||n)return p=a(this),!1});!p&&(e=a(document),k=a(window),r=e.height(),s=k.height(),u=e.width(),k=k.width(),w=e.scrollTop(),v=e.scrollLeft(),r>s&&b.pageY-w<a.vakata.dnd.settings.scroll_proximity&&(m=-1),r>s&&s-(b.pageY-w)<a.vakata.dnd.settings.scroll_proximity&&(m=1),u>k&&b.pageX-v<a.vakata.dnd.settings.scroll_proximity&&(n=-1),u>k&&k-(b.pageX-v)<a.vakata.dnd.settings.scroll_proximity&&(n=1),m||n)&&(p=e);p&&a.vakata.dnd._scroll(!0);
f&&(e=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),s=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),r&&e+25>r&&(e=r-50),u&&s+h>u&&(s=u-(h+2)),f.css({left:s+"px",top:e+"px"}));a.vakata.dnd._trigger("move",b);return!1}},stop:function(b){"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-
window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(c)a.vakata.dnd._trigger("stop",b);else if("touchend"===b.type&&b.target===e){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one("click",function(){d&&clearTimeout(d)})}a.vakata.dnd._clean();return!1}}})(c);c.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};c.jstree.plugins.search=function(a,b){this.bind=
function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=c();this._data.search.res=[];this._data.search.opn=[];this.element.on("before_open.jstree",c.proxy(function(a,b){var g,f,h=this._data.search.res,k=[];g=c();if(h&&h.length&&(this._data.search.dom=c(this.element[0].querySelectorAll("#"+c.map(h,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(c.jstree.idregex,"\\$&"):a.replace(c.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),
this.settings.search.show_only_matches&&this._data.search.res.length)){g=0;for(f=h.length;g<f;g++)k=k.concat(this.get_node(h[g]).parents);k=c.vakata.array_remove_item(c.vakata.array_unique(k),"#");g=k.length?c(this.element[0].querySelectorAll("#"+c.map(k,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(c.jstree.idregex,"\\$&"):a.replace(c.jstree.idregex,"\\$&")}).join(", #"))):c();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");
g=g.add(this._data.search.dom);g.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){c(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this));if(this.settings.search.show_only_matches)this.element.on("search.jstree",function(a,b){b.nodes.length&&(c(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),b.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){c(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",
function(a,b){b.nodes.length&&c(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})};this.search=function(a,b){if(!1===a||""===c.trim(a.toString()))return this.clear_search();a=a.toString();var g=this.settings.search,f=g.ajax?g.ajax:!1,h=null,k=[],l=[];this._data.search.res.length&&this.clear_search();if(!b&&!1!==f){if(c.isFunction(f))return f.call(this,a,c.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(c.isArray(b)?
c.vakata.array_unique(b):[],function(){this.search(a,!0)},!0)},this));f=c.extend({},f);f.data||(f.data={});f.data.str=a;return c.ajax(f).fail(c.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(f)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(c.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(c.isArray(b)?c.vakata.array_unique(b):[],function(){this.search(a,!0)},!0)},
this))}this._data.search.str=a;this._data.search.dom=c();this._data.search.res=[];this._data.search.opn=[];h=new c.vakata.search(a,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy});c.each(this._model.data,function(b,d){d.text&&(g.search_callback&&g.search_callback.call(this,a,d)||!g.search_callback&&h.search(d.text).isMatch)&&(!g.search_leaves_only||d.state.loaded&&0===d.children.length)&&(k.push(b),l=l.concat(d.parents))});k.length&&(l=c.vakata.array_unique(l),this._search_open(l),this._data.search.dom=
c(this.element[0].querySelectorAll("#"+c.map(k,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(c.jstree.idregex,"\\$&"):a.replace(c.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=k,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"));this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");
this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=c()};this._search_open=function(a){var b=this;c.each(a.concat([]),function(g,f){if("#"===f)return!0;try{f=c("#"+f.replace(c.jstree.idregex,"\\$&"),b.element)}catch(h){}f&&f.length&&b.is_closed(f)&&(b._data.search.opn.push(f[0].id),
b.open_node(f,function(){b._search_open(a)},0))})}};(function(a){a.vakata.search=function(a,e,d){d=d||{};!1!==d.fuzzy&&(d.fuzzy=!0);a=d.caseSensitive?a:a.toLowerCase();var c=d.location||0,f=d.distance||100,h=d.threshold||.6,k=a.length,l,q,n,m;32<k&&(d.fuzzy=!1);d.fuzzy&&(l=1<<k-1,q=function(){for(var e={},d=0,d=0;d<k;d++)e[a.charAt(d)]=0;for(d=0;d<k;d++)e[a.charAt(d)]|=1<<k-d-1;return e}(),n=function(a,b){var e=a/k,d=Math.abs(c-b);return f?e+d/f:d?1:e});m=function(e){e=d.caseSensitive?e:e.toLowerCase();
if(a===e||-1!==e.indexOf(a))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var f,m,p=e.length,r=h,s=e.indexOf(a,c),t,u,w=k+p,y,v,x=1,z=[];-1!==s&&(r=Math.min(n(0,s),r),s=e.lastIndexOf(a,c+k),-1!==s&&(r=Math.min(n(0,s),r)));s=-1;for(f=0;f<k;f++){t=0;for(u=w;t<u;)n(f,c+u)<=r?t=u:w=u,u=Math.floor((w-t)/2+t);w=u;t=Math.max(1,c-u+1);m=Math.min(c+u,p)+k;u=Array(m+2);for(u[m+1]=(1<<f)-1;m>=t;m--)if(v=q[e.charAt(m-1)],u[m]=0===f?(u[m+1]<<1|1)&v:(u[m+1]<<1|1)&v|(y[m+1]|y[m])<<1|1|y[m+1],
u[m]&l&&(x=n(f,m-1),x<=r))if(r=x,s=m-1,z.push(s),s>c)t=Math.max(1,2*c-s);else break;if(n(f+1,c)>r)break;y=u}return{isMatch:0<=s,score:x}};return!0===e?{search:m}:m(e)}})(c);c.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};c.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("model.jstree",c.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",c.proxy(function(a,b){this.sort(b.parent||
b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",c.proxy(function(a,b){this.sort(b.parent,!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var g,f;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(c.proxy(this.settings.sort,this)),b))for(g=0,f=a.children_d.length;g<f;g++)this.sort(a.children_d[g],!1)}};var F=!1;c.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",
ttl:!1,filter:!1};c.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);var a=c.proxy(function(){this.element.on(this.settings.state.events,c.proxy(function(){F&&clearTimeout(F);F=setTimeout(c.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",c.proxy(function(b,c){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};
c.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=c.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(b){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);a&&c.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(b,d){d.instance.trigger("restore_state",{state:c.extend(!0,{},a)})}),this.set_state(a),!0):!1};
this.clear_state=function(){return c.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(c);c.jstree.defaults.types={"#":{},"default":{}};c.jstree.plugins.types=function(a,b){this.init=function(a,d){var c,f;if(d&&d.types&&d.types["default"])for(c in d.types)if("default"!==c&&"#"!==c&&d.types.hasOwnProperty(c))for(f in d.types["default"])d.types["default"].hasOwnProperty(f)&&
d.types[c][f]===s&&(d.types[c][f]=d.types["default"][f]);b.init.call(this,a,d);this._model.data["#"].type="#"};this.refresh=function(a,d){b.refresh.call(this,a,d);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",c.proxy(function(a,b){var c=this._model.data,f=b.nodes,h=this.settings.types,k,l,m="default";k=0;for(l=f.length;k<l;k++)m="default",c[f[k]].original&&c[f[k]].original.type&&h[c[f[k]].original.type]&&(m=c[f[k]].original.type),c[f[k]].data&&c[f[k]].data.jstree&&
c[f[k]].data.jstree.type&&h[c[f[k]].data.jstree.type]&&(m=c[f[k]].data.jstree.type),c[f[k]].type=m,!0===c[f[k]].icon&&h[m].icon!==s&&(c[f[k]].icon=h[m].icon);c["#"].type="#"},this));b.bind.call(this)};this.get_json=function(a,d,g){var f=this._model.data,h=d?c.extend(!0,{},d,{no_id:!1}):{},h=b.get_json.call(this,a,h,g);if(!1===h)return!1;if(c.isArray(h))for(a=0,g=h.length;a<g;a++)h[a].type=h[a].id&&f[h[a].id]&&f[h[a].id].type?f[h[a].id].type:"default",d&&d.no_id&&(delete h[a].id,h[a].li_attr&&h[a].li_attr.id&&
delete h[a].li_attr.id);else h.type=h.id&&f[h.id]&&f[h.id].type?f[h.id].type:"default",d&&d.no_id&&(h=this._delete_ids(h));return h};this._delete_ids=function(a){if(c.isArray(a)){for(var b=0,g=a.length;b<g;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.children&&c.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,d,g,f,h){if(!1===b.check.call(this,a,d,g,f,h))return!1;d=d&&d.id?d:this.get_node(d);g=g&&
g.id?g:this.get_node(g);h=d&&d.id?c.jstree.reference(d.id):null;var k,l,m,n;h=h&&h._model&&h._model.data?h._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==a||-1===c.inArray(d.id,g.children)){k=this.get_rules(g);if(k.max_children!==s&&-1!==k.max_children&&k.max_children===g.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&
d.id?d.id:!1,par:g&&g.id?g.id:!1})},!1;if(k.valid_children!==s&&-1!==k.valid_children&&-1===c.inArray(d.type,k.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&d.id?d.id:!1,par:g&&g.id?g.id:!1})},!1;if(h&&d.children_d&&d.parents){m=l=0;for(n=d.children_d.length;m<n;m++)l=Math.max(l,h[d.children_d[m]].parents.length);l=l-d.parents.length+1}if(0>=l||l===s)l=1;do{if(k.max_depth!==
s&&-1!==k.max_depth&&k.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&d.id?d.id:!1,par:g&&g.id?g.id:!1})},!1;g=this.get_node(g.parent);k=this.get_rules(g);l++}while(g)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===s&&(a.max_depth=-1);a.max_children===s&&(a.max_children=-1);a.valid_children===s&&(a.valid_children=-1);
return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?c.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var g,f,h;if(c.isArray(a)){a=a.slice();g=0;for(f=a.length;g<f;g++)this.set_type(a[g],b);return!0}g=this.settings.types;a=this.get_node(a);if(!g[b]||!a)return!1;f=a.type;h=this.get_icon(a);a.type=b;(!0===h||g[f]&&g[f].icon&&h===g[f].icon)&&this.set_icon(a,g[b].icon!==s?g[b].icon:!0);return!0}};c.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,
b){return a+" ("+b+")"}};c.jstree.plugins.unique=function(a,b){this.check=function(a,d,g,f,h){if(!1===b.check.call(this,a,d,g,f,h))return!1;d=d&&d.id?d:this.get_node(d);g=g&&g.id?g:this.get_node(g);if(!g||!g.children)return!0;h="rename_node"===a?f:d.text;var k=[],l=this.settings.unique.case_sensitive,m=this._model.data,n,p;n=0;for(p=g.children.length;n<p;n++)k.push(l?m[g.children[n]].text:m[g.children[n]].text.toLowerCase());l||(h=h.toLowerCase());switch(a){case "rename_node":return n=-1===c.inArray(h,
k)||d.text&&d.text[l?"toString":"toLowerCase"]()===h,n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&d.id?d.id:!1,par:g&&g.id?g.id:!1})}),n;case "create_node":return n=-1===c.inArray(h,k),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&d.id?
d.id:!1,par:g&&g.id?g.id:!1})}),n;case "copy_node":return n=-1===c.inArray(h,k),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:d&&d.id?d.id:!1,par:g&&g.id?g.id:!1})}),n;case "move_node":return n=d.parent===g.id||-1===c.inArray(h,k),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+h+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,
pos:f,obj:d&&d.id?d.id:!1,par:g&&g.id?g.id:!1})}),n}return!0};this.create_node=function(a,d,g,f,h){if(!d||d.text===s){null===a&&(a="#");a=this.get_node(a);if(!a)return b.create_node.call(this,a,d,g,f,h);g=g===s?"last":g;if(!g.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(a))return b.create_node.call(this,a,d,g,f,h);d||(d={});var k,l,m,n,p,r=this._model.data,t=this.settings.unique.case_sensitive,u=this.settings.unique.duplicate;l=k=this.get_string("New node");m=[];n=0;for(p=a.children.length;n<
p;n++)m.push(t?r[a.children[n]].text:r[a.children[n]].text.toLowerCase());for(n=1;-1!==c.inArray(t?l:l.toLowerCase(),m);)l=u.call(this,k,++n).toString();d.text=l}return b.create_node.call(this,a,d,g,f,h)}};var E=document.createElement("DIV");E.setAttribute("unselectable","on");E.className="jstree-wholerow";E.innerHTML="&#160;";c.jstree.plugins.wholerow=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("ready.jstree set_state.jstree",c.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",
c.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",c.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",c.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c=!1,f,h;f=0;for(h=b.selected.length;f<h;f++)(c=this.get_node(b.selected[f],!0))&&c.length&&c.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},
this)).on("open_node.jstree",c.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",c.proxy(function(a,b){this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",c.proxy(function(a){a.preventDefault();var b=c.Event("contextmenu",{metaKey:a.metaKey,
ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});c(a.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(b)},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=c.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});c(a.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(b).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",c.proxy(function(a){a.stopImmediatePropagation();
var b=c.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});c(a.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(b).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",c.proxy(function(a){a.stopImmediatePropagation();this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",c.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&
this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,d,g){if(a=b.redraw_node.call(this,a,d,g))d=E.cloneNode(!0),-1!==c.inArray(a.id,this._data.core.selected)&&(d.className+=" jstree-wholerow-clicked"),a.insertBefore(d,a.childNodes[0]);return a}}}});
(function(c,s){var C=0;c.widget("s3.hierarchicalopts",{options:{selected:null,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",multiple:!0,leafonly:!0,themesFolder:"static/styles/jstree",theme:"default",htmlTitles:!0},_create:function(){var m=c(this.element),p=this.options;this.id=C;C+=1;this._namespace=".hierarchicalopts"+C;this.treeID=m.attr("id")+"-tree";this.input=m.find(".s3-hierarchy-input").first();this.button=c('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');
this.buttonText=c("<span>"+p.noneSelectedText+"</span>").appendTo(this.button);this.noopts=c('<span class="no-options-available">'+p.noOptionsText+"</span>").hide();this.tree=m.find(".s3-hierarchy-tree").first().hide().before(this.noopts).before(this.button).detach().appendTo("body");this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){c.Widget.prototype.destroy.call(this);this._unbindEvents();c(this.button).remove();c(this.noopts).remove();c(this.tree).detach().appendTo(this.element).show()},
refresh:function(){this._unbindEvents();var m=this.options,p=this.tree;if(p.find("li").length){this.noopts.hide();this.button.show();var r=m.selected;if(r){var s=this.treeID;c.each(r,function(){c("#"+s+"-"+this).data("jstree",{selected:!0})})}r=p.find("> ul > li");if(1==r.length){var r=r.first(),u=r.data("jstree");r.data("jstree",c.extend({},u,{opened:!0}))}var r=m.multiple,t=m.leafonly;p.jstree({core:{themes:{url:!0,dir:S3.Ap.concat("/",m.themesFolder,"/"),name:m.theme,icons:!1,stripes:!0},animation:100,
multiple:r,check_callback:!0},checkbox:{three_state:t},plugins:["sort","checkbox"]});m=p.jstree("get_checked");this._updateButtonText(m);if(!r){var p=this.tree,w=jQuery.jstree.reference(p);p.bind("select_node.jstree",function(m,p){var r=c(p.node).attr("id");c(w.get_checked(!0)).each(function(){r!=this.id&&(t&&!w.is_leaf(this)||w.uncheck_node(this))})})}this._bindEvents()}else this.button.hide(),this.noopts.show()},_updateSelectedNodes:function(){var m=this.input.val(),m=m?JSON.parse(m):[],p=this.tree,
r=[],s=[],u=this.options.leafonly,t=p.jstree("get_checked",!0);c(t).each(function(){var m=c(this).attr("id");if(m&&(!u||p.jstree("is_leaf",this))){var t=parseInt(m.split("-").pop());t&&(r.push(t),s.push(m))}});var t=!1,w=c(r).not(m).get();w.length?t=!0:(w=c(m).not(r).get(),w.length&&(t=!0));this.input.val(JSON.stringify(r));this._updateButtonText(s);t&&c(this.element).trigger("select.s3hierarchy");return!0},_updateButtonText:function(m){var p=null,p=this.options;if(numSelected=m?m.length:0)if(1<numSelected)p=
p.selectedText.replace("#",numSelected);else{for(var r=[],s=0;s<numSelected;s++)r.push(c("#"+m[s]+" > a").text().replace(/^\s+|\s+$/g,""));p=r.length?r.join(" "):p.noneSelectedText}else p=p.noneSelectedText;this.buttonText.text(p)},set:function(m){this.tree.jstree("uncheck_all");if(m)for(var p=0,r=m.length;p<r;p++)node=c("#"+this.treeID+"-"+m[p]),this.tree.jstree("check_node",node)},get:function(){var c=this.input.val();return c?JSON.parse(c):[]},reset:function(){this.tree.jstree("uncheck_all");this._updateSelectedNodes()},
openMenu:function(){this._isOpen&&this.closeMenu();var m=c(this.button),p=m.offset();c(this.tree).css({position:"absolute",top:p.top+m.outerHeight(),left:p.left,minWidth:m.outerWidth()-8,"z-index":999999}).show().jstree("set_focus");this._isOpen=!0;m.addClass("ui-state-active");c(this).trigger("open")},closeMenu:function(){c(this.tree).fadeOut(50).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");this._isOpen=!1;c(this.button).removeClass("ui-state-active");
c(this).trigger("close")},addNode:function(m,p,r,s){var u=this.tree,t=this.treeID,w="#";m&&(w=c("#"+t+"-"+m),w.length||(w="#"));p=t+"-"+p;u.jstree("create_node",w,{id:p,text:r,li_attr:{rel:"leaf"}},"last");m&&(w.attr({rel:"parent"}),u.jstree("open_node",w));s&&u.jstree("check_node",c("#"+p))},_bindEvents:function(){var m=this,p=c(this.tree),r=c(this.button),s=this._namespace;p.bind("select_node.jstree",function(c,r){m._updateSelectedNodes();if(m.options.multiple)p.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",
function(){window.setTimeout(function(){m.closeMenu()},100)});else window.setTimeout(function(){m.closeMenu()},100)}).bind("deselect_node.jstree",function(c,p){m._updateSelectedNodes()}).bind("open_node.jstree",function(c,m){var p=m.instance,r=p.get_parent(m.node);r.length&&p.open_node(r,!1,!0)});r.bind("click"+s,function(){m._isOpen?m.closeMenu():m.openMenu()}).bind("keyup"+s,function(c){c.preventDefault();switch(c.keyCode){case 27:case 38:case 37:m.closeMenu();break;case 39:case 40:m.openMenu()}}).bind("mouseenter"+
s,function(){r.hasClass("ui-state-disabled")||c(this).addClass("ui-state-hover")}).bind("mouseleave"+s,function(){c(this).removeClass("ui-state-hover")}).bind("focus"+s,function(){r.hasClass("ui-state-disabled")||c(this).addClass("ui-state-focus")}).bind("blur"+s,function(){c(this).removeClass("ui-state-focus")});c(document).bind("mousedown"+s,function(c){var s=c.target;p.is(s)||r.is(s)||0!==p.has(c.target).length||0!==r.has(c.target).length||m.closeMenu()});return!0},_unbindEvents:function(){var m=
c(this.tree);c(this.button);var p=this._namespace;m.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");c(this.button).unbind(p);c(document).unbind(p);return!0}})})(jQuery);
(function(c,s){var C=0;c.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,addLabel:"Add",addURL:null,themesFolder:"static/styles/jstree",theme:"default",htmlTitles:!0},_create:function(){this.id=C;C+=1},_init:function(){this.tree=c(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){c.Widget.prototype.destroy.call(this)},refresh:function(){var m=
this.tree,p=this.options;this._unbindEvents();var r=m.find("> ul > li");if(1==r.length){var r=r.first(),s=r.data("jstree");r.data("jstree",c.extend({},s,{opened:!0}))}var u=this;m.jstree({core:{themes:{url:!0,dir:S3.Ap.concat("/",p.themesFolder,"/"),name:p.theme,icons:!1,stripes:!0},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(c){return{open:{label:u.options.openLabel,action:function(m){u._openNode(c)},separator_after:!0},edit:{label:u.options.editLabel,action:function(m){u._editNode(c)}},
"delete":{label:u.options.deleteLabel,separator_after:!0,_disabled:!0},add:{label:u.options.addLabel,_disabled:!0}}},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},_openNode:function(c){var p=this.options.openURL;c=c.id;p&&c&&(c=parseInt(c.split("-").pop()))&&(p=p.replace("[id]",c).replace("%5Bid%5D",c),window.location.href=p)},refreshNode:function(m){var p=this.options.ajaxURL,r=m.attr("id");if(p&&r&&(r=parseInt(r.split("-").pop()))){var s=this.tree;c.getJSONS3(p+"?node="+r,
function(c){c.label&&s.jstree("rename_node",m,c.label)})}},_editNode:function(m){var p=this.options.editURL;m=m.id;if(p&&m){var r=parseInt(m.split("-").pop());if(r){p=p.replace("[id]",r).replace("%5Bid%5D",r).split("?")[0];p+="?node="+m+"&hierarchy="+this.options.widgetID;m=S3.uid();var s=c('<iframe id="'+m+'" src='+p+" onload=\"S3.popup_loaded('"+m+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body");s.dialog({close:function(c,m){if(self.parent){var p=
self.parent.$("iframe.ui-dialog-content"),r=p.width();p.width(0);window.setTimeout(function(){p.width(r)},300)}s.remove()},minHeight:480,modal:!0,open:function(m,p){c(".ui-widget-overlay").bind("click",function(){s.dialog("close")})},title:this.options.editTitle,minWidth:320,closeText:""})}}},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);

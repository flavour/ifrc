(function(b,g){function k(a,b,e){var h=A[b.type]||{};if((b.empty||e)&&null==a)return null;if(b.def&&null==a)return b.def;a=h.floor?~~a:parseFloat(a);return null==a||isNaN(a)?b.def:h.mod?(a%=h.mod,0>a?h.mod+a:a):h.min>a?h.min:h.max<a?h.max:a}function d(a){var y=l(),e=y._rgba=[];a=a.toLowerCase();p(J,function(b,B){var d=B.re.exec(a),u=d&&B.parse(d),g=B.space||"rgba",d=D[g].cache;if(u)return u=y[g](u),y[d]=u[d],e=y._rgba=u._rgba,!1});if(0!==e.length)return 0===Math.max.apply(Math,e)&&b.extend(e,F.transparent),
y;if(a=F[a])return a}function G(a,b,e){e=(e+1)%1;return 1>6*e?a+6*(b-a)*e:1>2*e?b:2>3*e?a+(b-a)*(2/3-e)*6:a}var H=/^([\-+])=\s*(\d+\.?\d*)/,J=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],l=b.Color=function(a,y,e,h){return new b.Color.fn.parse(a,y,e,h)},D={rgba:{cache:"_rgba",props:{red:{idx:0,
type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},A={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},N=D.rgba.props,O=l.support={},F,p=b.each;D.hsla.props.alpha=N.alpha;l.fn=l.prototype={constructor:l,parse:function(a,y,e,h){if(a===g)return this._rgba=
[null,null,null,null],this;if(a instanceof b||a.nodeType)a=a instanceof b?a.css(y):b(a).css(y),y=g;var B=this,L=b.type(a),u=this._rgba=[];y!==g&&(a=[a,y,e,h],L="array");if("string"===L)return this.parse(d(a)||F._default);if("array"===L)return p(N,function(b,e){u[e.idx]=k(a[e.idx],e)}),this;if("object"===L)return a instanceof l?p(D,function(b,e){a[e.cache]&&(B[e.cache]=a[e.cache].slice())}):p(D,function(e,b){p(b.props,function(e,c){var f=b.cache;if(!B[f]&&b.to){if(null==a[e]||"alpha"===e)return;B[f]=
b.to(B._rgba)}B[f][c.idx]=k(a[e],c,!0)})}),this},is:function(a){var b=l(a),e=!0,h=this;p(D,function(a,d){var u=b[d.cache],g;u&&(g=h[d.cache]||d.to&&d.to(h._rgba)||[],p(d.props,function(a,b){if(null!=u[b.idx])return e=u[b.idx]===g[b.idx]}));return e});return e},_space:function(){var a=[],b=this;p(D,function(e,h){b[h.cache]&&a.push(e)});return a.pop()},transition:function(a,b){var e=l(a),h=e._space(),d=D[h],g=this[d.cache]||d.to(this._rgba),u=g.slice(),e=e[d.cache];p(d.props,function(a,h){var d=h.idx,
c=g[d],f=e[d],q=A[h.type]||{};null!==f&&(null===c?u[d]=f:(q.mod&&(f-c>q.mod/2?c+=q.mod:c-f>q.mod/2&&(c-=q.mod)),u[h.idx]=k((f-c)*b+c,h)))});return this[h](u)},blend:function(a){if(1===this._rgba[3])return this;var d=this._rgba.slice(),e=d.pop(),h=l(a)._rgba;return l(b.map(d,function(a,b){return(1-e)*h[b]+e*a}))},toRgbaString:function(){var a="rgba(",d=b.map(this._rgba,function(a,b){return null==a?2<b?1:0:a});1===d[3]&&(d.pop(),a="rgb(");return a+d.join(",")+")"},toHslaString:function(){var a="hsla(",
d=b.map(this.hsla(),function(a,b){null==a&&(a=2<b?1:0);b&&3>b&&(a=Math.round(100*a)+"%");return a});1===d[3]&&(d.pop(),a="hsl(");return a+d.join(",")+")"},toHexString:function(a){var d=this._rgba.slice(),e=d.pop();a&&d.push(~~(255*e));return"#"+b.map(d,function(a,b){a=(a||0).toString(16);return 1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}};l.fn.parse.prototype=l.fn;D.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,
null,null,a[3]];var b=a[0]/255,e=a[1]/255,d=a[2]/255;a=a[3];var g=Math.max(b,e,d),l=Math.min(b,e,d),u=g-l,p=g+l,k=.5*p;return[Math.round(l===g?0:b===g?60*(e-d)/u+360:e===g?60*(d-b)/u+120:60*(b-e)/u+240)%360,0===k||1===k?k:.5>=k?u/p:u/(2-p),k,null==a?1:a]};D.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,e=a[1],d=a[2];a=a[3];e=.5>=d?d*(1+e):d+e-d*e;d=2*d-e;return[Math.round(255*G(d,e,b+1/3)),Math.round(255*G(d,e,b)),Math.round(255*G(d,e,b-1/3)),
a]};p(D,function(a,d){var e=d.props,h=d.cache,B=d.to,L=d.from;l.fn[a]=function(a){B&&!this[h]&&(this[h]=B(this._rgba));if(a===g)return this[h].slice();var d=b.type(a),y="array"===d||"object"===d?a:arguments,M=this[h].slice(),c;p(e,function(a,c){var b=y["object"===d?a:c.idx];null==b&&(b=M[c.idx]);M[c.idx]=k(b,c)});return L?(c=l(L(M)),c[h]=M,c):l(M)};p(e,function(d,e){l.fn[d]||(l.fn[d]=function(h){var g=b.type(h),c="alpha"===d?this._hsla?"hsla":"rgba":a,f=this[c](),q=f[e.idx];if("undefined"===g)return q;
"function"===g&&(h=h.call(this,q),g=b.type(h));if(null==h&&e.empty)return this;"string"===g&&(g=H.exec(h))&&(h=q+parseFloat(g[2])*("+"===g[1]?1:-1));f[e.idx]=h;return this[c](f)})})});p("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),function(a,g){b.cssHooks[g]={set:function(a,h){var k,p;if("string"!==b.type(h)||(k=d(h))){h=l(k||h);if(!O.rgba&&1!==h._rgba[3]){p="backgroundColor"===g?a.parentNode:a;do k=b.curCSS(p,"backgroundColor");
while((""===k||"transparent"===k)&&(p=p.parentNode)&&p.style);h=h.blend(k&&"transparent"!==k?k:"_default")}h=h.toRgbaString()}a.style[g]=h}};b.fx.step[g]=function(a){a.colorInit||(a.start=l(a.elem,g),a.end=l(a.end),a.colorInit=!0);b.cssHooks[g].set(a.elem,a.start.transition(a.end,a.pos))}});b(function(){var a=document.createElement("div").style;a.cssText="background-color:rgba(1,1,1,.5)";O.rgba=-1<a.backgroundColor.indexOf("rgba")});F=b.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",
black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",
lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
(function(b){b.Jcrop=function(g,k){function d(a){return Math.round(a)+"px"}function G(a){a=b(a).offset();return[a.left,a.top]}function H(a){return[a.pageX-f[0],a.pageY-f[1]]}function J(a){"object"!==typeof a&&(a={});c=b.extend(c,a);b.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!==typeof c[b]&&(c[b]=function(){})})}function l(c,b,d){f=G(x);R.setCursor("move"===c?c:c+"-resize");if("move"===c)return R.activateHandlers(A(b),a,d);b=z.getFixed();var e=N(c),pa=z.getCorner(N(e));
z.setPressed(z.getCorner(e));z.setCurrent(pa);R.activateHandlers(D(c,b),a,d)}function D(a,b){return function(d){if(c.aspectRatio)switch(a){case "e":d[1]=b.y+1;break;case "w":d[1]=b.y+1;break;case "n":d[0]=b.x+1;break;case "s":d[0]=b.x+1}else switch(a){case "e":d[1]=b.y2;break;case "w":d[1]=b.y2;break;case "n":d[0]=b.x2;break;case "s":d[0]=b.x2}z.setCurrent(d);r.update()}}function A(a){var c=a;ka.watchKeys();return function(a){z.moveOffset([a[0]-c[0],a[1]-c[1]]);c=a;r.update()}}function N(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function O(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;f=G(x);Z=!0;l(a,H(b));b.stopPropagation();b.preventDefault();return!1}}function F(a,c,b){var d=a.width(),e=a.height();d>c&&0<c&&(d=c,e=c/a.width()*a.height());e>b&&0<b&&(e=b,d=b/a.height()*a.width());E=a.width()/d;K=a.height()/e;a.width(d).height(e)}function p(a){return{x:a.x*
E,y:a.y*K,x2:a.x2*E,y2:a.y2*K,w:a.w*E,h:a.h*K}}function a(a){a=z.getFixed();a.w>c.minSelect[0]&&a.h>c.minSelect[1]?(r.enableHandles(),r.done()):r.release();R.setCursor(c.allowSelect?"crosshair":"default")}function y(b){if(c.disabled||!c.allowSelect)return!1;Z=!0;f=G(x);r.disableHandles();R.setCursor("crosshair");var d=H(b);z.setPressed(d);r.update();R.activateHandlers(e,a,"touch"===b.type.substring(0,5));ka.watchKeys();b.stopPropagation();b.preventDefault();return!1}function e(a){z.setCurrent(a);
r.update()}function h(){var a=b("<div></div>").addClass(c.baseClass+"-tracker");U&&a.css({opacity:0,backgroundColor:"white"});return a}function B(a){L([a[0]/E,a[1]/K,a[2]/E,a[3]/K]);c.onSelect.call(P,p(z.getFixed()));r.enableHandles()}function L(a){z.setPressed([a[0],a[1]]);z.setCurrent([a[2],a[3]]);r.update()}function u(){c.disabled=!0;r.disableHandles();r.setCursor("default");R.setCursor("default")}function Y(){c.disabled=!1;M()}function da(a,d,e){d=d||c.bgColor;c.bgFade&&b.fx.step.hasOwnProperty("backgroundColor")&&
c.fadeTime&&!e?a.animate({backgroundColor:d},{queue:!1,duration:c.fadeTime}):a.css("backgroundColor",d)}function M(a){c.allowResize?a?r.enableOnly():r.enableHandles():r.disableHandles();R.setCursor(c.allowSelect?"crosshair":"default");r.setCursor(c.allowMove?"move":"default");c.hasOwnProperty("trueSize")&&(E=c.trueSize[0]/t,K=c.trueSize[1]/v);c.hasOwnProperty("setSelect")&&(B(c.setSelect),r.done(),delete c.setSelect);V.refresh();c.bgColor!=na&&(da(c.shade?V.getShades():T,c.shade?c.shadeColor||c.bgColor:
c.bgColor),na=c.bgColor);ea!=c.bgOpacity&&(ea=c.bgOpacity,c.shade?V.refresh():r.setBgOpacity(ea));fa=c.maxSize[0]||0;ga=c.maxSize[1]||0;ha=c.minSize[0]||0;ia=c.minSize[1]||0;c.hasOwnProperty("outerImage")&&(x.attr("src",c.outerImage),delete c.outerImage);r.refresh()}var c=b.extend({},b.Jcrop.defaults),f,q=navigator.userAgent.toLowerCase(),U=/msie/.test(q),I=/msie [1-6]\./.test(q);"object"!==typeof g&&(g=b(g)[0]);"object"!==typeof k&&(k={});J(k);var q={border:"none",visibility:"visible",margin:0,padding:0,
position:"absolute",top:0,left:0},C=b(g),oa=!0;if("IMG"==g.tagName){if(0!=C[0].width&&0!=C[0].height)C.width(C[0].width),C.height(C[0].height);else{var la=new Image;la.src=C[0].src;C.width(la.width);C.height(la.height)}var x=C.clone().removeAttr("id").css(q).show();x.width(C.width());x.height(C.height());C.after(x).hide()}else x=C.css(q).show(),oa=!1,null===c.shade&&(c.shade=!0);F(x,c.boxWidth,c.boxHeight);var t=x.width(),v=x.height(),T=b("<div />").width(t).height(v).addClass(c.baseClass+"-holder").css({position:"relative",
backgroundColor:c.bgColor}).insertAfter(C).append(x);c.addClass&&T.addClass(c.addClass);var W=b("<div />"),ja=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),aa=b("<div />").width("100%").height("100%").css("zIndex",320),ba=b("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=z.getFixed();c.onDblClick.call(P,a)}).insertBefore(x).append(ja,aa);oa&&(W=b("<img />").attr("src",x.attr("src")).css(q).width(t).height(v),ja.append(W));
I&&ba.css({overflowY:"hidden"});var ca=c.boundary,X=h().width(t+2*ca).height(v+2*ca).css({position:"absolute",top:d(-ca),left:d(-ca),zIndex:290}).mousedown(y),na=c.bgColor,ea=c.bgOpacity,fa,ga,ha,ia,E,K,Z,ma,qa;f=G(x);var Q=function(){function a(){var c={},b=["touchstart","touchmove","touchend"],d=document.createElement("div"),e;try{for(e=0;e<b.length;e++){var f=b[e],f="on"+f,g=f in d;g||(d.setAttribute(f,"return;"),g="function"==typeof d[f]);c[b[e]]=g}return c.touchstart&&c.touchend&&c.touchmove}catch(h){return!1}}
var b;b=!0===c.touchSupport||!1===c.touchSupport?c.touchSupport:a();return{createDragger:function(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;f=G(x);Z=!0;l(a,H(Q.cfilter(b)),!0);b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){return y(Q.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:a,support:b}}(),z=function(){function a(){if(!c.aspectRatio){var b=
g-f,S=h-m;fa&&Math.abs(b)>fa&&(g=0<b?f+fa:f-fa);ga&&Math.abs(S)>ga&&(h=0<S?m+ga:m-ga);ia/K&&Math.abs(S)<ia/K&&(h=0<S?m+ia/K:m-ia/K);ha/E&&Math.abs(b)<ha/E&&(g=0<b?f+ha/E:f-ha/E);0>f&&(g-=f,f-=f);0>m&&(h-=m,m-=m);0>g&&(f-=g,g-=g);0>h&&(m-=h,h-=h);g>t&&(b=g-t,f-=b,g-=b);h>v&&(b=h-v,m-=b,h-=b);f>t&&(b=f-v,h-=b,m-=b);m>v&&(b=m-v,h-=b,m-=b);return e(d(f,m,g,h))}var b=c.aspectRatio,S=c.minSize[0]/E,q=c.maxSize[0]/E,k=g-f,l=h-m,w=Math.abs(k),n=Math.abs(l);0===q&&(q=10*t);w/n<b?(w=h,n*=b,n=0>k?f-n:n+f,0>
n?(n=0,w=Math.abs((n-f)/b),w=0>l?m-w:w+m):n>t&&(n=t,w=Math.abs((n-f)/b),w=0>l?m-w:w+m)):(n=g,w/=b,w=0>l?m-w:m+w,0>w?(w=0,n=Math.abs((w-m)*b),n=0>k?f-n:n+f):w>v&&(w=v,n=Math.abs(w-m)*b,n=0>k?f-n:n+f));n>f?(n-f<S?n=f+S:n-f>q&&(n=f+q),w=w>m?m+(n-f)/b:m-(n-f)/b):n<f&&(f-n<S?n=f-S:f-n>q&&(n=f-q),w=w>m?m+(f-n)/b:m-(f-n)/b);0>n?(f-=n,n=0):n>t&&(f-=n-t,n=t);0>w?(m-=w,w=0):w>v&&(m-=w-v,w=v);return e(d(f,m,n,w))}function b(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>t&&(a[0]=t);a[1]>v&&(a[1]=v);return[Math.round(a[0]),
Math.round(a[1])]}function d(a,b,c,f){var e=a,g=c,h=b,m=f;c<a&&(e=c,g=a);f<b&&(h=f,m=b);return[e,h,g,m]}function e(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var f=0,m=0,g=0,h=0,q,k;return{flipCoords:d,setPressed:function(a){a=b(a);g=f=a[0];h=m=a[1]},setCurrent:function(a){a=b(a);q=a[0]-g;k=a[1]-h;g=a[0];h=a[1]},getOffset:function(){return[q,k]},moveOffset:function(a){var b=a[0];a=a[1];0>f+b&&(b-=b+f);0>m+a&&(a-=a+m);v<h+a&&(a+=v-(h+a));t<g+b&&(b+=t-(g+b));f+=b;g+=b;m+=a;h+=
a},getCorner:function(b){var c=a();switch(b){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:a}}(),V=function(){function a(){return f(z.getFixed())}function f(a){I.top.css({left:d(a.x),width:d(a.w),height:d(a.y)});I.bottom.css({top:d(a.y2),left:d(a.x),width:d(a.w),height:d(v-a.y2)});I.right.css({left:d(a.x2),width:d(t-a.x2)});I.left.css({width:d(a.x)})}function e(){return b("<div />").css({position:"absolute",backgroundColor:c.shadeColor||
c.bgColor}).appendTo(p)}function g(){l||(l=!0,p.insertBefore(x),a(),r.setBgOpacity(1,0,1),W.hide(),h(c.shadeColor||c.bgColor,1),r.isAwake()?q(c.bgOpacity,1):q(1,1))}function h(a,b){da(k(),a,b)}function m(){l&&(p.remove(),W.show(),l=!1,r.isAwake()?r.setBgOpacity(c.bgOpacity,1,1):(r.setBgOpacity(1,1,1),r.disableHandles()),da(T,0,1))}function q(a,b){l&&(c.bgFade&&!b?p.animate({opacity:1-a},{queue:!1,duration:c.fadeTime}):p.css({opacity:1-a}))}function k(){return p.children()}var l=!1,p=b("<div />").css({position:"absolute",
zIndex:240,opacity:0}),I={top:e(),left:e().height(v),right:e().height(v),bottom:e()};return{update:a,updateRaw:f,getShades:k,setBgColor:h,enable:g,disable:m,resize:function(a,b){I.left.css({height:d(b)});I.right.css({height:d(b)})},refresh:function(){c.shade?g():m();r.isAwake()&&q(c.bgOpacity)},opacity:q}}(),r=function(){function a(c,d){var f=b("<div />").mousedown(O(c)).css({cursor:c+"-resize",position:"absolute",zIndex:d}).addClass("ord-"+c);Q.support&&f.bind("touchstart.jcrop",Q.createDragger(c));
aa.append(f);return f}function f(b){var c;for(c=0;c<b.length;c++)a(b[c],t++).addClass("jcrop-dragbar")}function e(a){var d,f;for(f=0;f<a.length;f++){switch(a[f]){case "n":d="hline";break;case "s":d="hline bottom";break;case "e":d="vline right";break;case "w":d="vline"}var g=d,g=b("<div />").css({position:"absolute",opacity:c.borderOpacity}).addClass(c.baseClass+"-"+g);ja.append(g)}}function g(b){var d;for(d=0;d<b.length;d++){var f=c.handleSize,e=a(b[d],t++).css({opacity:c.handleOpacity}).addClass(c.baseClass+
"-handle");f&&e.width(f).height(f)}}function q(){var a=z.getFixed();z.setPressed([a.x,a.y]);z.setCurrent([a.x2,a.y2]);m()}function m(a){if(u)return k(a)}function k(a){var b=z.getFixed(),f=b.h;ba.width(Math.round(b.w)).height(Math.round(f));var f=b.x,e=b.y;c.shade||W.css({top:d(-e),left:d(-f)});ba.css({top:d(e),left:d(f)});c.shade&&V.updateRaw(b);u||(ba.show(),c.shade?V.opacity(ea):l(ea,!0),u=!0);a?c.onSelect.call(P,p(b)):c.onChange.call(P,p(b))}function l(a,b,f){if(u||b)c.bgFade&&!f?x.animate({opacity:a},
{queue:!1,duration:c.fadeTime}):x.css("opacity",a)}function r(){U=!0;if(c.allowResize)return aa.show(),!0}function I(){U=!1;aa.hide()}function v(a){a?(ma=!0,I()):(ma=!1,r())}var u,t=370,U=!1;c.dragEdges&&b.isArray(c.createDragbars)&&f(c.createDragbars);b.isArray(c.createHandles)&&g(c.createHandles);c.drawBorders&&b.isArray(c.createBorders)&&e(c.createBorders);b(document).bind("touchstart.jcrop-ios",function(a){b(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var y=h().mousedown(O("move")).css({cursor:"move",
position:"absolute",zIndex:360});Q.support&&y.bind("touchstart.jcrop",Q.createDragger("move"));ja.append(y);I();return{updateVisible:m,update:k,release:function(){I();ba.hide();c.shade?V.opacity(1):l(1);u=!1;c.onRelease.call(P)},refresh:q,isAwake:function(){return u},setCursor:function(a){y.css("cursor",a)},enableHandles:r,enableOnly:function(){U=!0},showHandles:function(){U&&aa.show()},disableHandles:I,animMode:v,setBgOpacity:l,done:function(){v(!1);q()}}}(),R=function(){function a(b){g(H(b));return!1}
function f(a){a.preventDefault();a.stopPropagation();Z&&(Z=!1,h(H(a)),r.isAwake()&&c.onSelect.call(P,p(z.getFixed())),X.css({zIndex:290}),b(document).unbind(".jcrop"),g=function(){},h=function(){});return!1}function d(a){g(H(Q.cfilter(a)));return!1}function e(a){return f(Q.cfilter(a))}var g=function(){},h=function(){},q=c.trackDocument;q||X.mousemove(a).mouseup(f).mouseout(f);x.before(X);return{activateHandlers:function(c,k,l){Z=!0;g=c;h=k;X.css({zIndex:450});l?b(document).bind("touchmove.jcrop",
d).bind("touchend.jcrop",e):q&&b(document).bind("mousemove.jcrop",a).bind("mouseup.jcrop",f);return!1},setCursor:function(a){X.css("cursor",a)}}}(),ka=function(){function a(b){e.hide()}function f(a,b,d){c.allowMove&&(z.moveOffset([b,d]),r.updateVisible(!0));a.preventDefault();a.stopPropagation()}function d(a){if(a.ctrlKey||a.metaKey)return!0;var b=(qa=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:f(a,-b,0);break;case 39:f(a,b,0);break;case 38:f(a,0,-b);break;case 40:f(a,0,b);break;case 27:c.allowSelect&&
r.release();break;case 9:return!0}return!1}var e=b('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),g=b("<div />").css({position:"absolute",overflow:"hidden"}).append(e);c.keySupport&&(e.keydown(d).blur(a),I||!c.fixedSupport?(e.css({position:"absolute",left:"-20px"}),g.append(e).insertBefore(x)):e.insertBefore(x));return{watchKeys:function(){c.keySupport&&(e.show(),e.focus())}}}();Q.support&&X.bind("touchstart.jcrop",Q.newSelection);aa.hide();M(!0);
var P={setImage:function(a,b){r.release();u();var f=new Image;f.onload=function(){var d=f.height,e=c.boxWidth,g=c.boxHeight;x.width(f.width).height(d);x.attr("src",a);W.attr("src",a);F(x,e,g);t=x.width();v=x.height();W.width(t).height(v);X.width(t+2*ca).height(v+2*ca);T.width(t).height(v);V.resize(t,v);Y();"function"===typeof b&&b.call(P)};f.src=a},animateTo:function(a,b){var f=a[0]/E,d=a[1]/K,e=a[2]/E,g=a[3]/K;if(!ma){var h=z.flipCoords(f,d,e,g),q=z.getFixed(),k=[q.x,q.y,q.x2,q.y2],l=c.animationDelay,
p=h[0]-k[0],I=h[1]-k[1],u=h[2]-k[2],v=h[3]-k[3],t=0,w=c.swingSpeed,f=k[0],d=k[1],e=k[2],g=k[3];r.animMode(!0);var n=function(){return function(){t+=(100-t)/w;k[0]=Math.round(f+t/100*p);k[1]=Math.round(d+t/100*I);k[2]=Math.round(e+t/100*u);k[3]=Math.round(g+t/100*v);99.8<=t&&(t=100);100>t?(L(k),window.setTimeout(n,l)):(r.done(),r.animMode(!1),"function"===typeof b&&b.call(P))}}();window.setTimeout(n,l)}},setSelect:B,setOptions:function(a){J(a);M()},tellSelect:function(){return p(z.getFixed())},tellScaled:function(){return z.getFixed()},
setClass:function(a){T.removeClass().addClass(c.baseClass+"-holder").addClass(a)},disable:u,enable:Y,cancel:function(){r.done();R.activateHandlers(null,null)},release:r.release,destroy:function(){T.remove();C.show();C.css("visibility","visible");b(g).removeData("Jcrop")},focus:ka.watchKeys,getBounds:function(){return[t*E,v*K]},getWidgetSize:function(){return[t,v]},getScaleFactor:function(){return[E,K]},getOptions:function(){return c},ui:{holder:T,selection:ba}};U&&T.bind("selectstart",function(){return!1});
C.data("Jcrop",P);return P};b.fn.Jcrop=function(g,k){var d;this.each(function(){if(b(this).data("Jcrop")){if("api"===g)return b(this).data("Jcrop");b(this).data("Jcrop").setOptions(g)}else"IMG"==this.tagName?b.Jcrop.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});d=b.Jcrop(this,g);b.isFunction(k)&&k.call(d)}):(b(this).css({display:"block",visibility:"hidden"}),d=b.Jcrop(this,g),b.isFunction(k)&&k.call(d))});return this};b.Jcrop.Loader=function(g,k,d){function G(){J.complete?
(H.unbind(".jcloader"),b.isFunction(k)&&k.call(J)):window.setTimeout(G,50)}var H=b(g),J=H[0];H.bind("load.jcloader",G).bind("error.jcloader",function(g){H.unbind(".jcloader");b.isFunction(d)&&d.call(J)});J.complete&&b.isFunction(k)&&(H.unbind(".jcloader"),k.call(J))};b.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),
createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
$(function(){var b="png PNG jpg JPG jpeg JPEG".split(" "),g,k=$(".imagecrop-canvas"),d=k[0];if(void 0!=d){var G=d.width;heightLimit=d.height;toScale=!0;if(0==G||0==heightLimit)toScale=!1,G=heightLimit=600;var H=function(a){a=a.type.split("/");var c=a[0];g=a[a.length-1];if("image"==c&&-1!=$.inArray(g,b))return g="png"==g||"PNG"==g?"png":"jpeg",!0},J,l,D=function(a){a.stopPropagation();a.preventDefault();a.target.className="imagecrop-drag";"dragover"==a.type&&(a.target.className="imagecrop-drag hover")},
A,N,O,F=new Image,p=function(a){var b;F.src=a;F.onload=function(){var c=[G,heightLimit],e=[F.width,F.height];e[0]>c[0]&&(l=c[0]/e[0],e[0]*=l,e[1]*=l);e[1]>c[1]&&(l=c[1]/e[1],e[0]*=l,e[1]*=l);e[0]=Math.floor(e[0]);e[1]=Math.floor(e[1]);N=e;d.width=N[0];d.height=N[1];d.getContext("2d").drawImage(F,0,0,N[0],N[1]);b=d.toDataURL("image/"+g);toScale?$(".imagecrop-data").val(O+";"+b):$(".imagecrop-data").val(O+";"+a);$("#uploaded-image").attr({src:b,style:"display: block"});$("#select-crop-btn").css({display:"inline"});
$("hr").attr({style:"display:block"})}},a=$("#upload-title"),y=$("#upload-container");a.bind("click",function(b){y.slideDown("fast",function(){a.html(i18n.upload_image)})});var e=function(b){A&&A.destroy();setTimeout(function(){y.slideUp("fast",function(){a.html("<a>"+i18n.upload_new_image+"</a>")})},500);var c=new FileReader,d=(b.target.files||b.originalEvent.dataTransfer.files)[0];O=d.name;J=b;"drop"==b.type&&D(b);b=$(".imagecrop-upload");H(d)?(c.onload=function(a){p(a.target.result)},c.readAsDataURL(d)):
alert(i18n.invalid_image+"\n"+i18n.supported_image_formats+": png, jpeg or jpg");b.val("")},h=$("#select-crop-btn"),B=$("#crop-btn"),L=$("#remove-btn"),u=$('input[name="imagecrop-points"]'),Y=function(a){A.release();A.disable();B.css({display:"none"});L.css({display:"none"});h.css({display:"inline"})};h.bind("click",function(a){A.enable();var b=A.getBounds();a=b[0]/2;var c=b[1]/2,d=b[0]/4,b=b[1]/4;A.animateTo([a-d,c-b,a+d,c+b]);h.css({display:"none"});B.css({display:"inline"});L.css({display:"inline"})});
B.bind("click",function(a){var b=$(".jcrop-holder");a=parseInt(b.css("width").split("px")[0]);var c=parseInt(b.css("height").split("px")[0]),b=F.width/a,c=F.height/c;a=u.val().split(",");var e=a[0],h=a[1],l=a[3];a=Math.round((a[2]-e)*b);c=Math.round((l-h)*c);A.destroy();Y(J);k.attr({width:a,height:c});d.getContext("2d").drawImage(F,Math.round(e*b),Math.round(h*b),a,c,0,0,a,c);a=d.toDataURL("image/"+g);p(a)});L.bind("click",Y);var da=function(a){u.val(a.x+","+a.y+","+a.x2+","+a.y2)};$("#uploaded-image").bind("load",
function(a){a=$(this);A&&(A.destroy(),Y(J));a.Jcrop({onChange:da,opacity:.2,bgFade:!0,bgColor:"black",addClass:"jcrop-light"},function(){A=this;A.getBounds();A.ui.selection.addClass("jcrop-selection");A.disable()})});var M=$(".imagecrop-data").attr("value");J=document.createEvent("Event");var c=new Image;c.src=M;c.onload=function(){k.attr({width:c.width,height:c.height});d.getContext("2d").drawImage(c,0,0,c.width,c.height);var a=M.split(".");g=a[a.length-1];"jpg"==g&&(g="jpeg");O="upload."+g;a=d.toDataURL("image/"+
g);p(a)};$(".imagecrop-drag").bind("dragover",D).bind("dragleave",D).bind("drop",e);$(".imagecrop-upload").bind("change",e)}});

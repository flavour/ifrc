/*
 jQuery Color Animations v2.0pre
 http://jquery.org/

 Copyright 2011 John Resig
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(b,h){function l(a,b,e){var d=J[b.type]||{};if((b.empty||e)&&null==a)return null;if(b.def&&null==a)return b.def;a=d.floor?~~a:parseFloat(a);return null==a||isNaN(a)?b.def:d.mod?(a%=d.mod,0>a?d.mod+a:a):d.min>a?d.min:d.max<a?d.max:a}function f(a){var g=m(),e=g._rgba=[];a=a.toLowerCase();A(B,function(d,b){d=(d=b.re.exec(a))&&b.parse(d);var f=b.space||"rgba";b=n[f].cache;if(d)return d=g[f](d),g[b]=d[b],e=g._rgba=d._rgba,!1});if(0!==e.length)return 0===Math.max.apply(Math,e)&&b.extend(e,H.transparent),
g;if(a=H[a])return a}function D(a,b,e){e=(e+1)%1;return 1>6*e?a+6*(b-a)*e:1>2*e?b:2>3*e?a+(b-a)*(2/3-e)*6:a}var E=/^([\-+])=\s*(\d+\.?\d*)/,B=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],m=b.Color=function(a,g,e,d){return new b.Color.fn.parse(a,g,e,d)},n={rgba:{cache:"_rgba",props:{red:{idx:0,
type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},J={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},L=n.rgba.props,G=m.support={},A=b.each;n.hsla.props.alpha=L.alpha;m.fn=m.prototype={constructor:m,parse:function(a,g,e,d){if(a===h)return this._rgba=
[null,null,null,null],this;if(a instanceof b||a.nodeType)a=a instanceof b?a.css(g):b(a).css(g),g=h;var x=this,K=b.type(a),P=this._rgba=[];g!==h&&(a=[a,g,e,d],K="array");if("string"===K)return this.parse(f(a)||H._default);if("array"===K)return A(L,function(b,d){P[d.idx]=l(a[d.idx],d)}),this;if("object"===K)return a instanceof m?A(n,function(b,d){a[d.cache]&&(x[d.cache]=a[d.cache].slice())}):A(n,function(b,d){A(d.props,function(b,c){var e=d.cache;if(!x[e]&&d.to){if(null==a[b]||"alpha"===b)return;x[e]=
d.to(x._rgba)}x[e][c.idx]=l(a[b],c,!0)})}),this},is:function(a){var b=m(a),e=!0,d=this;A(n,function(a,g){var f=b[g.cache];if(f){var x=d[g.cache]||g.to&&g.to(d._rgba)||[];A(g.props,function(a,b){if(null!=f[b.idx])return e=f[b.idx]===x[b.idx]})}return e});return e},_space:function(){var a=[],b=this;A(n,function(e,d){b[d.cache]&&a.push(e)});return a.pop()},transition:function(a,b){var e=m(a);a=e._space();var d=n[a],g=this[d.cache]||d.to(this._rgba),f=g.slice();e=e[d.cache];A(d.props,function(a,d){a=
d.idx;var x=g[a],h=e[a],c=J[d.type]||{};null!==h&&(null===x?f[a]=h:(c.mod&&(h-x>c.mod/2?x+=c.mod:x-h>c.mod/2&&(x-=c.mod)),f[d.idx]=l((h-x)*b+x,d)))});return this[a](f)},blend:function(a){if(1===this._rgba[3])return this;var g=this._rgba.slice(),e=g.pop(),d=m(a)._rgba;return m(b.map(g,function(a,b){return(1-e)*d[b]+e*a}))},toRgbaString:function(){var a="rgba(",g=b.map(this._rgba,function(a,b){return null==a?2<b?1:0:a});1===g[3]&&(g.pop(),a="rgb(");return a+g.join(",")+")"},toHslaString:function(){var a=
"hsla(",g=b.map(this.hsla(),function(a,b){null==a&&(a=2<b?1:0);b&&3>b&&(a=Math.round(100*a)+"%");return a});1===g[3]&&(g.pop(),a="hsl(");return a+g.join(",")+")"},toHexString:function(a){var g=this._rgba.slice(),e=g.pop();a&&g.push(~~(255*e));return"#"+b.map(g,function(a,b){a=(a||0).toString(16);return 1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}};m.fn.parse.prototype=m.fn;n.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,
null,null,a[3]];var b=a[0]/255,e=a[1]/255,d=a[2]/255;a=a[3];var f=Math.max(b,e,d),h=Math.min(b,e,d),m=f-h,n=f+h,l=.5*n;return[Math.round(h===f?0:b===f?60*(e-d)/m+360:e===f?60*(d-b)/m+120:60*(b-e)/m+240)%360,0===l||1===l?l:.5>=l?m/n:m/(2-n),l,null==a?1:a]};n.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,e=a[1],d=a[2];a=a[3];e=.5>=d?d*(1+e):d+e-d*e;d=2*d-e;return[Math.round(255*D(d,e,b+1/3)),Math.round(255*D(d,e,b)),Math.round(255*D(d,e,b-1/3)),
a]};A(n,function(a,f){var e=f.props,d=f.cache,g=f.to,n=f.from;m.fn[a]=function(a){g&&!this[d]&&(this[d]=g(this._rgba));if(a===h)return this[d].slice();var f=b.type(a),x="array"===f||"object"===f?a:arguments,I=this[d].slice();A(e,function(a,c){a=x["object"===f?a:c.idx];null==a&&(a=I[c.idx]);I[c.idx]=l(a,c)});if(n){var c=m(n(I));c[d]=I;return c}return m(I)};A(e,function(d,e){m.fn[d]||(m.fn[d]=function(f){var g=b.type(f),c="alpha"===d?this._hsla?"hsla":"rgba":a,k=this[c](),h=k[e.idx];if("undefined"===
g)return h;"function"===g&&(f=f.call(this,h),g=b.type(f));if(null==f&&e.empty)return this;"string"===g&&(g=E.exec(f))&&(f=h+parseFloat(g[2])*("+"===g[1]?1:-1));k[e.idx]=f;return this[c](k)})})});A("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),function(a,g){b.cssHooks[g]={set:function(a,d){var e;if("string"!==b.type(d)||(e=f(d))){d=m(e||d);if(!G.rgba&&1!==d._rgba[3]){var h="backgroundColor"===g?a.parentNode:a;do e=b.curCSS(h,"backgroundColor");
while((""===e||"transparent"===e)&&(h=h.parentNode)&&h.style);d=d.blend(e&&"transparent"!==e?e:"_default")}d=d.toRgbaString()}a.style[g]=d}};b.fx.step[g]=function(a){a.colorInit||(a.start=m(a.elem,g),a.end=m(a.end),a.colorInit=!0);b.cssHooks[g].set(a.elem,a.start.transition(a.end,a.pos))}});b(function(){var a=document.createElement("div").style;a.cssText="background-color:rgba(1,1,1,.5)";G.rgba=-1<a.backgroundColor.indexOf("rgba")});var H=b.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",
black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",
lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
(function(b){b.Jcrop=function(h,l){function f(a){return Math.round(a)+"px"}function D(a){a=b(a).offset();return[a.left,a.top]}function E(a){return[a.pageX-W[0],a.pageY-W[1]]}function B(a){"object"!==typeof a&&(a={});c=b.extend(c,a);b.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!==typeof c[b]&&(c[b]=function(){})})}function m(c,b,d){W=D(y);O.setCursor("move"===c?c:c+"-resize");if("move"===c)return O.activateHandlers(J(b),a,d);b=z.getFixed();var na=L(c),f=z.getCorner(L(na));
z.setPressed(z.getCorner(na));z.setCurrent(f);O.activateHandlers(n(c,b),a,d)}function n(a,b){return function(d){if(c.aspectRatio)switch(a){case "e":d[1]=b.y+1;break;case "w":d[1]=b.y+1;break;case "n":d[0]=b.x+1;break;case "s":d[0]=b.x+1}else switch(a){case "e":d[1]=b.y2;break;case "w":d[1]=b.y2;break;case "n":d[0]=b.x2;break;case "s":d[0]=b.x2}z.setCurrent(d);t.update()}}function J(a){var c=a;ka.watchKeys();return function(a){z.moveOffset([a[0]-c[0],a[1]-c[1]]);c=a;t.update()}}function L(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function G(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;W=D(y);X=!0;m(a,E(b));b.stopPropagation();b.preventDefault();return!1}}function A(a,c,b){var d=a.width(),f=a.height();d>c&&0<c&&(d=c,f=c/a.width()*a.height());f>b&&0<b&&(f=b,d=b/a.height()*a.width());C=a.width()/d;F=a.height()/f;a.width(d).height(f)}function H(a){return{x:a.x*
C,y:a.y*F,x2:a.x2*C,y2:a.y2*F,w:a.w*C,h:a.h*F}}function a(a){a=z.getFixed();a.w>c.minSelect[0]&&a.h>c.minSelect[1]?(t.enableHandles(),t.done()):t.release();O.setCursor(c.allowSelect?"crosshair":"default")}function g(b){if(c.disabled||!c.allowSelect)return!1;X=!0;W=D(y);t.disableHandles();O.setCursor("crosshair");var d=E(b);z.setPressed(d);t.update();O.activateHandlers(e,a,"touch"===b.type.substring(0,5));ka.watchKeys();b.stopPropagation();b.preventDefault();return!1}function e(a){z.setCurrent(a);
t.update()}function d(){var a=b("<div></div>").addClass(c.baseClass+"-tracker");R&&a.css({opacity:0,backgroundColor:"white"});return a}function x(a){K([a[0]/C,a[1]/F,a[2]/C,a[3]/F]);c.onSelect.call(M,H(z.getFixed()));t.enableHandles()}function K(a){z.setPressed([a[0],a[1]]);z.setCurrent([a[2],a[3]]);t.update()}function P(){c.disabled=!0;t.disableHandles();t.setCursor("default");O.setCursor("default")}function ha(){c.disabled=!1;I()}function V(a,d,f){d=d||c.bgColor;c.bgFade&&b.fx.step.hasOwnProperty("backgroundColor")&&
c.fadeTime&&!f?a.animate({backgroundColor:d},{queue:!1,duration:c.fadeTime}):a.css("backgroundColor",d)}function I(a){c.allowResize?a?t.enableOnly():t.enableHandles():t.disableHandles();O.setCursor(c.allowSelect?"crosshair":"default");t.setCursor(c.allowMove?"move":"default");c.hasOwnProperty("trueSize")&&(C=c.trueSize[0]/r,F=c.trueSize[1]/u);c.hasOwnProperty("setSelect")&&(x(c.setSelect),t.done(),delete c.setSelect);S.refresh();c.bgColor!=oa&&(V(c.shade?S.getShades():Q,c.shade?c.shadeColor||c.bgColor:
c.bgColor),oa=c.bgColor);ba!=c.bgOpacity&&(ba=c.bgOpacity,c.shade?S.refresh():t.setBgOpacity(ba));ca=c.maxSize[0]||0;da=c.maxSize[1]||0;ea=c.minSize[0]||0;fa=c.minSize[1]||0;c.hasOwnProperty("outerImage")&&(y.attr("src",c.outerImage),delete c.outerImage);t.refresh()}var c=b.extend({},b.Jcrop.defaults),k=navigator.userAgent.toLowerCase(),R=/msie/.test(k),pa=/msie [1-6]\./.test(k);"object"!==typeof h&&(h=b(h)[0]);"object"!==typeof l&&(l={});B(l);l={border:"none",visibility:"visible",margin:0,padding:0,
position:"absolute",top:0,left:0};var v=b(h);k=!0;if("IMG"==h.tagName){if(0!=v[0].width&&0!=v[0].height)v.width(v[0].width),v.height(v[0].height);else{var la=new Image;la.src=v[0].src;v.width(la.width);v.height(la.height)}var y=v.clone().removeAttr("id").css(l).show();y.width(v.width());y.height(v.height());v.after(y).hide()}else y=v.css(l).show(),k=!1,null===c.shade&&(c.shade=!0);A(y,c.boxWidth,c.boxHeight);var r=y.width(),u=y.height(),Q=b("<div />").width(r).height(u).addClass(c.baseClass+"-holder").css({position:"relative",
backgroundColor:c.bgColor}).insertAfter(v).append(y);c.addClass&&Q.addClass(c.addClass);var T=b("<div />"),ia=b("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Y=b("<div />").width("100%").height("100%").css("zIndex",320),Z=b("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=z.getFixed();c.onDblClick.call(M,a)}).insertBefore(y).append(ia,Y);k&&(T=b("<img />").attr("src",y.attr("src")).css(l).width(r).height(u),ia.append(T));
pa&&Z.css({overflowY:"hidden"});var aa=c.boundary,U=d().width(r+2*aa).height(u+2*aa).css({position:"absolute",top:f(-aa),left:f(-aa),zIndex:290}).mousedown(g),oa=c.bgColor,ba=c.bgOpacity,ca,da,ea,fa,C,F,X,ma,qa;var W=D(y);var N=function(){function a(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var f=b[d];f="on"+f;var e=f in c;e||(c.setAttribute(f,"return;"),e="function"==typeof c[f]);a[b[d]]=e}return a.touchstart&&a.touchend&&a.touchmove}catch(ra){return!1}}
var b=!0===c.touchSupport||!1===c.touchSupport?c.touchSupport:a();return{createDragger:function(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;W=D(y);X=!0;m(a,E(N.cfilter(b)),!0);b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){return g(N.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:a,support:b}}(),z=function(){function a(){if(!c.aspectRatio){var a=
k-e,b=g-p;ca&&Math.abs(a)>ca&&(k=0<a?e+ca:e-ca);da&&Math.abs(b)>da&&(g=0<b?p+da:p-da);fa/F&&Math.abs(b)<fa/F&&(g=0<b?p+fa/F:p-fa/F);ea/C&&Math.abs(a)<ea/C&&(k=0<a?e+ea/C:e-ea/C);0>e&&(k-=e,e-=e);0>p&&(g-=p,p-=p);0>k&&(e-=k,k-=k);0>g&&(p-=g,g-=g);k>r&&(a=k-r,e-=a,k-=a);g>u&&(a=g-u,p-=a,g-=a);e>r&&(a=e-u,g-=a,p-=a);p>u&&(a=p-u,g-=a,p-=a);return f(d(e,p,k,g))}a=c.aspectRatio;b=c.minSize[0]/C;var h=c.maxSize[0]/C,v=k-e,ja=g-p,w=Math.abs(v),q=Math.abs(ja);0===h&&(h=10*r);w/q<a?(w=g,q*=a,q=0>v?e-q:q+e,
0>q?(q=0,w=Math.abs((q-e)/a),w=0>ja?p-w:w+p):q>r&&(q=r,w=Math.abs((q-e)/a),w=0>ja?p-w:w+p)):(q=k,w/=a,w=0>ja?p-w:p+w,0>w?(w=0,q=Math.abs((w-p)*a),q=0>v?e-q:q+e):w>u&&(w=u,q=Math.abs(w-p)*a,q=0>v?e-q:q+e));q>e?(q-e<b?q=e+b:q-e>h&&(q=e+h),w=w>p?p+(q-e)/a:p-(q-e)/a):q<e&&(e-q<b?q=e-b:e-q>h&&(q=e-h),w=w>p?p+(e-q)/a:p-(e-q)/a);0>q?(e-=q,q=0):q>r&&(e-=q-r,q=r);0>w?(p-=w,w=0):w>u&&(p-=w-u,w=u);return f(d(e,p,q,w))}function b(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>r&&(a[0]=r);a[1]>u&&(a[1]=u);return[Math.round(a[0]),
Math.round(a[1])]}function d(a,b,c,d){var e=a,f=c,k=b,g=d;c<a&&(e=c,f=a);d<b&&(k=d,g=b);return[e,k,f,g]}function f(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var e=0,p=0,k=0,g=0,h,v;return{flipCoords:d,setPressed:function(a){a=b(a);k=e=a[0];g=p=a[1]},setCurrent:function(a){a=b(a);h=a[0]-k;v=a[1]-g;k=a[0];g=a[1]},getOffset:function(){return[h,v]},moveOffset:function(a){var b=a[0];a=a[1];0>e+b&&(b-=b+e);0>p+a&&(a-=a+p);u<g+a&&(a+=u-(g+a));r<k+b&&(b+=r-(k+b));e+=b;k+=b;p+=a;g+=
a},getCorner:function(b){var c=a();switch(b){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:a}}(),S=function(){function a(){return d(z.getFixed())}function d(a){l.top.css({left:f(a.x),width:f(a.w),height:f(a.y)});l.bottom.css({top:f(a.y2),left:f(a.x),width:f(a.w),height:f(u-a.y2)});l.right.css({left:f(a.x2),width:f(r-a.x2)});l.left.css({width:f(a.x)})}function e(){return b("<div />").css({position:"absolute",backgroundColor:c.shadeColor||
c.bgColor}).appendTo(m)}function k(){n||(n=!0,m.insertBefore(y),a(),t.setBgOpacity(1,0,1),T.hide(),g(c.shadeColor||c.bgColor,1),t.isAwake()?h(c.bgOpacity,1):h(1,1))}function g(a,b){V(v(),a,b)}function p(){n&&(m.remove(),T.show(),n=!1,t.isAwake()?t.setBgOpacity(c.bgOpacity,1,1):(t.setBgOpacity(1,1,1),t.disableHandles()),V(Q,0,1))}function h(a,b){n&&(c.bgFade&&!b?m.animate({opacity:1-a},{queue:!1,duration:c.fadeTime}):m.css({opacity:1-a}))}function v(){return m.children()}var n=!1,m=b("<div />").css({position:"absolute",
zIndex:240,opacity:0}),l={top:e(),left:e().height(u),right:e().height(u),bottom:e()};return{update:a,updateRaw:d,getShades:v,setBgColor:g,enable:k,disable:p,resize:function(a,b){l.left.css({height:f(b)});l.right.css({height:f(b)})},refresh:function(){c.shade?k():p();t.isAwake()&&h(c.bgOpacity)},opacity:h}}(),t=function(){function a(a,c){c=b("<div />").mousedown(G(a)).css({cursor:a+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+a);N.support&&c.bind("touchstart.jcrop",N.createDragger(a));
Y.append(c);return c}function e(b){var c;for(c=0;c<b.length;c++)a(b[c],R++).addClass("jcrop-dragbar")}function k(a){var d;for(d=0;d<a.length;d++){switch(a[d]){case "n":var e="hline";break;case "s":e="hline bottom";break;case "e":e="vline right";break;case "w":e="vline"}var f=e;f=b("<div />").css({position:"absolute",opacity:c.borderOpacity}).addClass(c.baseClass+"-"+f);ia.append(f)}}function g(b){var d;for(d=0;d<b.length;d++){var e=c.handleSize,f=a(b[d],R++).css({opacity:c.handleOpacity}).addClass(c.baseClass+
"-handle");e&&f.width(e).height(e)}}function h(){var a=z.getFixed();z.setPressed([a.x,a.y]);z.setCurrent([a.x2,a.y2]);p()}function p(a){if(u)return v(a)}function v(a){var b=z.getFixed(),d=b.h;Z.width(Math.round(b.w)).height(Math.round(d));d=b.x;var e=b.y;c.shade||T.css({top:f(-e),left:f(-d)});Z.css({top:f(e),left:f(d)});c.shade&&S.updateRaw(b);u||(Z.show(),c.shade?S.opacity(ba):m(ba,!0),u=!0);a?c.onSelect.call(M,H(b)):c.onChange.call(M,H(b))}function m(a,b,d){if(u||b)c.bgFade&&!d?y.animate({opacity:a},
{queue:!1,duration:c.fadeTime}):y.css("opacity",a)}function n(){r=!0;if(c.allowResize)return Y.show(),!0}function l(){r=!1;Y.hide()}function t(a){a?(ma=!0,l()):(ma=!1,n())}var u,R=370,r=!1;c.dragEdges&&b.isArray(c.createDragbars)&&e(c.createDragbars);b.isArray(c.createHandles)&&g(c.createHandles);c.drawBorders&&b.isArray(c.createBorders)&&k(c.createBorders);b(document).bind("touchstart.jcrop-ios",function(a){b(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var x=d().mousedown(G("move")).css({cursor:"move",
position:"absolute",zIndex:360});N.support&&x.bind("touchstart.jcrop",N.createDragger("move"));ia.append(x);l();return{updateVisible:p,update:v,release:function(){l();Z.hide();c.shade?S.opacity(1):m(1);u=!1;c.onRelease.call(M)},refresh:h,isAwake:function(){return u},setCursor:function(a){x.css("cursor",a)},enableHandles:n,enableOnly:function(){r=!0},showHandles:function(){r&&Y.show()},disableHandles:l,animMode:t,setBgOpacity:m,done:function(){t(!1);h()}}}(),O=function(){function a(a){k(E(a));return!1}
function d(a){a.preventDefault();a.stopPropagation();X&&(X=!1,g(E(a)),t.isAwake()&&c.onSelect.call(M,H(z.getFixed())),U.css({zIndex:290}),b(document).unbind(".jcrop"),k=function(){},g=function(){});return!1}function e(a){k(E(N.cfilter(a)));return!1}function f(a){return d(N.cfilter(a))}var k=function(){},g=function(){},h=c.trackDocument;h||U.mousemove(a).mouseup(d).mouseout(d);y.before(U);return{activateHandlers:function(c,p,v){X=!0;k=c;g=p;U.css({zIndex:450});v?b(document).bind("touchmove.jcrop",
e).bind("touchend.jcrop",f):h&&b(document).bind("mousemove.jcrop",a).bind("mouseup.jcrop",d);return!1},setCursor:function(a){U.css("cursor",a)}}}(),ka=function(){function a(a){f.hide()}function d(a,b,d){c.allowMove&&(z.moveOffset([b,d]),t.updateVisible(!0));a.preventDefault();a.stopPropagation()}function e(a){if(a.ctrlKey||a.metaKey)return!0;var b=(qa=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:c.allowSelect&&
t.release();break;case 9:return!0}return!1}var f=b('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),k=b("<div />").css({position:"absolute",overflow:"hidden"}).append(f);c.keySupport&&(f.keydown(e).blur(a),pa||!c.fixedSupport?(f.css({position:"absolute",left:"-20px"}),k.append(f).insertBefore(y)):f.insertBefore(y));return{watchKeys:function(){c.keySupport&&(f.show(),f.focus())}}}();N.support&&U.bind("touchstart.jcrop",N.newSelection);Y.hide();I(!0);
var M={setImage:function(a,b){t.release();P();var d=new Image;d.onload=function(){var e=d.height,f=c.boxWidth,k=c.boxHeight;y.width(d.width).height(e);y.attr("src",a);T.attr("src",a);A(y,f,k);r=y.width();u=y.height();T.width(r).height(u);U.width(r+2*aa).height(u+2*aa);Q.width(r).height(u);S.resize(r,u);ha();"function"===typeof b&&b.call(M)};d.src=a},animateTo:function(a,b){var d=a[0]/C,e=a[1]/F,f=a[2]/C,k=a[3]/F;if(!ma){a=z.flipCoords(d,e,f,k);var g=z.getFixed(),h=[g.x,g.y,g.x2,g.y2],v=c.animationDelay,
m=a[0]-h[0],l=a[1]-h[1],n=a[2]-h[2],u=a[3]-h[3],r=0,R=c.swingSpeed;d=h[0];e=h[1];f=h[2];k=h[3];t.animMode(!0);var w=function(){return function(){r+=(100-r)/R;h[0]=Math.round(d+r/100*m);h[1]=Math.round(e+r/100*l);h[2]=Math.round(f+r/100*n);h[3]=Math.round(k+r/100*u);99.8<=r&&(r=100);100>r?(K(h),window.setTimeout(w,v)):(t.done(),t.animMode(!1),"function"===typeof b&&b.call(M))}}();window.setTimeout(w,v)}},setSelect:x,setOptions:function(a){B(a);I()},tellSelect:function(){return H(z.getFixed())},tellScaled:function(){return z.getFixed()},
setClass:function(a){Q.removeClass().addClass(c.baseClass+"-holder").addClass(a)},disable:P,enable:ha,cancel:function(){t.done();O.activateHandlers(null,null)},release:t.release,destroy:function(){Q.remove();v.show();v.css("visibility","visible");b(h).removeData("Jcrop")},focus:ka.watchKeys,getBounds:function(){return[r*C,u*F]},getWidgetSize:function(){return[r,u]},getScaleFactor:function(){return[C,F]},getOptions:function(){return c},ui:{holder:Q,selection:Z}};R&&Q.bind("selectstart",function(){return!1});
v.data("Jcrop",M);return M};b.fn.Jcrop=function(h,l){var f;this.each(function(){if(b(this).data("Jcrop")){if("api"===h)return b(this).data("Jcrop");b(this).data("Jcrop").setOptions(h)}else"IMG"==this.tagName?b.Jcrop.Loader(this,function(){b(this).css({display:"block",visibility:"hidden"});f=b.Jcrop(this,h);b.isFunction(l)&&l.call(f)}):(b(this).css({display:"block",visibility:"hidden"}),f=b.Jcrop(this,h),b.isFunction(l)&&l.call(f))});return this};b.Jcrop.Loader=function(h,l,f){function D(){B.complete?
(E.unbind(".jcloader"),b.isFunction(l)&&l.call(B)):window.setTimeout(D,50)}var E=b(h),B=E[0];E.bind("load.jcloader",D).bind("error.jcloader",function(h){E.unbind(".jcloader");b.isFunction(f)&&f.call(B)});B.complete&&b.isFunction(l)&&(E.unbind(".jcloader"),l.call(B))};b.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),
createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
$(function(){var b="png PNG jpg JPG jpeg JPEG".split(" "),h,l=$(".imagecrop-canvas"),f=l[0];if(void 0!=f){var D=f.width;heightLimit=f.height;toScale=!0;if(0==D||0==heightLimit)toScale=!1,D=heightLimit=600;var E=function(a){a=a.type.split("/");var c=a[0];h=a[a.length-1];if("image"==c&&-1!=$.inArray(h,b))return h="png"==h||"PNG"==h?"png":"jpeg",!0},B,m=function(a){a.stopPropagation();a.preventDefault();a.target.className="imagecrop-drag";"dragover"==a.type&&(a.target.className="imagecrop-drag hover")},
n,J,L,G=new Image,A=function(a){var b;G.src=a;G.onload=function(){var c=[D,heightLimit],d=[G.width,G.height];d[0]>c[0]&&(B=c[0]/d[0],d[0]*=B,d[1]*=B);d[1]>c[1]&&(B=c[1]/d[1],d[0]*=B,d[1]*=B);d[0]=Math.floor(d[0]);d[1]=Math.floor(d[1]);J=d;f.width=J[0];f.height=J[1];f.getContext("2d").drawImage(G,0,0,J[0],J[1]);b=f.toDataURL("image/"+h);toScale?$(".imagecrop-data").val(L+";"+b):$(".imagecrop-data").val(L+";"+a);$("#uploaded-image").attr({src:b,style:"display: block"});$("#select-crop-btn").css({display:"inline"});
$("hr").attr({style:"display:block"})}},H=$("#upload-title"),a=$("#upload-container");H.bind("click",function(b){a.slideDown("fast",function(){H.html(i18n.upload_image)})});var g=function(b){n&&n.destroy();setTimeout(function(){a.slideUp("fast",function(){H.html("<a>"+i18n.upload_new_image+"</a>")})},500);var c=new FileReader,d=(b.target.files||b.originalEvent.dataTransfer.files)[0];L=d.name;I=b;"drop"==b.type&&m(b);b=$(".imagecrop-upload");E(d)?(c.onload=function(a){A(a.target.result)},c.readAsDataURL(d)):
alert(i18n.invalid_image+"\n"+i18n.supported_image_formats+": png, jpeg or jpg");b.val("")},e=$("#select-crop-btn"),d=$("#crop-btn"),x=$("#remove-btn"),K=$('input[name="imagecrop-points"]'),P=function(a){n.release();n.disable();d.css({display:"none"});x.css({display:"none"});e.css({display:"inline"})};e.bind("click",function(a){n.enable();var b=n.getBounds();a=b[0]/2;var c=b[1]/2,f=b[0]/4;b=b[1]/4;n.animateTo([a-f,c-b,a+f,c+b]);e.css({display:"none"});d.css({display:"inline"});x.css({display:"inline"})});
d.bind("click",function(a){var b=$(".jcrop-holder");a=parseInt(b.css("width").split("px")[0]);var c=parseInt(b.css("height").split("px")[0]);b=G.width/a;c=G.height/c;a=K.val().split(",");var d=a[0],e=a[1],g=a[3];a=Math.round((a[2]-d)*b);c=Math.round((g-e)*c);n.destroy();P(I);l.attr({width:a,height:c});f.getContext("2d").drawImage(G,Math.round(d*b),Math.round(e*b),a,c,0,0,a,c);a=f.toDataURL("image/"+h);A(a)});x.bind("click",P);var ha=function(a){K.val(a.x+","+a.y+","+a.x2+","+a.y2)};$("#uploaded-image").bind("load",
function(a){a=$(this);n&&(n.destroy(),P(I));a.Jcrop({onChange:ha,opacity:.2,bgFade:!0,bgColor:"black",addClass:"jcrop-light"},function(){n=this;n.getBounds();n.ui.selection.addClass("jcrop-selection");n.disable()})});var V=$(".imagecrop-data").attr("value");var I=document.createEvent("Event");var c=new Image;c.src=V;c.onload=function(){l.attr({width:c.width,height:c.height});f.getContext("2d").drawImage(c,0,0,c.width,c.height);var a=V.split(".");h=a[a.length-1];"jpg"==h&&(h="jpeg");L="upload."+h;
a=f.toDataURL("image/"+h);A(a)};$(".imagecrop-drag").bind("dragover",m).bind("dragleave",m).bind("drop",g);$(".imagecrop-upload").bind("change",g)}});

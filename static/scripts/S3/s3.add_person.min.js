(function(){S3.addPersonWidget=function(b){var c="#"+b,f=$(c),k=f.next(".error_wrapper"),m=$(c+"_title__row"),g=$(c+"_full_name__row"),n=$(c+"_date_of_birth__row"),l=$(c+"_gender__row"),r=$(c+"_occupation__row"),a=$(c+"_email__row"),e=$(c+"_mobile_phone__row"),h=$(c+"_box_bottom");$(c+"__row").hide().after(h).after(e).after(a).after(r).after(l).after(n).after(g).after(m).after(k);m.show();g.show();n.show();l.show();r.show();a.show();e.show();h.show();f.val()?(s(b),$(c+"_edit_bar .icon-remove").hide()):
(p(b),$(c+"_edit_bar .icon-edit").hide());$(c+"_edit_bar").removeClass("hide").show();$(c+"_edit_bar .icon-edit").click(function(){var d="#"+b;p(b);$(d).val("");$(d+"_full_name").prop("disabled",!1).val("");$(d+"_gender").prop("disabled",!1).val("");$(d+"_date_of_birth").prop("disabled",!1).val("");$(d+"_occupation").prop("disabled",!1).val("");$(d+"_email").prop("disabled",!1).val("");$(d+"_mobile_phone").prop("disabled",!1).val("");$(d+"_edit_bar .icon-edit").hide();$(d+"_edit_bar .icon-remove").show()});
$(c+"_edit_bar .icon-remove").click(function(){var d="#"+b,a=$(d).data("existing");a?($(d).val(a.value),$(d+"_full_name").prop("disabled",!0).val(a.full_name),$(d+"_gender").prop("disabled",!0).val(a.gender),$(d+"_date_of_birth").prop("disabled",!0).val(a.date_of_birth),$(d+"_occupation").prop("disabled",!0).val(a.occupation),$(d+"_email").prop("disabled",!0).val(a.email),$(d+"_mobile_phone").prop("disabled",!0).val(a.mobile_phone),$(d+"_edit_bar .icon-edit").show(),$(d+"_edit_bar .icon-remove").hide()):
($(d+"_full_name").prop("disabled",!1).val(""),q(b))});$("form").submit(function(){S3ClearNavigateAwayConfirm();var a="#"+b;$(a+"_full_name").prop("disabled",!1);$(a+"_gender").prop("disabled",!1);$(a+"_date_of_birth").prop("disabled",!1);$(a+"_occupation").prop("disabled",!1);$(a+"_email").prop("disabled",!1);$(a+"_mobile_phone").prop("disabled",!1);return!0})};var s=function(b){b="#"+b;$(b+"_full_name").prop("disabled",!0);$(b+"_gender").prop("disabled",!0);$(b+"_date_of_birth").prop("disabled",
!0);$(b+"_occupation").prop("disabled",!0);$(b+"_email").prop("disabled",!0);$(b+"_mobile_phone").prop("disabled",!0);$(b+"_edit_bar .icon-edit").show();$(b+"_edit_bar .icon-remove").hide()},q=function(b){b="#"+b;$(b).val("");$(b+"_gender").prop("disabled",!1).val("");$(b+"_date_of_birth").prop("disabled",!1).val("");$(b+"_occupation").prop("disabled",!1).val("");$(b+"_email").prop("disabled",!1).val("");$(b+"_mobile_phone").prop("disabled",!1).val("")},p=function(b){var c="#"+b,f=$(c+"_full_name");
if(!f.attr("autocomplete")){var k=$(c),m=k.val(),g=m?{value:m,full_name:f.val(),gender:$(c+"_gender").val(),date_of_birth:$(c+"_date_of_birth").val(),occupation:$(c+"_occupation").val(),email:$(c+"_email").val(),mobile_phone:$(c+"_mobile_phone").val()}:{};k.data("existing",g);m=f.attr("data-c");$(c+"_full_name").after('<div id="'+b+'_throbber" class="throbber input_throbber hide"></div>');var n=$(c+"_throbber"),l=S3.Ap.concat("/"+m+"/person/search_ac");f.autocomplete({delay:450,minLength:2,source:function(b,
a){$.ajax({url:l,data:{term:b.term}}).done(function(b){if(0==b.length)k.val("");else{var c=i18n.none_of_the_above;b.push({id:0,value:"",label:c,first:c})}a(b)})},search:function(b,a){n.removeClass("hide").show();return!0},response:function(b,a,c){n.hide();return c},focus:function(b,a){return!1},select:function(c,a){var e=a.item;if(e.id){var h=e.first;e.middle&&(h+=" "+e.middle);e.last&&(h+=" "+e.last);f.val(h);k.val(e.id);t(b,e.id)}else k.val("");return!1}}).data("ui-autocomplete")._renderItem=function(b,
a){var c=a.first;a.middle&&(c+=" "+a.middle);a.last&&(c+=" "+a.last);return $("<li>").data("item.autocomplete",a).append("<a>"+c+"</a>").appendTo(b)};f.blur(function(){g&&g.full_name!=f.val()&&k.val("")})}},t=function(b,c){var f="#"+b,k=$(f+"_full_name");k.prop("disabled",!1);q(b);var m=$(f),g=k.attr("data-c"),g=S3.Ap.concat("/"+g+"/person/"+c+".s3json?show_ids=True");$.getJSONS3(g,function(c){try{var l,g,a=c.$_pr_person[0];s(b);var e=a["@id"];c=[];a.hasOwnProperty("first_name")&&c.push(a.first_name);
a.hasOwnProperty("middle_name")&&c.push(a.middle_name["@value"]);a.hasOwnProperty("last_name")&&c.push(a.last_name["@value"]);var h=c.join(" ");k.val(h);e={value:e,full_name:h};m.data("existing",e);if(a.hasOwnProperty("$_pr_email_contact")){var d=a.$_pr_email_contact[0];l=d.value["@value"]}a.hasOwnProperty("$_pr_phone_contact")&&(d=a.$_pr_phone_contact[0],g=d.value["@value"]);if(a.hasOwnProperty("$_pr_contact"))for(var p=a.$_pr_contact,h=0;h<p.length;h++)d=p[h],void 0==l&&"EMAIL"==d.contact_method["@value"]&&
(l=d.value["@value"]),void 0==g&&"SMS"==d.contact_method["@value"]&&(g=d.value["@value"]);void 0!==l&&($(f+"_email").val(l),e.email=l);void 0!==g&&($(f+"_mobile_phone").val(g),e.mobile_phone=g);if(a.hasOwnProperty("gender")){var q=a.gender["@value"];$(f+"_gender").val(q);e.gender=q}if(a.hasOwnProperty("date_of_birth")){var u=a.date_of_birth["@value"];$(f+"_date_of_birth").val(u);e.date_of_birth=u}if(a.hasOwnProperty("occupation")){var v=a.occupation["@value"];$(f+"_occupation").val(v);e.occupation=
v}}catch(t){m.val("")}})}})();

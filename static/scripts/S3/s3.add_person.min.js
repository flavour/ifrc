(function(){S3.addPersonWidget=function(b){var a="#"+b,d=$(a);if($(a+"__row").hasClass("control-group")){var f=d.next(".error_wrapper"),m=$(a+"_title__row"),k=$(a+"_organisation_id__row"),n=$(a+"_full_name__row"),g=$(a+"_date_of_birth__row"),h=$(a+"_gender__row"),c=$(a+"_occupation__row"),l=$(a+"_mobile_phone__row"),s=$(a+"_home_phone__row"),t=$(a+"_email__row"),p=$(a+"_box_bottom");$(a+"__row").hide().after(p).after(t).after(s).after(l).after(c).after(h).after(g).after(n).after(k).after(m).after(f);
m.removeClass("hide").show();k.removeClass("hide").show();n.removeClass("hide").show();g.removeClass("hide").show();h.removeClass("hide").show();c.removeClass("hide").show();l.removeClass("hide").show();s.removeClass("hide").show();t.removeClass("hide").show();p.removeClass("hide").show()}d.val()?(u(b),$(a+"_edit_bar .icon-remove").hide()):(q(b),$(a+"_edit_bar .icon-edit").hide());$(a+"_edit_bar").removeClass("hide").show();$(a+"_edit_bar .icon-edit").click(function(){var e="#"+b;q(b);$(e).val("");
$(e+"_organisation_id").prop("disabled",!1).val("").change();$(e+"_full_name").prop("disabled",!1).val("");$(e+"_gender").prop("disabled",!1).val("");$(e+"_date_of_birth").prop("disabled",!1).val("");$(e+"_occupation").prop("disabled",!1).val("");$(e+"_mobile_phone").prop("disabled",!1).val("");$(e+"_home_phone").prop("disabled",!1).val("");$(e+"_email").prop("disabled",!1).val("");$(e+"_edit_bar .icon-edit").hide();$(e+"_edit_bar .icon-remove").removeClass("hide").show()});$(a+"_edit_bar .icon-remove").click(function(){var e=
"#"+b,a=$(e).data("existing");a?($(e).val(a.value),$(e+"_organisation_id").prop("disabled",!0).val(a.organisation_id),$(e+"_full_name").prop("disabled",!0).val(a.full_name),$(e+"_gender").prop("disabled",!0).val(a.gender),$(e+"_date_of_birth").prop("disabled",!0).val(a.date_of_birth),$(e+"_occupation").prop("disabled",!0).val(a.occupation),$(e+"_mobile_phone").prop("disabled",!0).val(a.mobile_phone),$(e+"_home_phone").prop("disabled",!0).val(a.home_phone),$(e+"_email").prop("disabled",!0).val(a.email),
$(e+"_edit_bar .icon-edit").removeClass("hide").show(),$(e+"_edit_bar .icon-remove").hide()):($(e+"_full_name").prop("disabled",!1).val(""),r(b))});$(a+"_organisation_id").change(function(){var a=$(this).val(),b=d.data("url");a?(b=b.split("?")[0],b+="?~.organisation_id="+a):b=b.split("?")[0];d.data("url",b)});$("form").submit(function(){S3ClearNavigateAwayConfirm();var a="#"+b;$(a+"_organisation_id").prop("disabled",!1);$(a+"_full_name").prop("disabled",!1);$(a+"_gender").prop("disabled",!1);$(a+
"_date_of_birth").prop("disabled",!1);$(a+"_occupation").prop("disabled",!1);$(a+"_mobile_phone").prop("disabled",!1);$(a+"_home_phone").prop("disabled",!1);$(a+"_email").prop("disabled",!1);return!0})};var u=function(b){b="#"+b;$(b+"_organisation_id").prop("disabled",!0);$(b+"_full_name").prop("disabled",!0);$(b+"_gender").prop("disabled",!0);$(b+"_date_of_birth").prop("disabled",!0);$(b+"_occupation").prop("disabled",!0);$(b+"_mobile_phone").prop("disabled",!0);$(b+"_home_phone").prop("disabled",
!0);$(b+"_email").prop("disabled",!0);$(b+"_edit_bar .icon-edit").removeClass("hide").show();$(b+"_edit_bar .icon-remove").hide()},r=function(b){b="#"+b;$(b).val("");$(b+"_organisation_id").prop("disabled",!1).val("");$(b+"_gender").prop("disabled",!1).val("");$(b+"_date_of_birth").prop("disabled",!1).val("");$(b+"_occupation").prop("disabled",!1).val("");$(b+"_mobile_phone").prop("disabled",!1).val("");$(b+"_home_phone").prop("disabled",!1).val("");$(b+"_email").prop("disabled",!1).val("")},q=function(b){var a=
"#"+b,d=$(a+"_full_name");if(!d.attr("autocomplete")){var f=$(a),m=f.val(),k=m?{value:m,full_name:d.val(),organisation_id:$(a+"_organisation_id").val(),gender:$(a+"_gender").val(),date_of_birth:$(a+"_date_of_birth").val(),occupation:$(a+"_occupation").val(),mobile_phone:$(a+"_mobile_phone").val(),home_phone:$(a+"_home_phone").val(),email:$(a+"_email").val()}:{};f.data("existing",k);$(a+"_full_name").after('<div id="'+b+'_throbber" class="throbber input_throbber hide"></div>');var n=$(a+"_throbber"),
a=d.attr("data-c"),m=d.attr("data-f"),a=S3.Ap.concat("/"+a+"/"+m+"/search_ac");f.data("url",a);d.autocomplete({delay:450,minLength:2,source:function(a,b){$.ajax({url:f.data("url"),data:{term:a.term}}).done(function(a){0==a.length?f.val(""):a.push({id:0,value:"",label:i18n.none_of_the_above});b(a)})},search:function(a,b){n.removeClass("hide").show();return!0},response:function(a,b,c){n.hide();return c},focus:function(a,b){return!1},select:function(a,h){var c=h.item;if(c.id){var l;void 0!=c.label?l=
c.label:(l=c.first,c.middle&&(l+=" "+c.middle),c.last&&(l+=" "+c.last));d.val(l);f.val(c.id).change();v(b,c.id)}else f.val("").change();return!1}}).data("ui-autocomplete")._renderItem=function(a,b){var c;if(void 0!=b.label)c=b.label;else{c=b.first;b.middle&&(c+=" "+b.middle);b.last&&(c+=" "+b.last);var d=b.org,f=b.job;if(d||f)f?(c+=" ("+f,d&&(c+=", "+d),c+=")"):c+=" ("+d+")"}return $("<li>").data("item.autocomplete",b).append("<a>"+c+"</a>").appendTo(a)};d.blur(function(){k&&k.full_name!=d.val()&&
f.val("").change()})}},v=function(b,a){var d="#"+b,f=$(d+"_full_name");f.prop("disabled",!1);r(b);var m=$(d),k=f.attr("data-c"),n=f.attr("data-f"),k=S3.Ap.concat("/"+k+"/"+n+"/"+a+"/lookup");$.getJSONS3(k,function(g){try{var h=f.val(),h={value:a,full_name:h};m.val(a);m.data("existing",h);if(g.hasOwnProperty("email")){var c=g.email;$(d+"_email").val(c);h.email=c}if(g.hasOwnProperty("mobile_phone")){var l=g.mobile_phone;$(d+"_mobile_phone").val(l);h.mobile_phone=l}if(g.hasOwnProperty("home_phone")){var k=
g.home_phone;$(d+"_home_phone").val(k);h.home_phone=k}if(g.hasOwnProperty("gender")){var n=g.gender;$(d+"_gender").val(n);h.gender=n}if(g.hasOwnProperty("date_of_birth")){var p=g.date_of_birth;$(d+"_date_of_birth").val(p);h.date_of_birth=p}if(g.hasOwnProperty("occupation")){var e=g.occupation;$(d+"_occupation").val(e);h.occupation=e}if(g.hasOwnProperty("organisation_id")){var q=g.organisation_id;$(d+"_organisation_id").val(q);h.organisation_id=q}u(b)}catch(v){m.val(""),r(b)}})}})();

function s3_popup_refresh_caller(e){var a=getQueryParams(document.location.search),d=a.refresh;if("undefined"!=typeof d){isNaN(parseInt(d))||self.parent.location.reload(!0);var g=self.parent.$("#"+d);if(g.hasClass("dl")){var c=a.record;void 0!==c?g.datalist("ajaxReloadItem",c):g.datalist("ajaxReload")}else try{g.dataTable().fnReloadAjax()}catch(F){}a=self.parent.S3.gis.maps;if("undefined"!=typeof a){var b,t,u;for(b in a){e=a[b];c=d.replace(/-/g,"_");var k=e.layers;var m=0;for(t=k.length;m<t;m++){var f=
k[m];if(f.s3_layer_id==c){var l=f.strategies;f=0;for(u=l.length;f<u;f++){var r=l[f];if("OpenLayers.Strategy.Refresh"==r.CLASS_NAME){r.refresh();break}}break}}}}self.parent.$(".filter-form").trigger("dataChanged",d);self.parent.S3.popup_remove()}else if(c=a.refresh_layer,"undefined"!=typeof c){if(a=self.parent.S3.gis.maps,"undefined"!=typeof a)for(b in"undefined"!=c&&(c=parseInt(c)),d=self.parent.i18n.gis_draft_layer,a)for(e=a[b],k=e.layers,m=0,t=k.length;m<t;m++)if(f=k[m],f.s3_layer_id==c)for(l=f.strategies,
f=0,u=l.length;f<u;f++){if(r=l[f],"OpenLayers.Strategy.Refresh"==r.CLASS_NAME){r.refresh();break}}else if(f.name==d){for(;e.popups.length;)e.removePopup(e.popups[0]);l=f.features;for(f=l.length-1;0<=f;f--)l[f].destroy()}}else if(b=a.node)c=self.parent.$("#"+a.hierarchy),b=self.parent.$("#"+b),c&&b&&c.hierarchicalcrud("refreshNode",b),self.parent.S3.popup_remove();else if(b=a.agent,"undefined"!=typeof b)c="undefined"!=typeof e?[e]:[],self.parent.$("#"+b).trigger("configSaved",c);else if("undefined"!=
typeof a.level)self.parent.S3.popup_remove();else{var h=a.caller;if(void 0===h)s3_debug("Neither calling element nor refresh-target specified in popup URL!"),self.parent.S3.popup_remove();else if(s3_debug("Caller: ",h),b=a.person_id,"undefined"!=typeof b)self.parent.$("#"+h).val(b).change(),self.parent.S3.popup_remove();else{c=new RegExp(".*\\"+S3.Ap+"\\/");b=a.child;if("undefined"===typeof b){d=(new String(self.location)).replace(c,"");d=d.split("?")[0].split("/");var p=d[1].split(".")[0]+"_id"}else p=
b;s3_debug("child_resource",p);var v=a.parent;e=new String(self.parent.location);b=a.prefix;d=e.replace(c,"");"undefined"===typeof v?(c=h.replace("_"+p,""),s3_debug("parent_field",c),a=c.replace(/_.*/,""),a=c.replace(a+"_",""),d=d.split("?")[0].split("/"),c=null,b||(b=d[0]),e=d[1],2<d.length&&(null!==d[2].match(/\d*/)?3<d.length&&(c=d[3]):c=d[2]),null!==c&&a!=e&&a==c&&(a=e+"/"+c)):(a=v,b||(d=e.replace(c,""),d=d.split("?")[0].split("/"),b=d[0]));s3_debug("parent_resource",a);s3_debug("lookup_prefix",
b);b=S3.Ap.concat("/"+b+"/"+a+"/options.s3json?field="+p);g=self.parent.$("#"+h);s3_debug("selector",g);var C="sub_"==h.substring(0,4),y=self.parent.$("#dummy_"+h),z=void 0!=y.val();s3_debug("has_dummy",z);var w=g.hasClass("checkboxes-widget-s3"),A=g.hasClass("s3-hierarchy-input");if(w){var D=self.parent.$("#"+h+" tbody tr:first").children().length;var n=[]}else{var E=self.parent.$("#"+h+" >option"),x="select"==g.prop("tagName").toLowerCase();x?n=[]:b=A?b+"&hierarchy=1&only_last=1":b+"&only_last=1"}var q=
1,B="";$.getJSONS3(b,function(a){var c,b,d,e=0;$.each(a.option,function(){c=this["@value"];b=this.$;"undefined"===typeof b&&(b="");x?n.push(["<option value='",c,"'>",b,"</option>"].join("")):w?(d="id_"+p+"-"+e,n.push(["<td><input id='",d,"' name='",p,"' value='",c,"' type='checkbox'><label for='",d,"'>",b,"</label></td>"].join("")),e++):A&&(v=this["@parent"],g.parent().hierarchicalopts("addNode",v,c,b,!0));numeric_value=+c;numeric_value>q&&(q=numeric_value,B=b)});z&&(y.val(B),g.val(q).change());if(x){if(C){var f=
["_0","_none","_default"],l=h.split("_").slice(0,-1).join("_");for(a=0;a<f.length;a++){var m=f[a];self.parent.$("#"+l+m).empty().append(n.join(""))}}else E.remove(),g.append(n.join("")).val(q).change();g.val(q).change();g.prop("disabled",!1);if(g.hasClass("multiselect-widget")&&g.multiselect("instance"))try{g.multiselect("refresh")}catch(G){}}else if(w){var k=[];self.parent.$("#"+h+" input").each(function(a){$(this).prop("checked")&&k.push($(this).val())});f=[];for(a=e=0;a<n.length;a++)0===e?(f.push("<tr>"),
f.push(n[a]),e++):e==D-1?(f.push(n[a]),f.push("</tr>"),e=0):(f.push(n[a]),e++);g.html(f.join(""));k.push(q);for(a=0;a<k.length;a++)self.parent.$("#"+h+' input[value="'+k[a]+'"]').prop("checked",!0)}self.parent.S3.popup_remove()})}}}function getQueryParams(e){e=e.substring(1);var a={};if(e){e=e.split("&");for(var d,g=0,c=e.length;g<c;g++)d=e[g].split("="),a[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return a};

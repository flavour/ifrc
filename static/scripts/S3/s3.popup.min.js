function s3_popup_refresh_main_form(){var a=getQueryParams(document.location.search),c=a.refresh;if("undefined"!=typeof c){var e=self.parent.$("#"+c);"undefined"!==typeof e.dataTable?e.dataTable().fnReloadAjax():(a=a.record,void 0!==a?self.parent.dlAjaxReloadItem(c,a):self.parent.dlAjaxReload(c));c=self.parent.$("#"+c+"-filter-form");c.length&&self.parent.S3.search.ajaxUpdateOptions(c);self.parent.s3_popup_remove()}else if("undefined"!=typeof a.level)self.parent.s3_popup_remove();else{var d=a.caller;
s3_debug("caller",d);c=a.person_id;if("undefined"!=typeof c)"undefined"!=typeof d&&self.parent.$("#"+d).val(c).change(),self.parent.s3_popup_remove();else{var c=RegExp(".*\\"+S3.Ap+"\\/"),b=a.child,j;"undefined"===typeof b?(b=(new String(self.location)).replace(c,""),b=b.split("?")[0].split("/"),j=b[1]+"_id"):j=b;s3_debug("child_resource",j);a=a.parent;if("undefined"===typeof a){a=d.replace("_"+j,"");s3_debug("parent_field",a);var b=a.replace(/_.*/,""),a=a.replace(b+"_",""),b=new String(self.parent.location),
b=b.replace(c,""),b=b.split("?")[0].split("/"),g=null,c=b[0],l=b[1];2<b.length&&(null!==b[2].match(/\d*/)?3<b.length&&(g=b[3]):g=b[2]);null!==g&&a!=l&&a==g&&(a=l+"/"+g)}else b=new String(self.parent.location),b=b.replace(c,""),b=b.split("?")[0].split("/"),c=b[0];s3_debug("parent_resource",a);s3_debug("caller_prefix",c);c=S3.Ap.concat("/"+c+"/"+a+"/options.s3json?field="+j);e=self.parent.$("#"+d);s3_debug("selector",e);var t="sub_"==d.substring(0,4),p=self.parent.$("#dummy_"+d),q=void 0!=p.val();s3_debug("has_dummy",
q);var n=e.hasClass("checkboxes-widget-s3"),f;if(n){var u=self.parent.$("#"+d+" tbody tr:first").children().length;f=[]}else{var r=self.parent.$("#"+d+" >option"),o=r.length;o?f=[]:c+="&only_last=1"}var k=1,s="";$.getJSONS3(c,function(a){var c,b,g,i=0;$.each(a.option,function(){c=this["@value"];b=this.$;typeof b==="undefined"&&(b="");if(o)f.push(["<option value='",c,"'>",b,"</option>"].join(""));else if(n){g="id_"+j+"-"+i;f.push(["<td><input id='",g,"' name='",j,"' value='",c,"' type='checkbox'><label for='",
g,"'>",b,"</label></td>"].join(""));i++}numeric_value=+c;if(numeric_value>k){k=numeric_value;s=b}});if(q){p.val(s);e.val(k).change()}if(o){if(t)for(var h=["_0","_none","_default"],l,v=d.split("_").slice(0,-1).join("_"),a=0;a<h.length;a++){l=h[a];self.parent.$("#"+v+l).empty().append(f.join(""))}else{r.remove();e.append(f.join("")).val(k).change()}e.val(k).change()}else if(n){var m=[];self.parent.$("#"+d+" input").each(function(){$(this).prop("checked")&&m.push($(this).val())});h=[];for(a=i=0;a<f.length;a++)if(i===
0){h.push("<tr>");h.push(f[a]);i++}else if(i==u-1){h.push(f[a]);h.push("</tr>");i=0}else{h.push(f[a]);i++}e.html(h.join(""));m.push(k);for(a=0;a<m.length;a++)self.parent.$("#"+d+' input[value="'+m[a]+'"]').prop("checked",true)}self.parent.s3_popup_remove()})}}}function getQueryParams(a){for(var a=a.split("?")[1],a=a.split("&"),c={},e=[],d=0;d<a.length;d++)e=a[d].split("="),c[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return c};

function s3_popup_refresh_caller(e){var a=getQueryParams(document.location.search),k,m,c,d=a.refresh;if(void 0!==d){isNaN(parseInt(d))||self.parent.location.reload(!0);var g=self.parent.$("#"+d);if(g.hasClass("dl")){var b=a.record;void 0!==b?g.datalist("ajaxReloadItem",b):g.datalist("ajaxReload")}else try{g.dataTable().fnReloadAjax()}catch(F){}var n=self.parent.S3.gis.maps;if("undefined"!=typeof n)for(c in n){var p=n[c];b=d.replace(/-/g,"_");e=p.layers;a=0;for(m=e.length;a<m;a++){var f=e[a];if(f.s3_layer_id==
b){var t=f.strategies;f=0;for(k=t.length;f<k;f++){var u=t[f];if("OpenLayers.Strategy.Refresh"==u.CLASS_NAME){u.refresh();break}}break}}}self.parent.$(".filter-form").trigger("dataChanged",d);self.parent.S3.popup_remove()}else if(b=a.refresh_layer,"undefined"!=typeof b){if(n=self.parent.S3.gis.maps,"undefined"!=typeof n)for(c in"undefined"!=b&&(b=parseInt(b)),d=self.parent.i18n.gis_draft_layer,n)for(p=n[c],e=p.layers,a=0,m=e.length;a<m;a++)if(f=e[a],f.s3_layer_id==b)for(t=f.strategies,f=0,k=t.length;f<
k;f++){if(u=t[f],"OpenLayers.Strategy.Refresh"==u.CLASS_NAME){u.refresh();break}}else if(f.name==d){for(;p.popups.length;)p.removePopup(p.popups[0]);k=f.features;for(f=k.length-1;0<=f;f--)k[f].destroy()}}else if(c=a.node)b=self.parent.$("#"+a.hierarchy),c=self.parent.$("#"+c),b&&c&&b.hierarchicalcrud("refreshNode",c),self.parent.S3.popup_remove();else if(c=a.agent,"undefined"!=typeof c)b="undefined"!=typeof e?[e]:[],self.parent.$("#"+c).trigger("configSaved",b);else if("undefined"!=typeof a.level)self.parent.S3.popup_remove();
else{var h=a.caller;if(void 0===h)s3_debug("Neither calling element nor refresh-target specified in popup URL!"),self.parent.S3.popup_remove();else if(s3_debug("Caller: ",h),c=a.person_id,"undefined"!=typeof c)self.parent.$("#"+h).val(c).change(),self.parent.S3.popup_remove();else{b=new RegExp(".*\\"+S3.Ap+"\\/");c=a.child;if("undefined"===typeof c){d=(""+self.location).replace(b,"");d=d.split("?")[0].split("/");var q=d[1].split(".")[0]+"_id"}else q=c;s3_debug("childResource",q);var v=a.parent;e=
""+self.parent.location;c=a.prefix;d=e.replace(b,"");"undefined"===typeof v?(b=h.replace("_"+q,""),s3_debug("parentField",b),a=b.replace(/_.*/,""),a=b.replace(a+"_",""),d=d.split("?")[0].split("/"),b=null,c||(c=d[0]),e=d[1],2<d.length&&(null!==d[2].match(/\d*/)?3<d.length&&(b=d[3]):b=d[2]),null!==b&&a!=e&&a==b&&(a=e+"/"+b)):(a=v,c||(d=e.replace(b,""),d=d.split("?")[0].split("/"),c=d[0]));s3_debug("parentResource",a);s3_debug("lookupPrefix",c);c=S3.Ap.concat("/"+c+"/"+a+"/options.s3json?field="+q);
g=self.parent.$("#"+h);s3_debug("callerWidget",g);var C="sub_"==h.substring(0,4),y=self.parent.$("#dummy_"+h),z=void 0!==y.val();s3_debug("hasDummy",z);var w=g.hasClass("checkboxes-widget-s3"),A=g.hasClass("s3-hierarchy-input"),x;if(w){var D=self.parent.$("#"+h+" tbody tr:first").children().length;var l=[]}else{var E=self.parent.$("#"+h+" >option");(x="select"==g.prop("tagName").toLowerCase())?l=[]:c=A?c+"&hierarchy=1&only_last=1":c+"&only_last=1"}var r=1,B="";$.getJSONS3(c,function(a){var c=0;if((a=
a.option)&&a.length)if(a.forEach(function(a){var b=a["@value"];a=a.$;void 0===a&&(a="");if(x)l.push(["<option value='",b,"'>",a,"</option>"].join(""));else if(w){var d="id_"+q+"-"+c;l.push(["<td><input id='",d,"' name='",q,"' value='",b,"' type='checkbox'><label for='",d,"'>",a,"</label></td>"].join(""));c++}else A&&(v=this["@parent"],g.parent().hierarchicalopts("addNode",v,b,a,!0));b=+b;!isNaN(b)&&b>r&&(r=b,B=a)}),z&&(y.val(B),g.val(r).change()),x){if(C){var b=["_0","_none","_default"],d=h.split("_").slice(0,
-1).join("_");for(a=0;a<b.length;a++){var e=b[a];self.parent.$("#"+d+e).empty().append(l.join(""))}}else E.remove(),g.append(l.join("")).val(r).change();g.val(r).change();g.prop("disabled",!1);if(g.hasClass("multiselect-widget")&&g.multiselect("instance"))try{g.multiselect("refresh")}catch(G){}}else{if(w){var f=[];self.parent.$("#"+h+" input").each(function(){$(this).prop("checked")&&f.push($(this).val())});b=[];for(a=c=0;a<l.length;a++)0===c?(b.push("<tr>"),b.push(l[a]),c++):c==D-1?(b.push(l[a]),
b.push("</tr>"),c=0):(b.push(l[a]),c++);g.html(b.join(""));f.push(r);for(a=0;a<f.length;a++)self.parent.$("#"+h+' input[value="'+f[a]+'"]').prop("checked",!0)}}else s3_debug("No options available to refresh parent field");self.parent.S3.popup_remove()})}}}function getQueryParams(e){e=e.substring(1);var a={};if(e){e=e.split("&");for(var k,m=0,c=e.length;m<c;m++)k=e[m].split("="),a[decodeURIComponent(k[0])]=decodeURIComponent(k[1])}return a};

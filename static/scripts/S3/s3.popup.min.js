function s3_popup_refresh_main_form(){var a=getQueryParams(document.location.search),c=a.refresh;if("undefined"!=typeof c){var e=self.parent.$("#"+c);"undefined"!==typeof e.dataTable?e.dataTable().fnReloadAjax():(a=a.record,void 0!==a?self.parent.dlAjaxReloadItem(c,a):self.parent.dlAjaxReload(c));c=self.parent.$("#"+c+"-filter-form");c.length&&self.parent.S3.search.ajaxUpdateOptions(c);self.parent.s3_popup_remove()}else if("undefined"!=typeof a.level)self.parent.s3_popup_remove();else{var d=a.caller;
s3_debug("caller",d);c=a.person_id;if("undefined"!=typeof c)"undefined"!=typeof d&&self.parent.$("#"+d).val(c).change(),self.parent.s3_popup_remove();else{var c=RegExp(".*\\"+S3.Ap+"\\/"),b=a.child,l;"undefined"===typeof b?(b=(new String(self.location)).replace(c,""),b=b.split("?")[0].split("/"),l=b[1]+"_id"):l=b;s3_debug("child_resource",l);a=a.parent;if("undefined"===typeof a){a=d.replace("_"+l,"");s3_debug("parent_field",a);var b=a.replace(/_.*/,""),a=a.replace(b+"_",""),b=new String(self.parent.location),
b=b.replace(c,""),b=b.split("?")[0].split("/"),g=null,c=b[0],n=b[1];2<b.length&&(null!==b[2].match(/\d*/)?3<b.length&&(g=b[3]):g=b[2]);null!==g&&(a!=n&&a==g)&&(a=n+"/"+g)}else b=new String(self.parent.location),b=b.replace(c,""),b=b.split("?")[0].split("/"),c=b[0];s3_debug("parent_resource",a);s3_debug("caller_prefix",c);c=S3.Ap.concat("/"+c+"/"+a+"/options.s3json?field="+l);e=self.parent.$("#"+d);s3_debug("selector",e);var w="sub_"==d.substring(0,4),s=self.parent.$("#dummy_"+d),t=void 0!=s.val();
s3_debug("has_dummy",t);var q=e.hasClass("checkboxes-widget-s3"),f;if(q){var x=self.parent.$("#"+d+" tbody tr:first").children().length;f=[]}else{var u=self.parent.$("#"+d+" >option"),r=u.length;r?f=[]:c+="&only_last=1"}var m=1,v="";$.getJSONS3(c,function(a){var c,b,g,k=0;$.each(a.option,function(){c=this["@value"];b=this.$;"undefined"===typeof b&&(b="");r?f.push(["<option value='",c,"'>",b,"</option>"].join("")):q&&(g="id_"+l+"-"+k,f.push(["<td><input id='",g,"' name='",l,"' value='",c,"' type='checkbox'><label for='",
g,"'>",b,"</label></td>"].join("")),k++);numeric_value=+c;numeric_value>m&&(m=numeric_value,v=b)});t&&(s.val(v),e.val(m).change());if(r){if(w){var h=["_0","_none","_default"],n,y=d.split("_").slice(0,-1).join("_");for(a=0;a<h.length;a++)n=h[a],self.parent.$("#"+y+n).empty().append(f.join(""))}else u.remove(),e.append(f.join("")).val(m).change();e.val(m).change()}else if(q){var p=[];self.parent.$("#"+d+" input").each(function(a){$(this).prop("checked")&&p.push($(this).val())});h=[];for(a=k=0;a<f.length;a++)0===
k?(h.push("<tr>"),h.push(f[a]),k++):k==x-1?(h.push(f[a]),h.push("</tr>"),k=0):(h.push(f[a]),k++);e.html(h.join(""));p.push(m);for(a=0;a<p.length;a++)self.parent.$("#"+d+' input[value="'+p[a]+'"]').prop("checked",!0)}self.parent.s3_popup_remove()})}}}function getQueryParams(a){a=a.split("?")[1];a=a.split("&");for(var c={},e=[],d=0;d<a.length;d++)e=a[d].split("="),c[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return c};

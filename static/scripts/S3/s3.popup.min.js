function s3_popup_refresh_main_form(){var a=getQueryParams(document.location.search),b=a.refresh;if("undefined"!=typeof b){var d=self.parent.$("#"+b);"undefined"!==typeof d.dataTable?d.dataTable().fnReloadAjax():(a=a.record,void 0!==a?self.parent.dlAjaxReloadItem(b,a):self.parent.dlAjaxReload(b));if("undefined"!=typeof self.parent.map){var f=self.parent.map.layers,x=b.replace(/-/g,"_");Ext.iterate(f,function(a,b,c){if(a.s3_layer_id==x){var d=f[b];Ext.iterate(d.strategies,function(a,b,c){"OpenLayers.Strategy.Refresh"==
a.CLASS_NAME&&d.strategies[b].refresh()})}})}b=self.parent.$("#"+b+"-filter-form");b.length&&self.parent.S3.search.ajaxUpdateOptions(b);self.parent.s3_popup_remove()}else if("undefined"!=typeof a.level)self.parent.s3_popup_remove();else{var e=a.caller;s3_debug("caller",e);b=a.person_id;if("undefined"!=typeof b)"undefined"!=typeof e&&self.parent.$("#"+e).val(b).change(),self.parent.s3_popup_remove();else{var b=RegExp(".*\\"+S3.Ap+"\\/"),c=a.child,m;"undefined"===typeof c?(c=(new String(self.location)).replace(b,
""),c=c.split("?")[0].split("/"),m=c[1]+"_id"):m=c;s3_debug("child_resource",m);a=a.parent;if("undefined"===typeof a){a=e.replace("_"+m,"");s3_debug("parent_field",a);var c=a.replace(/_.*/,""),a=a.replace(c+"_",""),c=new String(self.parent.location),c=c.replace(b,""),c=c.split("?")[0].split("/"),l=null,b=c[0],p=c[1];2<c.length&&(null!==c[2].match(/\d*/)?3<c.length&&(l=c[3]):l=c[2]);null!==l&&(a!=p&&a==l)&&(a=p+"/"+l)}else c=new String(self.parent.location),c=c.replace(b,""),c=c.split("?")[0].split("/"),
b=c[0];s3_debug("parent_resource",a);s3_debug("caller_prefix",b);b=S3.Ap.concat("/"+b+"/"+a+"/options.s3json?field="+m);d=self.parent.$("#"+e);s3_debug("selector",d);var y="sub_"==e.substring(0,4),t=self.parent.$("#dummy_"+e),u=void 0!=t.val();s3_debug("has_dummy",u);var r=d.hasClass("checkboxes-widget-s3"),g;if(r){var z=self.parent.$("#"+e+" tbody tr:first").children().length;g=[]}else{var v=self.parent.$("#"+e+" >option"),s=v.length;s?g=[]:b+="&only_last=1"}var n=1,w="";$.getJSONS3(b,function(a){var b,
c,f,k=0;$.each(a.option,function(){b=this["@value"];c=this.$;"undefined"===typeof c&&(c="");s?g.push(["<option value='",b,"'>",c,"</option>"].join("")):r&&(f="id_"+m+"-"+k,g.push(["<td><input id='",f,"' name='",m,"' value='",b,"' type='checkbox'><label for='",f,"'>",c,"</label></td>"].join("")),k++);numeric_value=+b;numeric_value>n&&(n=numeric_value,w=c)});u&&(t.val(w),d.val(n).change());if(s){if(y){var h=["_0","_none","_default"],l,p=e.split("_").slice(0,-1).join("_");for(a=0;a<h.length;a++)l=h[a],
self.parent.$("#"+p+l).empty().append(g.join(""))}else v.remove(),d.append(g.join("")).val(n).change();d.val(n).change()}else if(r){var q=[];self.parent.$("#"+e+" input").each(function(a){$(this).prop("checked")&&q.push($(this).val())});h=[];for(a=k=0;a<g.length;a++)0===k?(h.push("<tr>"),h.push(g[a]),k++):k==z-1?(h.push(g[a]),h.push("</tr>"),k=0):(h.push(g[a]),k++);d.html(h.join(""));q.push(n);for(a=0;a<q.length;a++)self.parent.$("#"+e+' input[value="'+q[a]+'"]').prop("checked",!0)}self.parent.s3_popup_remove()})}}}
function getQueryParams(a){a=a.split("?")[1];a=a.split("&");for(var b={},d=[],f=0;f<a.length;f++)d=a[f].split("="),b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]);return b};

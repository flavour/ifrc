var s3_gis_locationselector2=function(c,e,a,d,k,m,p,f){var g="#"+c,h=$(g);f&&h.data("specific",f);f=$(g+"__row .map_wrapper").attr("id",c+"_map_wrapper");var b=$(g+"_L0__row"),r=$(g+"_L1__row"),q=$(g+"_L2__row"),s=$(g+"_L3__row"),t=$(g+"_L4__row"),u=$(g+"_L5__row"),h=h.next(".error_wrapper");$(g+"__row").hide().after(f).after(u).after(t).after(s).after(q).after(r).after(b).after(h);e&&lx_select(c,0,e);a&&lx_select(c,1,a);d&&lx_select(c,2,d);k&&lx_select(c,3,k);m&&lx_select(c,4,m);p&&lx_select(c,5,
p);$(g+"_L0").change(function(){lx_select(c,0)});$(g+"_L1").change(function(){lx_select(c,1)});$(g+"_L2").change(function(){lx_select(c,2)});$(g+"_L3").change(function(){lx_select(c,3)});$(g+"_L4").change(function(){lx_select(c,4)});$(g+"_L5").change(function(){lx_select(c,5)})};
function lx_select(c,e,a){var d="#"+c,k=$(d),m=$(d+"_lat"),p=$(d+"_lon"),f=m.val(),g=p.val();f&&m.data("lat",f);g&&p.data("lon",g);m.val("");p.val("");$(d+"_map_wrapper").hide();a?$(d+"_L"+e).val(a):a=$(d+"_L"+e).val();if(a){k.val(a);for(f=e+1;6>f;f++)$(d+"_L"+f+"__row").hide();e+=1;f=$(d+"_L"+e+"__row");if(f.length){f.show();var h=!0,b;for(b in l)l[b].f==a&&(h=!1);h&&readHierarchy(c,e,a);h=[];for(b in l)v=l[b],v.l==e&&v.f==a&&(v.i=b,h.push(v));h.sort(nameSort);c=$(d+"_L"+e);$(d+"_L"+e+" option").remove('[value != ""]');
b=0;for(e=h.length;b<e;b++)f=h[b],d=f.i,g=a==d?' selected="selected"':"",d='<option value="'+d+'"'+g+">"+f.n+"</option>",c.append(d)}else{$(d+"_map_wrapper").show();$(d+"_parent").val(a);var r=k.data("specific");r&&k.val(r);f=m.data("lat");g=p.data("lon");void 0!=f&&(m.val(f),p.val(g));b="location_selector_"+c;if(!S3.gis.maps||!S3.gis.maps[b]){var q=S3.gis.show_map(b,{});void 0!=f&&(b=new OpenLayers.Geometry.Point(parseFloat(g),parseFloat(f)),b.transform(S3.gis.proj4326,q.getProjectionObject()),b=
new OpenLayers.Feature.Vector(b),q.s3.draftLayer.addFeatures([b]),r||k.val("dummy"));d=q.controls;b=0;for(e=d.length;b<e;b++)"OpenLayers.Control.DrawFeature"==d[b].CLASS_NAME&&(h=d[b]);h&&h.events.register("featureadded",null,function(a){a=a.feature.geometry.getBounds().getCenterLonLat();a.transform(q.getProjectionObject(),S3.gis.proj4326);m.val(a.lat);p.val(a.lon);r||k.val("dummy")})}else q=S3.gis.maps[b];b=l[a].b;if(!b&&(a=l[a].f,a=l[a]))if(b=a.b,!b&&(a=a.f,a=l[a]))if(b=a.b,!b&&(a=a.f,a=l[a]))b=
a.b;b&&(b=OpenLayers.Bounds.fromArray(b).transform(S3.gis.proj4326,q.getProjectionObject()),q.zoomToExtent(b))}}else{0===e?k.val(""):(a=$(d+"_L"+(e-1)).val(),k.val(a));for(f=e+1;6>f;f++)$(d+"_L"+f+"__row").hide()}}function nameSort(c,e){c=c.n;var a=[c,e.n];a.sort();return a[0]==c?-1:1}
function readHierarchy(c,e,a){var d="#"+c;$(d+"_L"+e+"__throbber").show();c=S3.Ap.concat("/gis/ldata/"+a);$(d+"_L"+(e+1)+"__row").length||(c+="/b");$.ajax({async:!1,url:c,success:function(a){for(var c in n)l[c]=n[c];n=null;$(d+"_L"+e+"__throbber").hide()},error:function(a,c,d){msg="UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText},dataType:"script"})};

var s3_gis_locationselector2=function(c,d,b,f,h,m,s,p){var e="#"+c,g=$(e);p&&g.data("specific",p);p=$(e+"__row .map_wrapper").attr("id",c+"_map_wrapper");var q=$(e+"_L0__row"),k=$(e+"_L1__row"),a=$(e+"_L2__row"),t=$(e+"_L3__row"),r=$(e+"_L4__row"),u=$(e+"_L5__row"),w=$(e+"_address__row"),g=g.next(".error_wrapper");$(e+"__row").hide().after(p).after(w).after(u).after(r).after(t).after(a).after(k).after(q).after(g);d&&lx_select(c,0,d);b&&lx_select(c,1,b);f&&lx_select(c,2,f);h&&lx_select(c,3,h);m&&lx_select(c,
4,m);s&&lx_select(c,5,s);$(e+"_L0").change(function(){lx_select(c,0)});$(e+"_L1").change(function(){lx_select(c,1)});$(e+"_L2").change(function(){lx_select(c,2)});$(e+"_L3").change(function(){lx_select(c,3)});$(e+"_L4").change(function(){lx_select(c,4)});$(e+"_L5").change(function(){lx_select(c,5)})};
function lx_select(c,d,b){var f="#"+c,h=$(f),m=$(f+"_address"),s=$(f+"_lat"),p=$(f+"_lon"),e=m.val(),g=s.val(),q=p.val();e&&m.data("address",e).val("");g&&s.data("lat",g).val("");q&&p.data("lon",q).val("");g=$(f+"_map_wrapper");g.hide();q=$(f+"_address__row");q.hide();b?$(f+"_L"+d).val(b):b=$(f+"_L"+d).val();if(b){h.val(b);for(e=d+1;6>e;e++)$(f+"_L"+e+"__row").hide();d+=1;e=$(f+"_L"+d+"__row");if(e.length){e.show();var k=!0,a;for(a in l)l[a].f==b&&(k=!1);k&&readHierarchy(c,d,b);k=[];for(a in l)v=
l[a],v.l==d&&v.f==b&&(v.i=a,k.push(v));k.sort(nameSort);c=$(f+"_L"+d);$(f+"_L"+d+" option").remove('[value != ""]');a=0;for(f=k.length;a<f;a++)m=k[a],d=m.i,g=b==d?' selected="selected"':"",d='<option value="'+d+'"'+g+">"+m.n+"</option>",c.append(d)}else{q.show();g.length?(g.show(),a=!0):a=!1;$(f+"_parent").val(b);var t=h.data("specific");t&&h.val(t);(e=m.data("address"))?(m.val(e),t||h.val("dummy")):m.change(function(){t||h.val("dummy")});$(f+"_parent").val(b);g=s.data("lat");q=p.data("lon");void 0!=
g&&(s.val(g),p.val(q));if(a){a="location_selector_"+c;if(!S3.gis.maps||!S3.gis.maps[a]){var r=S3.gis.show_map(a,{});void 0!=g&&(a=new OpenLayers.Geometry.Point(parseFloat(q),parseFloat(g)),a.transform(S3.gis.proj4326,r.getProjectionObject()),a=new OpenLayers.Feature.Vector(a),r.s3.draftLayer.addFeatures([a]),t||h.val("dummy"));d=r.controls;a=0;for(f=d.length;a<f;a++)"OpenLayers.Control.DrawFeature"==d[a].CLASS_NAME&&(k=d[a]);k&&k.events.register("featureadded",null,function(a){a=a.feature.geometry.getBounds().getCenterLonLat();
a.transform(r.getProjectionObject(),S3.gis.proj4326);s.val(a.lat);p.val(a.lon);t||h.val("dummy")})}else r=S3.gis.maps[a];a=l[b].b;if(!a&&(b=l[b].f,b=l[b]))if(a=b.b,!a&&(b=b.f,b=l[b]))if(a=b.b,!a&&(b=b.f,b=l[b]))a=b.b;a&&(a=OpenLayers.Bounds.fromArray(a).transform(S3.gis.proj4326,r.getProjectionObject()),r.zoomToExtent(a))}}}else{0===d?h.val(""):(b=$(f+"_L"+(d-1)).val(),h.val(b));for(e=d+1;6>e;e++)$(f+"_L"+e+"__row").hide()}}function nameSort(c,d){c=c.n;var b=[c,d.n];b.sort();return b[0]==c?-1:1}
function readHierarchy(c,d,b){var f="#"+c;$(f+"_L"+d+"__throbber").show();c=S3.Ap.concat("/gis/ldata/"+b);$(f+"_L"+(d+1)+"__row").length||(c+="/b");$.ajax({async:!1,url:c,success:function(b){for(var c in n)l[c]=n[c];n=null;$(f+"_L"+d+"__throbber").hide()},error:function(b,c,d){msg="UNAUTHORIZED"==d?i18n.gis_requires_login:b.responseText},dataType:"script"})};

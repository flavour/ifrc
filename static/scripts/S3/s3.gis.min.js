S3.gis.maps={};S3.gis.proj4326=new OpenLayers.Projection("EPSG:4326");OpenLayers.ImgPath=S3.Ap.concat("/static/img/gis/openlayers/");OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;OpenLayers.Util.onImageLoadErrorColor="transparent";OpenLayers.ProxyHost=S3.Ap.concat("/gis/proxy?url=");
(function(){var G=new OpenLayers.Format.GeoJSON;G.ignoreExtraDims=!0;var J=S3.Ap.concat("/static/img/markers/"),v=S3.gis.proj4326;S3.gis.show_map=function(b,a){b||(b="default_map");void 0==a&&(a=S3.gis.options[b]);var c=a.projection,d=new OpenLayers.Projection("EPSG:"+c);a.projection_current=d;900913==c?(a.maxExtent=new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),a.maxResolution=156543.0339,a.units="m"):4326==c?(a.maxExtent=new OpenLayers.Bounds(-180,-90,180,90),a.maxResolution=
1.40625,a.units="degrees"):(c=a.maxExtent.split(","),a.maxExtent=new OpenLayers.Bounds(c[0],c[1],c[2],c[3]),a.maxResolution="auto");var e,c=a.lat,f=a.lon;c&&f?(c=new OpenLayers.LonLat(f,c),c.transform(v,d)):(e=OpenLayers.Bounds.fromArray(a.bbox).transform(v,d),c=e.getCenterLonLat());a.center=c;d=Y(b,a);d.Z_INDEX_BASE.Popup=800;a.renderTo="map_panel";Z(d);e&&d.zoomToExtent(e);return d};var H=function(b){b=b.object;var a=b.getDataExtent();if(a){var c=b.map,d=c.getProjectionObject();a.transform(d,v);
var e=a.toArray(),a=e[0],f=e[1],g=e[2],e=e[3],k=(0.05-(g-a))/2;0<k&&(a-=k,g+=k);k=(0.05-(e-f))/2;0<k&&(f-=k,e+=k);a=new OpenLayers.Bounds(a-0.007,f-0.007,g+0.007,e+0.007);a.transform(v,d);c.zoomToExtent(a)}d=b.strategies;a=0;for(f=d.length;a<f;a++)if(c=d[a],"OpenLayers.Strategy.AttributeCluster"==c.CLASS_NAME){c.activate();c.features=b.features;c.recluster();break}b.events.un({loadend:H})};S3.gis.search_layer_loadend=H;S3.gis.refreshLayer=function(b,a){var c=S3.gis.maps,d,e,f,g,k,m,n,p,r,h;for(d in c)for(e=
c[d],f=e.layers,g=0,k=f.length;g<k;g++)if(m=f[g],m.s3_layer_id==b&&(n=m.protocol.url,n=S3.search.filterURL(n,a),m.protocol.options.url=n,e.s3.mapWin.isVisible())){m.events.on({loadend:H});n=m.strategies;r=n.length;for(p=0;p<r;p++)if(h=n[p],"OpenLayers.Strategy.AttributeCluster"==h.CLASS_NAME){h.deactivate();break}if(m.visibility)for(p=0;p<r;p++){if(h=n[p],"OpenLayers.Strategy.Refresh"==h.CLASS_NAME){h.refresh();break}}else m.setVisibility(!0)}};var Y=function(b,a){var c=new OpenLayers.Map("center",
{controls:[],displayProjection:v,projection:a.projection_current,fallThrough:i18n.gis_name_map?!0:!1,theme:null,maxResolution:a.maxResolution,maxExtent:a.maxExtent,numZoomLevels:a.numZoomLevels,units:a.units});S3.gis.maps[b]=c;c.s3={};c.s3.id=b;c.s3.options=a;c.s3.plugins=[];c.registerPlugin=function(a){a.map=this;this.s3.plugins.push(a)};aa(c);ba(c);return c},Z=function(b){var a=b.s3,c=a.options,d=new GeoExt.MapPanel({xtype:"gx_mappanel",map:b,center:c.center,zoom:c.zoom,plugins:[]});a.mapPanel=
d;var e={};e.map=d;a.portal=e;if(c.legend||c.layers_wms)for(var e=b.layers,d=d.layers.data.items,f=0;f<e.length;f++)e[f].legendURL&&(d[f].data.legendURL=e[f].legendURL),e[f].legendTitle&&(d[f].data.title=e[f].legendTitle),e[f].queryable&&(d[f].data.queryable=1);e=ca(b);d=[e];c.wms_browser_url&&(f=da(b))&&d.push(f);c.legend&&("float"==c.legend?ea(b):(f=new GeoExt.LegendPanel({title:i18n.gis_legend,defaults:{},autoScroll:!0,collapsible:!0,collapseMode:"mini"}),d.push(f)));for(var f=a.plugins,g=0,k=
f.length;g<k;++g)f[g].setup(b),f[g].addToMapWindow(d);a.west_panel_items=d;c.window?K(b):L(b);var m=a.westPanelContainer;m.fireEvent("collapse");window.setTimeout(function(){m.fireEvent("expand")},300);e.root.eachChild(function(){this.eachChild(function(){if(this.isLeaf())this.on("checkchange",function(a,b){b||I(this.layer)});else this.eachChild(function(){if(this.isLeaf())this.on("checkchange",function(a,b){b||I(this.layer)})})})});Ext.QuickTips.init()},L=function(b){var a=b.s3,c=a.options,d=M(b);
b=N(b);c=new Ext.Panel({renderTo:c.renderTo,autoWidth:!0,titleCollapse:!0,height:c.map_height,layout:"border",items:[d,b]});a.mapWin=c};S3.gis.addMapPanel=L;var K=function(b){var a=b.s3,c=a.options,d=M(b),e=N(b),d=new Ext.Window({cls:"gis-map-window",collapsible:!1,constrain:!0,closable:!c.windowNotClosable,closeAction:"hide",autoScroll:!0,maximizable:c.maximizable,titleCollapse:!1,height:c.map_height,width:c.map_width,layout:"border",items:[d,e]});d.on("beforehide",function(a){a.maximized&&a.restore()});
d.on("move",function(a){b.events.clearMouseCache()});c.windowHide||(d.show(),d.maximize());a.mapWin=d};S3.gis.addMapWindow=K;var M=function(b){b=b.s3;var a=b.options.west_collapsed||!1,c=new Ext.Panel({header:!1,border:!1,split:!0,items:b.west_panel_items});autoWidth=Ext.isChrome?!1:!0;a=new Ext.Panel({cls:"gis_west",region:"west",header:!1,border:!0,autoWidth:autoWidth,width:250,collapsible:!0,collapseMode:"mini",collapsed:a,items:[c]});return b.westPanelContainer=a},N=function(b){var a=b.s3,c=a.options;
if(c.toolbar){var d,e=b.s3,f=e.options;d=new Ext.Toolbar({height:34});d.map=b;e.portal.toolbar=d;var g=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent,map:b,iconCls:"zoomfull",tooltip:i18n.gis_zoomfull}),k=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({out:!0}),map:b,iconCls:"zoomout",tooltip:i18n.gis_zoomout,toggleGroup:"controls"}),m=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox,map:b,iconCls:"zoomin",tooltip:i18n.gis_zoominbutton,toggleGroup:"controls"}),
n,p,r;"active"==f.draw_polygon?(r=!0,p=n=e=!1):("active"==f.draw_line?(e=!0,n=p=!1):"active"==f.draw_feature?(p=!0,n=e=!1):(n=!0,p=e=!1),r=!1);d.add(g);navigator.geolocation&&fa(d);void 0===f.nav&&(g=new GeoExt.Action({control:new OpenLayers.Control.Navigation,map:b,iconCls:"pan-off",tooltip:i18n.gis_pan,allowDepress:!0,toggleGroup:"controls",pressed:n}),d.add(k),d.add(m),d.add(g),d.addSeparator(),m=new OpenLayers.Control.NavigationHistory,d.map.addControl(m),m.activate(),k=new Ext.Toolbar.Button({iconCls:"back",
tooltip:i18n.gis_navPrevious,handler:m.previous.trigger}),m=new Ext.Toolbar.Button({iconCls:"next",tooltip:i18n.gis_navNext,handler:m.next.trigger}),d.addButton(k),d.addButton(m));f.save&&ga(d);d.addSeparator();ha(d);f.mgrs_url&&ia(d);if(f.draw_feature||f.draw_polygon)d.addSeparator(),f.draw_feature&&O(b,d,p),f.draw_line&&P(b,d,e,!0),f.draw_polygon&&Q(b,d,r,!0);i18n.gis_get_feature_info&&(e=new gxp.plugins.WMSGetFeatureInfo({actionTarget:"toolbar",outputTarget:"map",outputConfig:{width:400,height:200},
toggleGroup:"controls",infoActionTip:i18n.gis_get_feature_info,popupTitle:i18n.gis_feature_info}),e.target=b.s3,e.addActions());i18n.gis_potlatch&&ja(d);f.Google&&f.Google.StreetviewButton&&ka(d);try{f.Google.Earth&&google&la(d)}catch(h){}i18n.gis_search&&(f=Math.min(350,!1===f.nav?f.map_width-500:f.map_width-680),b=new GeoExt.ux.GeoNamesSearchCombo({map:b,width:f,listWidth:f,minChars:2,emptyText:i18n.gis_search}),d.addSeparator(),d.add(b));b=new Ext.BoxComponent({cls:"layer_throbber hide"});d.add(b)}else c.draw_feature&&
(f="active"==c.draw_feature?!0:!1,O(b,null,f)),c.draw_line&&(f="active"==c.draw_line?!0:!1,P(b,null,f)),c.draw_polygon&&(f="active"==c.draw_polygon?!0:!1,Q(b,null,f,!0)),c.save&&ma(b),b=b.s3,f=b.id,$("#"+f+" .layer_throbber").length||(e='<div class="layer_throbber float hide',b.options.save&&(e+=" save"),e+='"></div>',$("#"+f).append(e));b=new Ext.Panel({layout:"card",region:"center",cls:"mappnlcntr",defaults:{border:!1},items:[a.mapPanel],activeItem:0,tbar:d,scope:this});a.mapPanelContainer=b;c.Google&&
c.Google.Earth&&(c=new gxp.GoogleEarthPanel({mapPanel:a.mapPanel}),b.items.items.push(c),a.googleEarthPanel=c,S3.gis.googleEarthPanel=c);return b},ca=function(b){GeoExt.tree.LayerNodeUIS3=Ext.extend(GeoExt.tree.LayerNodeUI,{onClick:function(a){if(a.getTarget(".x-tree-node-cb",1)){var b=this.node,c=this.node.attributes,d=c.checkedGroup;d&&"baselayer"!==d?(d=!c.checked,c.checked=d,b.ui.checkbox.checked=d,b.layer.setVisibility(d),this.enforceOneVisible()):this.toggleCheck(this.isChecked())}else GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,
arguments)},enforceOneVisible:function(){var a=this.node.attributes,b=a.checkedGroup;if(b&&"baselayer"!==b){var c=this.node.layer,d=this.node.getOwnerTree().getChecked();Ext.each(d,function(d){var e=d.layer;d.hidden||d.attributes.checkedGroup!==b||e!=c&&a.checked&&e.setVisibility(!1)})}}});GeoExt.tree.LayerNodeS3=Ext.extend(GeoExt.tree.LayerNode,{constructor:function(a){this.defaultUI=GeoExt.tree.LayerNodeUIS3;GeoExt.tree.LayerNodeS3.superclass.constructor.apply(this,arguments)}});Ext.tree.TreePanel.nodeTypes.gx_layer=
GeoExt.tree.LayerNodeS3;var a=b.s3,c=a.options,d=c.hide_overlays?!1:!0,e=c.folders_closed?!1:!0,f=c.folders_radio?!0:!1,g=c.wms_browser_url||c.legend&&"float"!=c.legend?!0:!1,k=a.mapPanel.layers,m=[],n={click:function(a){var b=a.attributes;if("baselayer"==b.checkedGroup)a.ui.toggleCheck(!a.ui.isChecked());else{var c=!b.checked;b.checked=c;a.ui.checkbox.checked=c;a.layer.setVisibility(c)}}},p=function(){var b=a.westPanelContainer;b.fireEvent("collapse");window.setTimeout(function(){b.fireEvent("expand")},
300)},r={collapse:function(a){p()},expand:function(a){p()}};!c.hide_base&&m.push({text:i18n.gis_base_layers,nodeType:"gx_baselayercontainer",layerStore:k,loader:{baseAttrs:{listeners:n},filter:function(a){a=a.getLayer();return!0===a.displayInLayerSwitcher&&!0===a.isBaseLayer&&(void 0===a.dir||""===a.dir)}},leaf:!1,listeners:r,singleClickExpand:!0,expanded:e});d&&m.push({text:i18n.gis_overlays,nodeType:"gx_overlaylayercontainer",layerStore:k,loader:{baseAttrs:{listeners:n},filter:function(a){a=a.getLayer();
return!0===a.displayInLayerSwitcher&&!1===a.isBaseLayer&&(void 0===a.dir||""===a.dir)}},leaf:!1,listeners:r,singleClickExpand:!0,expanded:e});var d=b.s3.dirs,h=d.length;if(h){GeoExt.tree.LayerLoaderS3=function(a){Ext.apply(this,a);GeoExt.tree.LayerLoaderS3.superclass.constructor.call(this)};Ext.extend(GeoExt.tree.LayerLoaderS3,GeoExt.tree.LayerLoader,{load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(this.removeStoreHandlers();a.firstChild;)a.removeChild(a.firstChild);this.uiProviders||
(this.uiProviders=a.getOwnerTree().getLoader().uiProviders);this.store||(this.store=GeoExt.MapPanel.guess().layers);this.store.each(function(b){this.addLayerNode(a,b)},this);this.addStoreHandlers(a);var c=a.attributes.children,d=c.length;if(d)for(var e,f,g=0;g<d;g++)e=c[g],e=new Ext.tree.TreePanel.nodeTypes[e.nodeType](e),(f=a.item(0))?a.insertBefore(e,f):a.appendChild(e);"function"==typeof b&&b();this.fireEvent("load",this,a)}}});var l,t,s,B,v,c={},w,u,y;for(w=0;w<h;w++)for(s=d[w],B=s.split("/"),
v=B.length,u=0;u<v;u++)t=0==u?c:t[l],l=B[u],t.hasOwnProperty(l)||(t[l]={});for(s in c){l=c[s];t=[];for(y in l)l={listeners:n},f&&(l.checkedGroup=y),l=new GeoExt.tree.LayerLoaderS3({baseAttrs:l,filter:function(a,b){return function(c){if("undefined"!==c.data.layer.dir)return c.data.layer.dir===a+"/"+b}}(s,y)}),l={text:y,nodeType:"gx_layercontainer",layerStore:k,children:[],loader:l,leaf:!1,listeners:r,singleClickExpand:!0,expanded:e},t.push(l);l={listeners:n};f&&(l.checkedGroup=s);l=new GeoExt.tree.LayerLoaderS3({baseAttrs:l,
filter:function(a){return function(b){if("undefined"!==b.data.layer.dir)return b.data.layer.dir===a}}(s)});l={text:s,nodeType:"gx_layercontainer",layerStore:k,children:t,loader:l,leaf:!1,listeners:r,singleClickExpand:!0,expanded:e};m.push(l)}}e=new Ext.tree.AsyncTreeNode({expanded:!0,children:m});f=i18n.gis_properties||i18n.gis_uploadlayer?new Ext.Toolbar:null;g=new Ext.tree.TreePanel({title:i18n.gis_layers,loaderloader:new Ext.tree.TreeLoader({applyLoader:!1}),root:e,rootVisible:!1,split:!0,collapsible:g,
collapseMode:"mini",lines:!1,tbar:f,enableDD:!1});new Ext.tree.TreeSorter(g,{sortType:function(a,b){return"gx_baselayercontainer"==b.attributes.nodeType?" ":"gx_overlaylayercontainer"==b.attributes.nodeType?"!":b.text}});i18n.gis_uploadlayer&&oa(b,g);i18n.gis_properties&&pa(b,g);return g},da=function(b){var a=b.s3.options,c=new Ext.tree.AsyncTreeNode({expanded:!0,loader:new GeoExt.tree.WMSCapabilitiesLoader({url:OpenLayers.ProxyHost+a.wms_browser_url,layerOptions:{buffer:1,singleTile:!1,ratio:1,wrapDateLine:!0},
layerParams:{TRANSPARENT:"TRUE"},createNode:function(a){a.checked=a.leaf?!1:void 0;return GeoExt.tree.WMSCapabilitiesLoader.prototype.createNode.apply(this,[a])}})});return new Ext.tree.TreePanel({title:a.wms_browser_name,root:c,rootVisible:!1,split:!0,autoScroll:!0,collapsible:!0,collapseMode:"mini",lines:!1,listeners:{checkchange:function(a,c){!0===c?b.addLayer(a.attributes.layer):b.removeLayer(a.attributes.layer)}}})},z=function(b){var a=b.object;b=a.map.s3;$("#"+b.id+" .layer_throbber").show().removeClass("hide");
a=a.s3_layer_id;b=b.layers_loading;b.pop(a);b.push(a)},I=function(b){var a=b.map.s3,c=a.layers_loading;c.pop(b.s3_layer_id);0===c.length&&$("#"+a.id+" .layer_throbber").hide().addClass("hide")},A=function(b){I(b.object);void 0!=b.response&&509==b.response.priv.status&&S3.showAlert(i18n.gis_too_many_features,"warning")},C=function(b){R(b.object.map)},aa=function(b){var a=b.s3,c=a.options;a.all_popup_layers=[];a.dirs=[];a.layers_loading=[];if(c.layers_osm)for(var d=c.layers_osm,a=d.length;0<a;a--)qa(b,
d[a-1]);try{google&ra(b)}catch(e){}c.Bing&&sa(b);if(c.layers_tms)for(d=c.layers_tms,a=d.length;0<a;a--)ta(b,d[a-1]);if(c.layers_wms)for(d=c.layers_wms,a=d.length;0<a;a--)ua(b,d[a-1]);if(c.layers_xyz)for(d=c.layers_xyz,a=d.length;0<a;a--)va(b,d[a-1]);c.EmptyLayer&&(a=new OpenLayers.Layer(c.EmptyLayer.name,{isBaseLayer:!0,displayInLayerSwitcher:!0,s3_layer_id:c.EmptyLayer.id,s3_layer_type:"empty"}),b.addLayer(a),c.EmptyLayer.base&&b.setBaseLayer(a));if(c.layers_js)for(d=c.layers_js,a=d.length;0<a;a--)eval(b,
d[a-1]);if(c.layers_theme)for(d=c.layers_theme,a=d.length;0<a;a--)x(b,d[a-1]);if(c.layers_geojson)for(d=c.layers_geojson,a=d.length;0<a;a--)x(b,d[a-1]);if(c.layers_gpx)for(d=c.layers_gpx,a=d.length;0<a;a--)wa(b,d[a-1]);if(c.layers_arcrest)for(d=c.layers_arcrest,a=d.length;0<a;a--)xa(b,d[a-1]);c.CoordinateGrid&&ya(b);if(c.layers_georss)for(d=c.layers_georss,a=d.length;0<a;a--)x(b,d[a-1]);if(c.layers_kml)for(d=c.layers_kml,a=d.length;0<a;a--)za(b,d[a-1]);c.OWM&&Aa(b);if(c.layers_shapefile)for(d=c.layers_shapefile,
a=d.length;0<a;a--)x(b,d[a-1]);if(c.layers_wfs)for(d=c.layers_wfs,a=d.length;0<a;a--)Ba(b,d[a-1]);if(c.feature_queries)for(d=c.feature_queries,a=d.length;0<a;a--)x(b,d[a-1]);if(c.feature_resources)for(d=c.feature_resources,a=d.length;0<a;a--)x(b,d[a-1]);if(c.layers_feature)for(d=c.layers_feature,a=d.length;0<a;a--)x(b,d[a-1]);if(c.features||c.draw_feature||c.draw_polygon||navigator.geolocation)var f=Ca(b);if(c.features)for(c=c.features,b=b.getProjectionObject(),a=0;a<c.length;a++)d=G.parseFeature(c[a]),
d.geometry.transform(v,b),f.addFeatures([d])},xa=function(b,a){var c=a.name,d=[a.url],e=void 0!=a.layers?a.layers.join():0;if(void 0!=a.dir){var f=a.dir;-1==$.inArray(f,b.s3.dirs)&&b.s3.dirs.push(f)}else f="";var g=void 0!=a.visibility?a.visibility:!0,c=new OpenLayers.Layer.ArcGIS93Rest(c,d,{layers:"show:"+e,isBaseLayer:void 0!=a.base?a.base:!1,transparent:void 0!=a.transparent?a.transparent:!0,dir:f,s3_layer_id:a.id,s3_layer_type:"arcrest"});c.setVisibility(g);b.addLayer(c);a._base&&b.setBaseLayer(c)},
sa=function(b){var a=b.s3.options.Bing,c=a.ApiKey,d;a.Aerial&&(d=new OpenLayers.Layer.Bing({key:c,type:"Aerial",name:a.Aerial.name,s3_layer_id:a.Aerial.id,s3_layer_type:"bing"}),b.addLayer(d),"aerial"==a.Base&&b.setBaseLayer(d));a.Road&&(d=new OpenLayers.Layer.Bing({key:c,type:"Road",name:a.Road.name,s3_layer_id:a.Road.id,s3_layer_type:"bing"}),b.addLayer(d),"road"==a.Base&&b.setBaseLayer(d));a.Hybrid&&(d=new OpenLayers.Layer.Bing({key:c,type:"AerialWithLabels",name:a.Hybrid.name,s3_layer_id:a.Hybrid.id,
s3_layer_type:"bing"}),b.addLayer(d),"hybrid"==a.Base&&b.setBaseLayer(d))},ya=function(b){var a=b.s3.options.CoordinateGrid;b.addLayer(new OpenLayers.Layer.cdauth.CoordinateGrid(null,{name:a.name,shortName:"grid",visibility:a.visibility,s3_layer_id:a.id,s3_layer_type:"coordinate"}))},Ca=function(b){var a=b.s3.options;if(a.draw_polygon&&!a.draw_feature)var c;else c=a.marker_default;a=D(b,{marker:c});a=new OpenLayers.Layer.Vector(i18n.gis_draft_layer,{displayInLayerSwitcher:!1,legendURL:a[1],styleMap:a[0]});
a.setVisibility(!0);b.addLayer(a);return b.s3.draftLayer=a},x=function(b,a){var c=a.name,d=a.url,e=void 0!=a.refresh?a.refresh:900;if(void 0!=a.dir){var f=a.dir;-1==$.inArray(f,b.s3.dirs)&&b.s3.dirs.push(f)}else f="";var g=void 0!=a.visibility?a.visibility:!0,k=void 0!=a.cluster_attribute?a.cluster_attribute:"colour",m=void 0!=a.cluster_distance?a.cluster_distance:20,n=void 0!=a.cluster_threshold?a.cluster_threshold:2,p=void 0!=a.projection?a.projection:4326,p=4326==p?v:new OpenLayers.Projection("EPSG:"+
p),r=void 0!=a.type?a.type:"feature",h='<div class="gis_layer_legend"><div class="gis_legend_title">'+c+"</div>";void 0!=a.desc&&(h+='<div class="gis_legend_desc">'+a.desc+"</div>");if(void 0!=a.src||void 0!=a.src_url){var l='<div class="gis_legend_src">';void 0!=a.src_url?(l+='<a href="'+a.src_url+'" target="_blank">',l=void 0!=a.src?l+a.src:l+a.src_url,l+="</a>"):l+=a.src;h+=l+"</div>"}var h=h+"</div>",t=D(b,a),l=t[0],t=t[1],s=[new OpenLayers.Strategy.BBOX({ratio:1.5})];e&&s.push(new OpenLayers.Strategy.Refresh({force:!0,
interval:1E3*e}));n&&s.push(new OpenLayers.Strategy.AttributeCluster({attribute:k,distance:m,threshold:n}));c=new OpenLayers.Layer.Vector(c,{dir:f,projection:p,protocol:new OpenLayers.Protocol.HTTP({url:d,format:G}),strategies:s,legendURL:t,styleMap:l,s3_layer_id:a.id,s3_layer_type:r,s3_style:a.style});c.legendTitle=h;c.setVisibility(g);c.events.on({featureselected:E,featureunselected:F,loadstart:z,loadend:A,visibilitychanged:C});b.addLayer(c);void 0==a.no_popups&&b.s3.all_popup_layers.push(c)},ra=
function(b){var a=b.s3.options.Google,c;a.MapMaker||a.MapMakerHybrid?(a.Satellite&&(c=new OpenLayers.Layer.Google(a.Satellite.name,{type:G_SATELLITE_MAP,sphericalMercator:!0,s3_layer_id:a.Satellite.id,s3_layer_type:"google"}),b.addLayer(c),"satellite"==a.Base&&b.setBaseLayer(c)),a.Maps&&(c=new OpenLayers.Layer.Google(a.Maps.name,{type:G_NORMAL_MAP,sphericalMercator:!0,s3_layer_id:a.Maps.id,s3_layer_type:"google"}),b.addLayer(c),"maps"==a.Base&&b.setBaseLayer(c)),a.Hybrid&&(c=new OpenLayers.Layer.Google(a.Hybrid.name,
{type:G_HYBRID_MAP,sphericalMercator:!0,s3_layer_id:a.Hybrid.id,s3_layer_type:"google"}),b.addLayer(c),"maps"==a.Base&&b.setBaseLayer(c)),a.Terrain&&(c=new OpenLayers.Layer.Google(a.Terrain.name,{type:G_PHYSICAL_MAP,sphericalMercator:!0,s3_layer_id:a.Terrain.id,s3_layer_type:"google"}),b.addLayer(c),"terrain"==a.Base&&b.setBaseLayer(c)),a.MapMaker&&(c=new OpenLayers.Layer.Google(a.MapMaker.name,{type:G_MAPMAKER_NORMAL_MAP,sphericalMercator:!0,s3_layer_id:c.id,s3_layer_type:"google"}),b.addLayer(c),
"mapmaker"==a.Base&&b.setBaseLayer(c)),a.MapMakerHybrid&&(c=new OpenLayers.Layer.Google(a.MapMakerHybrid.name,{type:G_MAPMAKER_HYBRID_MAP,sphericalMercator:!0,s3_layer_id:c.id,s3_layer_type:"google"}),b.addLayer(c),"mapmakerhybrid"==a.Base&&b.setBaseLayer(c))):(a.Satellite&&(c=new OpenLayers.Layer.Google(a.Satellite.name,{type:"satellite",numZoomLevels:22,s3_layer_id:a.Satellite.id,s3_layer_type:"google"}),b.addLayer(c),"satellite"==a.Base&&b.setBaseLayer(c)),a.Maps&&(c=new OpenLayers.Layer.Google(a.Maps.name,
{numZoomLevels:20,s3_layer_id:a.Maps.id,s3_layer_type:"google"}),b.addLayer(c),"maps"==a.Base&&b.setBaseLayer(c)),a.Hybrid&&(c=new OpenLayers.Layer.Google(a.Hybrid.name,{type:"hybrid",numZoomLevels:20,s3_layer_id:a.Hybrid.id,s3_layer_type:"google"}),b.addLayer(c),"hybrid"==a.Base&&b.setBaseLayer(c)),a.Terrain&&(c=new OpenLayers.Layer.Google(a.Terrain.name,{type:"terrain",s3_layer_id:a.Terrain.id,s3_layer_type:"google"}),b.addLayer(c),"terrain"==a.Base&&b.setBaseLayer(c)))},wa=function(b,a){var c=
a.name,d=a.url,e=a.marker,f=J+e.i,g=e.h,k=e.w,m=void 0!=a.waypoints?a.waypoints:!0,n=void 0!=a.tracks?a.tracks:!0,p=void 0!=a.routes?a.routes:!0,e=void 0!=a.visibility?a.visibility:!0;if(void 0!=a.dir){var r=a.dir;-1==$.inArray(r,b.s3.dirs)&&b.s3.dirs.push(r)}else r="";var h=void 0!=a.opacity?a.opacity:1,l=void 0!=a.cluster_distance?a.cluster_distance:20,t=void 0!=a.cluster_threshold?a.cluster_threshold:2,s=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);m?(s.graphicOpacity=
h,s.graphicWidth=k,s.graphicHeight=g,s.graphicXOffset=-(k/2),s.graphicYOffset=-g,s.externalGraphic=f):s.externalGraphic="";s.strokeColor="blue";s.strokeWidth=6;s.strokeOpacity=h;c=new OpenLayers.Layer.Vector(c,{dir:r,projection:v,strategies:[new OpenLayers.Strategy.Fixed,new OpenLayers.Strategy.Cluster({distance:l,threshold:t})],legendURL:f,s3_layer_id:a.id,s3_layer_type:"gpx",style:s,protocol:new OpenLayers.Protocol.HTTP({url:d,format:new OpenLayers.Format.GPX({extractAttributes:!0,extractWaypoints:m,
extractTracks:n,extractRoutes:p})})});c.setVisibility(e);c.events.on({featureselected:E,featureunselected:F,loadstart:z,loadend:A,visibilitychanged:C});b.addLayer(c);b.s3.all_popup_layers.push(c)},za=function(b,a){var c=b.s3,d=a.name,e=a.url,f=void 0!=a.title?a.title:"name",g=void 0!=a.body?a.body:"description",k=void 0!=a.refresh?a.refresh:900,m=void 0!=a.visibility?a.visibility:!0;if(void 0!=a.dir){var n=a.dir;-1==$.inArray(n,c.dirs)&&c.dirs.push(n)}else n="";var p=void 0!=a.cluster_distance?a.cluster_distance:
20,r=void 0!=a.cluster_threshold?a.cluster_threshold:2,h=D(b,a)[0],l=new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,maxDepth:2}),t=[new OpenLayers.Strategy.Fixed];k&&t.push(new OpenLayers.Strategy.Refresh({force:!0,interval:1E3*k}));r&&t.push(new OpenLayers.Strategy.Cluster({distance:p,threshold:r}));d=new OpenLayers.Layer.Vector(d,{dir:n,projection:v,protocol:new OpenLayers.Protocol.HTTP({url:e,format:l}),strategies:t,styleMap:h,s3_layer_id:a.id,s3_layer_type:"kml",s3_style:a.style});
d.title=f;d.body=g;d.setVisibility(m);d.events.on({featureselected:E,featureunselected:F,loadstart:z,loadend:A,visibilitychanged:C});b.addLayer(d);c.all_popup_layers.push(d)},qa=function(b,a){var c=a.name,d=[a.url1];void 0!=a.url2&&d.push(a.url2);void 0!=a.url3&&d.push(a.url3);var e=void 0!=a.visibility?a.visibility:!0;if(void 0!=a.dir){var f=a.dir;-1==$.inArray(f,b.s3.dirs)&&b.s3.dirs.push(f)}else f="";c=new OpenLayers.Layer.TMS(c,d,{dir:f,type:"png",getURL:Da,displayOutsideMaxExtent:!0,numZoomLevels:void 0!=
a.zoomLevels?a.zoomLevels:19,isBaseLayer:void 0!=a.base?a.base:!0,s3_layer_id:a.id,s3_layer_type:"openstreetmap"});void 0!=a.attribution&&(c.attribution=a.attribution);c.setVisibility(e);b.addLayer(c);a._base&&b.setBaseLayer(c)},Da=function(b){var a=this.map.getResolution(),c=Math.round((b.left-this.maxExtent.left)/(a*this.tileSize.w));b=Math.round((this.maxExtent.top-b.top)/(a*this.tileSize.h));var a=this.map.getZoom(),d=Math.pow(2,a);if(0>b||b>=d)return OpenLayers.Util.getImagesLocation()+"404.png";
c=a+"/"+(c%d+d)%d+"/"+b+"."+this.type;b=this.url;b instanceof Array&&(b=this.selectUrl(c,b));return b+c},Aa=function(b){var a=b.s3.options.OWM,c;a.station&&(c=new OpenLayers.Layer.Vector.OWMStations(a.station.name,{dir:a.station.dir,s3_layer_id:a.station.id,s3_layer_type:"openweathermap"}),c.setVisibility(a.station.visibility),c.events.on({featureselected:c.onSelect,featureunselected:c.onUnselect,loadstart:z,loadend:A,visibilitychanged:C}),b.addLayer(c),b.s3.all_popup_layers.push(c));a.city&&(c=new OpenLayers.Layer.Vector.OWMWeather(a.city.name,
{dir:a.city.dir,s3_layer_id:a.city.id,s3_layer_type:"openweathermap"}),c.setVisibility(a.city.visibility),c.events.on({featureselected:c.onSelect,featureunselected:c.onUnselect,loadstart:z,loadend:A,visibilitychanged:C}),b.addLayer(c),b.s3.all_popup_layers.push(c))},ta=function(b,a){var c=a.name,d=[a.url];void 0!=a.url2&&d.push(a.url2);void 0!=a.url3&&d.push(a.url3);var e=a.layername,f=void 0!=a.zoomLevels?a.zoomLevels:19;if(void 0!=a.dir){var g=a.dir;-1==$.inArray(g,b.s3.dirs)&&b.s3.dirs.push(g)}else g=
"";c=new OpenLayers.Layer.TMS(c,d,{dir:g,s3_layer_id:a.id,s3_layer_type:"tms",layername:e,type:void 0!=a.format?a.format:"png",numZoomLevels:f});void 0!=a.attribution&&(c.attribution=a.attribution);b.addLayer(c);a._base&&b.setBaseLayer(c)},Ba=function(b,a){var c=a.name,d=a.url;void 0!=a.username&&void 0!=a.password&&(d=d.replace("://","://"+a.username+":"+a.password+"@"));var e=a.title,f=a.featureType,g=void 0!=a.featureNS?a.featureNS:null,k=void 0!=a.schema?a.schema:null,m=void 0!=a.version?a.version:
"1.1.0",n=void 0!=a.geometryName?a.geometryName:"the_geom",p=void 0!=a.visibility?a.visibility:!0;if(void 0!=a.dir){var r=a.dir;-1==$.inArray(r,b.s3.dirs)&&b.s3.dirs.push(r)}else r="";var h=void 0!=a.cluster_attribute?a.cluster_attribute:"colour",l=void 0!=a.cluster_distance?a.cluster_distance:20,t=void 0!=a.cluster_threshold?a.cluster_threshold:2,s=void 0!=a.refresh?a.refresh:!1,B=[new OpenLayers.Strategy.BBOX({ratio:1.5})];s&&B.push(new OpenLayers.Strategy.Refresh({force:!0,interval:1E3*s}));t&&
B.push(new OpenLayers.Strategy.AttributeCluster({attribute:h,distance:l,threshold:t}));void 0!=a.projection?(h=a.projection,l="EPSG:"+h):(h="4326",l="EPSG:4326");f=new OpenLayers.Protocol.WFS({version:m,srsName:l,url:d,featureType:f,featureNS:g,geometryName:n,schema:k});d='<div class="gis_layer_legend"><div class="gis_legend_title">'+c+"</div>";void 0!=a.desc&&(d+='<div class="gis_legend_desc">'+a.desc+"</div>");if(void 0!=a.src||void 0!=a.src_url)g='<div class="gis_legend_src">',void 0!=a.src_url?
(g+='<a href="'+a.src_url+'" target="_blank">',g=void 0!=a.src?g+a.src:g+a.src_url,g+="</a>"):g+=a.src,d+=g+"</div>";d+="</div>";k=D(b,a);g=k[0];k=k[1];h="4326"==h?v:new OpenLayers.Projection("EPSG:"+h);c=new OpenLayers.Layer.Vector(c,{maxFeatures:1E3,strategies:B,dir:r,legendURL:k,projection:h,protocol:f,styleMap:g,s3_layer_id:a.id,s3_layer_type:"wfs",s3_style:a.style});c.legendTitle=d;c.title=e;c.setVisibility(p);c.events.on({featureselected:E,featureunselected:F,loadstart:z,loadend:A,visibilitychanged:C});
b.addLayer(c);b.s3.all_popup_layers.push(c)},ua=function(b,a){var c=a.name,d=a.url;a.username&&a.password&&(d=d.replace("://","://"+a.username+":"+a.password+"@"));var e=a.layers,f=void 0!=a.visibility?a.visibility:!0;if(void 0!=a.dir){var g=a.dir;-1==$.inArray(g,b.s3.dirs)&&b.s3.dirs.push(g)}else g="";var k=void 0!=a.base?a.base:!1,m=void 0!=a.transparent?a.transparent:!0,n=void 0!=a.format?a.format:"image/png",p=void 0!=a.version?a.version:"1.1.1",r=a.map?a.map:"",h=a.style?a.style:"",l=void 0!=
a.bgcolor?"0x"+a.bgcolor:"",t=void 0!=a.buffer?a.buffer:0,s=void 0!=a.tiled?a.tiled:!1,v=void 0!=a.opacity?a.opacity:1,na=void 0!=a.queryable?a.queryable:1,w='<div class="gis_layer_legend"><div class="gis_legend_title">'+c+"</div>";void 0!=a.desc&&(w+='<div class="gis_legend_desc">'+a.desc+"</div>");if(b.s3.options.metadata){if(void 0!=a.post_id)if(i18n.gis_metadata)var u=i18n.gis_metadata,y=S3.Ap.concat("/cms/page/"+a.post_id);else u=i18n.gis_metadata_edit,y=S3.Ap.concat("/cms/post/"+a.post_id+"/update?layer_id="+
a.id);else i18n.gis_metadata_create?(u=i18n.gis_metadata_create,y=S3.Ap.concat("/cms/post/create?layer_id="+a.id)):u="";u&&(w+='<div class="gis_legend_src"><a href="'+y+'" target="_blank">'+u+"</a></div>")}else if(void 0!=a.src||void 0!=a.src_url)u='<div class="gis_legend_src">',void 0!=a.src_url?(u+='<a href="'+a.src_url+'" target="_blank">',u=void 0!=a.src?u+a.src:u+a.src_url,u+="</a>"):u+=a.src,u+="</div>",w+=u;w+="</div>";if(void 0!=a.legendURL)var x=a.legendURL;c=new OpenLayers.Layer.WMS(c,d,
{layers:e,transparent:m},{dir:g,wrapDateLine:!0,isBaseLayer:k,s3_layer_id:a.id,s3_layer_type:"wms",queryable:na,visibility:f});r&&(c.params.MAP=r);n&&(c.params.FORMAT=n);p&&(c.params.VERSION=p);h&&(c.params.STYLES=h);l&&(c.params.BGCOLOR=l);s&&(c.params.TILED=!0,c.params.TILESORIGIN=[b.maxExtent.left,b.maxExtent.bottom]);k||(c.opacity=v,c.buffer=t?t:0);c.legendTitle=w;x&&(c.legendURL=x);c.events.on({loadstart:z,loadend:A,visibilitychanged:C});b.addLayer(c);a._base&&b.setBaseLayer(c)},va=function(b,
a){var c=a.name,d=[a.url];void 0!=a.url2&&d.push(a.url2);void 0!=a.url3&&d.push(a.url3);var e=a.layername,f=void 0!=a.zoomLevels?a.zoomLevels:19;if(void 0!=a.dir){var g=a.dir;-1==$.inArray(g,b.s3.dirs)&&b.s3.dirs.push(g)}else g="";c=new OpenLayers.Layer.XYZ(c,d,{dir:g,s3_layer_id:a.id,s3_layer_type:"xyz",layername:e,type:void 0!=a.format?a.format:"png",numZoomLevels:f});void 0!=a.attribution&&(c.attribution=a.attribution);b.addLayer(c);a._base&&b.setBaseLayer(c)},ba=function(b){var a=b.s3.options,
c=new OpenLayers.Control.Navigation;a.no_zoom_wheel&&(c.zoomWheelEnabled=!1);b.addControl(c);void 0==a.zoomcontrol&&b.addControl(new OpenLayers.Control.Zoom);b.addControl(new OpenLayers.Control.ArgParser);b.addControl(new OpenLayers.Control.Attribution);void 0==a.scaleline&&b.addControl(new OpenLayers.Control.ScaleLine);"mgrs"==a.mouse_position?b.addControl(new OpenLayers.Control.MGRSMousePosition):a.mouse_position&&b.addControl(new OpenLayers.Control.MousePosition);void 0==a.permalink&&b.addControl(new OpenLayers.Control.Permalink);
if(void 0==a.overview){var a={},c=b.options,d;for(d in c)"controls"!=d&&(a[d]=c[d]);b.addControl(new OpenLayers.Control.OverviewMap({mapOptions:a}))}Ea(b)},Ea=function(b){OpenLayers.Handler.FeatureS3=OpenLayers.Class(OpenLayers.Handler.Feature,{dblclick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy);return!1},CLASS_NAME:"OpenLayers.Handler.FeatureS3"});var a=b.s3,c=a.all_popup_layers,d=new OpenLayers.Control.SelectFeature(c,{toggle:!0});d.handlers.feature=new OpenLayers.Handler.FeatureS3(d,d.layer,
d.callbacks,{geometryTypes:d.geometryTypes});c=new OpenLayers.Control.SelectFeature(c,{hover:!0,highlightOnly:!0,eventListeners:{featurehighlighted:Fa,featureunhighlighted:S}});b.addControl(c);b.addControl(d);c.activate();d.activate();a.popupControl=d},Fa=function(b){var a=b.feature,c=a.layer.map;S3.gis.maps[c.s3.id].tooltipTimeout=setTimeout(function(){if(!a.cluster){var b=c.s3.lastFeature,e=c.s3.tooltipPopup;if(null===a.popup){null!==e&&void 0!==e&&(c.removePopup(e),e.destroy(),null!==b&&delete b.popup,
e=null);var b=a.geometry.getBounds().getCenterLonLat(),f=a.attributes,g;void 0!=f.popup?g=f.popup:void 0!=f.name?g=f.name:void 0!=a.layer.title&&(g=f[a.layer.title],g="object"==typeof g?g.value:g);g&&(e=new OpenLayers.Popup("activetooltip",b,new OpenLayers.Size(80,12),g,!1));null!==e&&void 0!==e&&(e.contentDiv.style.backgroundColor="ffffcb",e.contentDiv.style.overflow="hidden",e.contentDiv.style.padding="3px",e.contentDiv.style.margin="10px",e.closeOnMove=!0,e.autoSize=!0,e.opacity=0.7,a.popup=e,
c.addPopup(e))}}},500)},S=function(b){b=b.feature;var a=b.layer.map;clearTimeout(S3.gis.maps[a.s3.id].tooltipTimeout);null!==b&&null!==b.popup&&(a.removePopup(b.popup),b.popup.destroy(),delete b.popup,a.s3.tooltipPopup=null,a.s3.lastFeature=null)},U=function(b,a,c,d,e){void 0==d&&(d=S3.uid());e?(0===a.indexOf("http://")&&(a=OpenLayers.ProxyHost+encodeURIComponent(a)),c='<iframe src="'+a+'" onload="S3.gis.popupLoaded(\''+d+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>'):
void 0==c&&(c=i18n.gis_loading+'...<div class="throbber"></div>');var f=b.geometry.getBounds().getCenterLonLat();c=new OpenLayers.Popup.FramedCloud(d,f,new OpenLayers.Size(400,400),c,null,!0,Ga);b.popup=c;c.feature=b;b.layer.map.addPopup(c);e||void 0==a||T(a,d+"_contentDiv",c);return c};S3.gis.addPopup=U;S3.gis.popupLoaded=function(b){$("#"+b+"_contentDiv iframe").contents().find("#popup form").show();var a=S3.gis.maps,c,d,e,f,g;for(c in a)for(d=a[c],e=d.popups,f=0,g=e.length;f<g;f++)d=e[f],d.id==
b&&d.updateSize(!0)};var T=function(b,a,c){0===b.indexOf("http://")&&(b=OpenLayers.ProxyHost+encodeURIComponent(b));$.ajaxS3({url:b,dataType:"html",success:function(b){try{$("#"+a).html(b),c.updateSize()}catch(e){}},error:function(b,e,f){msg="UNAUTHORIZED"==f?i18n.gis_requires_login:b.responseText;$("#"+a+"_contentDiv").html(msg);c.updateSize()}})},E=function(b){S(b);b=b.feature;var a=b.layer,c=a.s3_layer_type,d=a.map,e=b.geometry.getBounds().getCenterLonLat(),f=S3.uid(),a=void 0!=a.title?a.title:
"name",g,k,m;if(b.cluster){c=b.cluster;g=i18n.gis_cluster_multiple+":<ul>";for(var n=c.length,p=d.s3.id,r=0;r<n;r++){var h=c[r].attributes,d=void 0!=h.popup?h.popup.split("<br />",1)[0]:h[a];g=void 0!=h.url?g+("<li><a href='javascript:S3.gis.loadClusterPopup(\""+p+'", "'+h.url+'", "'+f+"\")'>"+d+"</a></li>"):g+("<li>"+d+"</li>")}g+="</ul>";g+="<div align='center'><a href='javascript:S3.gis.zoomToSelectedFeature(\""+p+'", '+e.lon+","+e.lat+", 3)'>"+i18n.gis_zoomin+"</a></div>"}else if("kml"==c){h=
b.attributes;if(void 0!=b.style.balloonStyle)g=b.style.balloonStyle.replace(/{([^{}]*)}/g,function(a,b){var c=h[b];return"string"===typeof c||"number"===typeof c?c:a});else{c=typeof h[a];d="object"==c?h[a].value:h[a];g="<h3>"+d+"</h3>";for(var d=b.layer.body.split(" "),l,e=0;e<d.length;e++)c=typeof h[d[e]],"object"==c?(a=h[d[e]].displayName,""===a&&(a=d[e]),c=h[d[e]].value,l='<div class="gis_popup_row"><div class="gis_popup_label">'+a+':</div><div class="gis_popup_cell">'+c+"</div></div>"):l=void 0!=
h[d[e]]?'<div class="gis_popup_row">'+h[d[e]]+"</div>":"",g+=l}-1!=g.search("<script")&&(g="Content contained Javascript! Escaped content below.<br />"+g.replace(/</g,"<"))}else if("gpx"!=c)if("shapefile"==c)h=b.attributes,g="<div>",$.each(h,function(a,b){"id_orig"==a&&(a="id");l='<div class="gis_popup_row"><div class="gis_popup_label">'+a+':</div><div class="gis_popup_cell">'+b+"</div></div>";g+=l}),g+="</div>";else if("wfs"==c)h=b.attributes,d=h[a],g="<h3>"+d+"</h3>",$.each(h,function(a,b){l='<div class="gis_popup_row"><div class="gis_popup_label">'+
a+':</div><div class="gis_popup_val">'+b+"</div></div>";g+=l});else if(void 0!=b.attributes.url)m=b.attributes.url;else{h=b.attributes;d=void 0==h.name?"":"<h3>"+h.name+"</h3>";e=void 0==h.description?"":"<p>"+h.description+"</p>";a=void 0==h.link?"":'<a href="'+h.link+'" target="_blank">'+h.link+"</a>";if(void 0==h.data)c="";else if(0===h.data.indexOf("http://")){k=!0;var t=S3.uid(),c='<div id="'+t+'">'+i18n.gis_loading+"...<div class='throbber'></div></div>"}else c="<p>"+h.data+"</p>";n=void 0==
h.image?"":0===h.image.indexOf("http://")?'<img src="'+h.image+'" height=300 width=300>':"";g=d+e+a+c+n}m=U(b,m,g,f);k&&T(b.attributes.data,t,m)},F=function(b){b=b.feature;b.popup&&(b.layer.map.removePopup(b.popup),b.popup.destroy(),delete b.popup)},Ga=function(b){b=this.map;this.feature&&(delete this.feature.popup,b.s3.popupControl.unselect(this.feature));for(;b.popups.length;)b.removePopup(b.popups[0])};S3.gis.loadClusterPopup=function(b,a,c){var d="#"+c+"_contentDiv",e=$(d);e.html(i18n.gis_loading+
"...<div class='throbber'></div>");var f=S3.gis.maps[b];$.getS3(a,function(a){e.html(a);f.popups[0].updateSize();a=$(d+" .dropdown-toggle");a.length&&(e.parent().css("overflow","visible").parent().css("overflow","visible"),a.dropdown())},"html")};S3.gis.zoomToSelectedFeature=function(b,a,c,d){b=S3.gis.maps[b];a=new OpenLayers.LonLat(a,c);d=b.getZoom()+d;b.setCenter(a,d);for(d=0;d<b.popups.length;d++)b.removePopup(b.popups[d])};var fa=function(b){var a=b.map,c=a.s3.draftLayer,d={fillColor:"#000",fillOpacity:0.1,
strokeWidth:0},e=new OpenLayers.Control.Geolocate({geolocationOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:7E3}});a.addControl(e);e.events.register("locationupdated",this,function(b){c.removeAllFeatures();var e=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(b.point.x,b.point.y),b.position.coords.accuracy/2,40,0),{},d);c.addFeatures([new OpenLayers.Feature.Vector(b.point,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:2,fillOpacity:0,
pointRadius:10}),e]);a.zoomToExtent(c.getDataExtent());Ha(a,e)});e.events.register("locationfailed",this,function(){OpenLayers.Console.log("Location detection failed")});var f=new Ext.Toolbar.Button({iconCls:"geolocation",tooltip:i18n.gis_geoLocate,handler:function(){c.removeAllFeatures();e.activate()}});b.addButton(f)},Ha=function(b,a){var c=a.geometry.getCentroid(),d=a.geometry.getBounds(),e=Math.abs((d.right-d.left)/2),f=0,g="up";window.resizeInterval=window.setInterval(function(){16<f&&clearInterval(window.resizeInterval);
var d=0.03*e/e;switch(f){case 4:case 12:g="down";break;case 8:g="up"}"up"!==g&&(d=-Math.abs(d));a.geometry.resize(1+d,c);b.s3.draftLayer.drawFeature(a);f++},50,c,e)},la=function(b){var a=b.map,c=a.s3,d=new Ext.Toolbar.Button({iconCls:"googleearth",tooltip:c.options.Google.Earth,enableToggle:!0,toggleHandler:function(b,d){!0===d?(c.mapPanelContainer.getLayout().setActiveItem(1),c.mapWin.items.items[0].collapse(),c.googleEarthPanel.on("pluginready",function(){var b=a.s3.options.layers_feature;if(b)for(var c=
0;c<b.length;c++){var d=b[c];if(void 0!=d.visibility?d.visibility:1)d=S3.public_url+d.url.replace("geojson","kml"),google.earth.fetchKml(a.s3.googleEarthPanel.earth,d,Ia)}})):(c.mapPanelContainer.getLayout().setActiveItem(0),c.mapWin.items.items[0].expand())}});b.addSeparator();b.addButton(d)},Ia=function(b){b&&S3.gis.googleEarthPanel.earth.getFeatures().appendChild(b)},ka=function(b){var a=b.map;StreetviewClicker=new (OpenLayers.Class(OpenLayers.Control,{defaults:{pixelTolerance:1,stopSingle:!0},
initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaults);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(b){(b=a.getLonLatFromViewPortPx(b.xy))||(b=a.getCenter());a.s3.sv_popup&&a.s3.sv_popup.anc&&a.s3.sv_popup.close();a.s3.sv_popup=new GeoExt.Popup({title:a.s3.options.Google.StreetviewTitle,location:b,width:300,height:300,collapsible:!0,map:a.s3.mapPanel,
items:[new gxp.GoogleStreetViewPanel]});a.s3.sv_popup.show()}}))({autoactivate:!1});a.addControl(StreetviewClicker);var c=new Ext.Toolbar.Button({iconCls:"streetview",tooltip:a.s3.options.Google.StreetviewButton,allowDepress:!0,enableToggle:!0,toggleGroup:"controls",toggleHandler:function(a,b){!0===b?StreetviewClicker.activate():StreetviewClicker.deactivate()}});b.addSeparator();b.addButton(c)},ha=function(b){var a=b.map,c=new OpenLayers.Style;c.addRules([new OpenLayers.Rule({symbolizer:{Point:{pointRadius:5,
graphicName:"circle",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#f5902e"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#f5902e",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#f5902e",fillColor:"white",fillOpacity:0.5}}})]);var c=new OpenLayers.StyleMap({"default":c}),d=new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:c}}});d.events.on({measure:function(a){alert(i18n.gis_length_message+
" "+a.measure.toFixed(2)+" "+a.units)}});d=new GeoExt.Action({control:d,map:a,iconCls:"measure-off",tooltip:i18n.gis_length_tooltip,allowDepress:!0,enableToggle:!0,toggleGroup:"controls"});b.add(d);!1===a.s3.options.area&&(c=new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:c}}}),c.events.on({measure:function(a){alert(i18n.gis_area_message+" "+a.measure.toFixed(2)+" "+a.units+"2")}}),a=new GeoExt.Action({control:c,map:a,iconCls:"measure-area",
tooltip:i18n.gis_area_tooltip,allowDepress:!0,enableToggle:!0,toggleGroup:"controls"}),b.add(a))},ea=function(b,a){var c=b.s3.id;$("#"+c).append('<div class="map_legend_div"><div class="map_legend_tab right"></div><div class="map_legend_panel"></div></div>');a=new GeoExt.LegendPanel({title:i18n.gis_legend,autoScroll:!0,border:!1});var d=$("#"+c+" .map_legend_panel"),d=Ext.get(d[0]);a.render(d);$("#"+c+" .map_legend_tab").click(function(){if($(this).hasClass("right")){var a=b.s3.id,c=$("#"+a+" .map_legend_panel").outerWidth();
$("#"+a+" .map_legend_div").animate({marginRight:"-"+c+"px"});$("#"+a+" .map_legend_tab").removeClass("right").addClass("left")}else R(b)})},R=function(b){b=b.s3.id;$("#"+b+" .map_legend_div").animate({marginRight:0});$("#"+b+" .map_legend_tab").removeClass("left").addClass("right")},O=function(b,a,c){OpenLayers.Handler.PointS3=OpenLayers.Class(OpenLayers.Handler.Point,{dblclick:function(a){return!0},CLASS_NAME:"OpenLayers.Handler.PointS3"});var d=b.s3.draftLayer,e=new OpenLayers.Control.DrawFeature(d,
OpenLayers.Handler.PointS3,{featureAdded:function(a){b.s3.lastDraftFeature?b.s3.lastDraftFeature.destroy():1<d.features.length&&d.features[0].destroy();void 0!=b.s3.pointPlaced&&b.s3.pointPlaced(a);b.s3.lastDraftFeature=a}});if(a){var f=new GeoExt.Action({control:e,handler:function(){f.items[0].pressed?$(".olMapViewport").addClass("crosshair"):$(".olMapViewport").removeClass("crosshair")},map:b,iconCls:"drawpoint-off",tooltip:i18n.gis_draw_feature,allowDepress:!0,enableToggle:!0,toggleGroup:"controls",
pressed:c});a.add(f);b.s3.pointButton=f}else b.addControl(e),c&&(e.activate(),$(".olMapViewport").addClass("crosshair"))},P=function(b,a,c){var d=b.s3.draftLayer,e=new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Path,{featureAdded:function(a){b.s3.lastDraftFeature?b.s3.lastDraftFeature.destroy():1<d.features.length&&d.features[0].destroy();b.s3.lastDraftFeature=a}});if(a){var f=new GeoExt.Action({control:e,handler:function(){f.items[0].pressed?$(".olMapViewport").addClass("crosshair"):$(".olMapViewport").removeClass("crosshair")},
map:b,iconCls:"drawline-off",tooltip:i18n.gis_draw_line,allowDepress:!0,enableToggle:!0,toggleGroup:"controls",pressed:c,activateOnEnable:!0,deactivateOnDisable:!0});a.add(f);b.s3.lineButton=f}else b.addControl(e),c&&(e.activate(),$(".olMapViewport").addClass("crosshair"))},Q=function(b,a,c,d){var e=b.s3.draftLayer;d=new OpenLayers.Control.DrawFeature(e,d?OpenLayers.Handler.Polygon:OpenLayers.Handler.RegularPolygon,{handlerOptions:d?{sides:4,snapAngle:90}:{},featureAdded:function(a){b.s3.lastDraftFeature?
b.s3.lastDraftFeature.destroy():1<e.features.length&&e.features[0].destroy();var c=$("#gis_location_wkt");if(c.length){var d=a.geometry.transform(b.getProjectionObject(),v).toString();c.val(d);$("#gis_location_lat").val("");$("#gis_location_lon").val("")}else c=$("#gis_search_polygon_input"),c.length&&(d=a.geometry.transform(b.getProjectionObject(),v).toString(),c.val(d).trigger("change"));b.s3.lastDraftFeature=a}});if(a){var f=new GeoExt.Action({control:d,handler:function(){f.items[0].pressed?$(".olMapViewport").addClass("crosshair"):
$(".olMapViewport").removeClass("crosshair")},map:b,iconCls:"drawpolygon-off",tooltip:i18n.gis_draw_polygon,allowDepress:!0,enableToggle:!0,toggleGroup:"controls",pressed:c,activateOnEnable:!0,deactivateOnDisable:!0});a.add(f);b.s3.polygonButton=f}else b.addControl(d),c&&(d.activate(),$(".olMapViewport").addClass("crosshair"))},ja=function(b){var a=b.map,c=new Ext.Toolbar.Button({iconCls:"potlatch",tooltip:i18n.gis_potlatch,handler:function(){var b=a.getZoom();if(14>b)alert(i18n.gis_osm_zoom_closer);
else{var c=a.getCenter();c.transform(a.getProjectionObject(),v);b=S3.Ap.concat("/gis/potlatch2/potlatch2.html")+"?lat="+c.lat+"&lon="+c.lon+"&zoom="+b;window.open(b)}}});b.addSeparator();b.addButton(c)},ga=function(b){var a=new Ext.Toolbar.Button({iconCls:"save",tooltip:i18n.gis_save,handler:function(){V(b.map)}});b.addSeparator();b.addButton(a)},ma=function(b){var a=b.s3,c=a.id;if(!$("#"+c+" .map_save_panel").length){var d='<div class="fleft"><div class="map_save_name">';(a=a.options.config_name)&&
(d+=a);d='<div class="map_save_panel off">'+(d+"</div></div>")+'<div class="btn map_save_button"><div class="map_save_label">'+i18n.gis_save_map+"</div></div></div>";$("#"+c).append(d);a&&$("#"+c+" .map_save_panel").removeClass("off");$("#"+c+" .map_save_button").click(function(){W(b)})}},W=function(b){var a=b.s3.id;$("#"+a+" .map_save_panel").removeClass("off");$("#"+a+" .map_save_panel .saved").remove();$("#"+a+" .map_save_panel .fleft").show();$("#"+a+" .map_save_label").html(i18n.save);X(b)},
X=function(b){var a=b.s3,c=a.id,d=a.options,e=d.config_id,f=d.config_name?d.config_name:"",g=$("#"+c+" .map_save_button"),k=c+"_save",a=$("#"+k);a.length||(a='<div class="hint">'+('<label for="'+k+'">'+i18n.gis_name_map+"</label>")+('<input id="'+k+'" value="'+f+'">')+"</div>",e='<div class="new_map"><input type="checkbox" class="checkbox"'+(e?"":' disabled="disabled" checked="checked"')+">"+i18n.gis_new_map+"</div>",$("#"+c+" .map_save_panel .fleft").html(a+e),$("#"+c+" .map_save_panel label").labelOver("over"));
g.unbind("click").click(function(){V(b);var a=$("#"+c+"_save").val();$("#"+c+" .map_save_name").html(a);d.config_name=a;a=d.pe_id?"?~.pe_id__belongs="+d.pe_id:"";a='<div class="saved"><p><i>'+i18n.saved+'</i></p><p><a href="'+S3.Ap.concat("/gis/config")+a+'">'+i18n.gis_my_maps+"</a></p></div>";$("#"+c+" .map_save_panel .fleft").hide().before(a);$("#"+c+" .map_save_panel .checkbox").prop("checked",!1).prop("disabled",!1);g.unbind("click").click(function(){W(b)})});var m=$("#"+c+" .map_save_panel");
$("html").unbind("click.cancelSave").bind("click.cancelSave",function(){m.addClass("off");g.unbind("click").click(function(){m.removeClass("off").unbind("click");X(b)})});m.click(function(a){a.stopPropagation()})},V=function(b){var a=Ja(b),c=Ext.util.JSON.encode,d=c(a.layers),c=c(a.plugins),a={lat:a.lat,lon:a.lon,zoom:a.zoom,layers:d,plugins:c};b=b.s3;var e=b.options;e.pe_id&&(a.pe_id=e.pe_id);d=b.id;c=$("#"+d+"_save");b=e.config_id;c.length?(a.name=c.val(),d=b?!$("#"+d+' .map_save_panel input[type="checkbox"]').prop("checked"):
!1):d=b?!0:!1;b=d?S3.Ap.concat("/gis/config/"+b+".url/update"):S3.Ap.concat("/gis/config.url/create");Ext.Ajax.request({url:b,method:"POST",success:function(a,b){var c=Ext.decode(a.responseText).message.split("=",2)[1];if(c){e.config_id=c;if(history.pushState)if(document.location.search)for(var d=document.location.search.split("?")[1].split("&"),n=[],p=0;p<d.length;p++){if(n=d[p].split("="),"config"==decodeURIComponent(n[0])&&decodeURIComponent(n[1])!=c){d[p]="config="+c;d=document.location.pathname+
"?"+d.join("&");window.history.pushState({},document.title,d);break}}else if(document.location.pathname==S3.Ap.concat("/gis/index")||document.location.pathname==S3.Ap.concat("/gis/map_viewing_client"))d=document.location.pathname+"?config="+c,window.history.pushState({},document.title,d);d=S3.Ap.concat("/gis/config/",c,"/layer_entity");$("#gis_menu_config").attr("href",d)}},params:a})},Ja=function(b){var a={},c=b.getCenter();c.transform(b.getProjectionObject(),v);a.lon=c.lon;a.lat=c.lat;a.zoom=b.getZoom();
var d=[],e,f,g=b.baseLayer.s3_layer_id;Ext.iterate(b.layers,function(a,b,c){e=a.s3_layer_id;f={id:e};a.visibility&&(f.visible=a.visibility);e==g&&(f.base=!0);a.s3_style&&(f.style=a.s3_style);d.push(f)});a.layers=d;var k=[];Ext.iterate(b.s3.plugins,function(a,b,c){a.getState&&k.push(a.getState())});a.plugins=k;return a},ia=function(b){var a=b.map,c=a.s3.options;selectPdfControl=new OpenLayers.Control;OpenLayers.Util.extend(selectPdfControl,{draw:function(){this.box=new OpenLayers.Handler.Box(this,
{done:this.getPdf});this.box.activate()},response:function(a){this.w.destroy();a=(new OpenLayers.Format.GML).read(a.responseText);var b=a.length+" pdfs. <br /><ul>";if(a.length)for(var c=0;c<a.length;c++)var d=a[c],b=b+("<li><a href='"+a[c].attributes.url+"'>"+(d.attributes.utm_zone+d.attributes.grid_zone+d.attributes.grid_square+d.attributes.easting+d.attributes.northing)+"</a></li>");this.w=new Ext.Window({html:b+"</ul>",width:300,title:"Results",height:200});this.w.show()},getPdf:function(b){var d=
a.getProjectionObject(),g=a.getLonLatFromPixel(new OpenLayers.Pixel(b.left,b.bottom)).transform(d,v);b=a.getLonLatFromPixel(new OpenLayers.Pixel(b.right,b.top)).transform(d,v);bbox=(new OpenLayers.Bounds(g.lon,g.lat,b.lon,b.lat)).toBBOX();OpenLayers.Request.GET({url:c.mgrs_url+"&bbox="+bbox,callback:OpenLayers.Function.bind(this.response,this)});this.w=new Ext.Window({html:"Searching "+c.mgrs_name+", please wait.",width:200,title:"Please Wait."});this.w.show()}});var d="Select "+c.mgrs_name,d=new GeoExt.Action({text:d,
control:selectPdfControl,map:a,allowDepress:!1,toggleGroup:"controls",tooltip:d});b.addSeparator();b.add(d)},oa=function(b,a){var c=new gxp.plugins.AddLayers({actionTarget:"treepanel.tbar",addActionTip:"Add layers",addActionMenuText:"Add layers",addServerText:"Add a New Server",doneText:"Done",upload:{url:null},uploadText:i18n.gis_uploadlayer,relativeUploadOnly:!1}),d=new GeoExt.data.LayerStore;c.target=a;a.proxy=OpenLayers.ProxyHost;a.layerSources={};a.layerSources.local=new gxp.plugins.LayerSource({title:"local",
store:d});c.addActions()[0].enable();c=new gxp.plugins.RemoveLayer({actionTarget:"treepanel.tbar",removeActionTip:"Remove layer"});c.target=a;a.mapPanel=b.s3.mapPanel;c.addActions()},pa=function(b,a){var c=b.s3.propertiesWindow,d=new Ext.Toolbar.Button({iconCls:"gxp-icon-layerproperties",tooltip:i18n.gis_properties,handler:function(){var d=a.root.findChildBy(function(a){return a.isSelected()?a.leaf?!0:!1:!1},null,!0);if(d){var f=d.layer.s3_layer_type,g=S3.Ap.concat("/gis/layer_"+f+".plain?layer_"+
f+".layer_id="+d.layer.s3_layer_id+"&update=1");Ext.Ajax.request({url:g,method:"GET",success:function(a,g){c&&c.close();var n;"feature"==f?(n=new Ext.TabPanel({activeTab:0,items:[{title:"Layer Properties",html:a.responseText},{title:"Filter",id:"s3_gis_layer_filter_tab",html:""}]}),n.items.items[1].on("activate",function(){var a;Ext.iterate(b.s3.layers_feature,function(b,c,f){b.id==d.layer.s3_layer_id&&(a=b.url.replace(/.geojson.+/,"/search.plain"))});Ext.get("s3_gis_layer_filter_tab").load({url:a,
discardUrl:!1,callback:function(){S3.addTooltips();S3.search.select_letter_label()},text:"Loading...",timeout:30,scripts:!1})})):n=new Ext.Panel({title:"Layer Properties",html:a.responseText});c=new Ext.Window({width:400,layout:"fit",items:[n]});c.show();$("#plain form").submit(function(){var a=$('#plain input[name="id"]').val(),a=S3.Ap.concat("/gis/layer_"+f+"/"+a+".plain/update"),b=$("#plain input"),c=[];Ext.iterate(b,function(a,b,d){b.id&&-1!=b.id.indexOf("gis_layer_")&&c.push(b.id)});b=[];for(i=
0;i<c.length;i++)(q=$("#"+c[i]).serialize())&&b.push(q);(q=$('#plain input[name="id"]').serialize())&&b.push(q);(q=$('#plain input[name="_formkey"]').serialize())&&b.push(q);(q=$('#plain input[name="_formname"]').serialize())&&b.push(q);0<b.length&&(b=b.join("&"),$.ajaxS3({type:"POST",url:a,data:b,success:function(a){$("#plain").html(a)}}));return!1});S3.addTooltips();S3.autocomplete("role","admin","group","gis_layer_"+f+"_role_required")}})}}});a.getTopToolbar().add(d)},D=function(b,a){if(void 0!=
a.marker)var c=a.marker,d=J+c.i,e=c.h,f=c.w;else d="";var g=a.opacity||1,k=a.style,c=new OpenLayers.Style({label:"${label}",labelAlign:"cm",pointRadius:"${radius}",fillColor:"${fill}",fillOpacity:"${fillOpacity}",strokeColor:"${stroke}",strokeWidth:"${strokeWidth}",strokeOpacity:"${strokeOpacity}",graphicWidth:"${graphicWidth}",graphicHeight:"${graphicHeight}",graphicXOffset:"${graphicXOffset}",graphicYOffset:"${graphicYOffset}",graphicOpacity:g,graphicName:"${graphicName}",externalGraphic:"${externalGraphic}"},
{context:{graphicWidth:function(a){var b=1;a.cluster||(a.attributes.marker_width?b=a.attributes.marker_width:void 0!=f&&(b=f));return b},graphicHeight:function(a){var b=1;a.cluster||(a.attributes.marker_height?b=a.attributes.marker_height:void 0!=e&&(b=e));return b},graphicXOffset:function(a){var b=-1;a.cluster||(a.attributes.marker_width?b=-(a.attributes.marker_width/2):void 0!=f&&(b=-(f/2)));return b},graphicYOffset:function(a){var b=-1;a.cluster||(a.attributes.marker_height?b=-a.attributes.marker_height:
void 0!=e&&(b=-e));return b},graphicName:function(a){var b="circle";a.cluster||(a.attributes.shape?b=a.attributes.shape:k&&!m&&void 0!=k.graphic&&(b=k.graphic));return b},externalGraphic:function(a){var b="";if(!a.cluster)if(a.attributes.marker_url)b=a.attributes.marker_url;else if(k)m||void 0!=k.externalGraphic&&(b=S3.Ap.concat("/static/"+k.externalGraphic));else return d;return b},radius:function(a){var b=10;a.cluster?b=Math.min(a.attributes.count/2,8)+10:a.attributes.size?b=a.attributes.size:k&&
!m&&(b=k.size);return b},fill:function(a){var b;a.cluster?b=a.cluster[0].attributes.colour?a.cluster[0].attributes.colour:"#8087ff":a.attributes.colour?b=a.attributes.colour:k?(m||(b=k.fill),b=void 0!=b?"#"+b:"#000000"):b="#f5902e";return b},fillOpacity:function(a){var b;a.cluster?b=a.cluster[0].attributes.opacity?a.cluster[0].attributes.opacity:g:a.attributes.opacity?b=a.attributes.opacity:k&&!m&&(b=k.fillOpacity);return b||g},stroke:function(a){var b;a.cluster?b=a.cluster[0].attributes.colour?a.cluster[0].attributes.colour:
"#2b2f76":a.attributes.colour?b=a.attributes.colour:k?(m||(b=k.stroke||k.fill),b=void 0!=b?"#"+b:"#000000"):b="#f5902e";return b},strokeOpacity:function(a){var b;a.cluster?b=a.cluster[0].attributes.opacity?a.cluster[0].attributes.opacity:g:a.attributes.opacity?b=a.attributes.opacity:k&&!m&&(b=k.strokeOpacity);return b||g},strokeWidth:function(a){var b=2;a.cluster?a.cluster[0].attributes.strokeWidth&&(b=a.cluster[0].attributes.strokeWidth):k&&!m&&(b=k.strokeWidth);return b||2},label:function(a){var b;
a.cluster?1<a.attributes.count&&(b=a.attributes.count):a.layer&&void 0!=a.layer.s3_style&&(a=a.layer.s3_style,!m&&a.show_label&&(b=a.label));return b||""}}}),m="[object Array]"===Object.prototype.toString.call(k)?!0:!1;if(m){var n=[],p,r,h,l,t,s,v,x,w,u,y,z,A;$.each(k,function(a,b){var c={};void 0!=b.fallback?(c.title=b.fallback,elsefilter=c.elseFilter=!0):(p=void 0!=b.prop?b.prop:"value",void 0!=b.cat?(h=b.cat,c.title=b.label||h,c.filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,
property:p,value:h})):(c.title=b.label||b.low+"-"+b.high,c.filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:p,lowerBoundary:b.low,upperBoundary:b.high})));if(void 0!=b.externalGraphic){l=S3.Ap.concat("/static/"+b.externalGraphic);var d=new Image;d.src=l;t=d.height;s=d.width;v=-(s/2);x=-t}else l="",s=t=1,x=v=-1;void 0!=b.fill?w="#"+b.fill:void 0!=b.stroke&&(w="#"+b.stroke);u=void 0!=b.fillOpacity?b.fillOpacity:g;z=void 0!=b.strokeOpacity?b.strokeOpacity:1;
graphic=void 0!=b.graphic?b.graphic:"square";y=void 0!=b.size?b.size:10;A=void 0!=b.strokeWidth?b.strokeWidth:2;c.symbolizer={externalGraphic:l,fillColor:w,fillOpacity:u,strokeColor:w,strokeOpacity:z,strokeWidth:A,graphicName:graphic,graphicHeight:t,graphicWidth:s,graphicXOffset:v,graphicYOffset:x,pointRadius:y};r=new OpenLayers.Rule(c);n.push(r)});0!=a.cluster_threshold&&(r=new OpenLayers.Rule({elseFilter:!0,title:" "}),n.push(r));c.addRules(n)}return[new OpenLayers.StyleMap({"default":c,select:1!=
g?{graphicOpacity:1}:{fillColor:"#ffdc33",strokeColor:"#ff9933"}}),d]}})();

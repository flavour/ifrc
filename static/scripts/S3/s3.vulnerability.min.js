(function(b){b.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1E3,style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var a=this,d=this.options,c=(this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10)).replace(/(:|\.)/g,"");this.ids=[c,c+"-button",c+"-menu"];this._safemouseup=!0;this.isOpen=!1;this.newelement=
b("<a />",{"class":this.widgetBaseClass+" ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]});this.newelementWrap=b("<span />").append(this.newelement).insertAfter(this.element);(c=this.element.attr("tabindex"))&&this.newelement.attr("tabindex",c);this.newelement.data("selectelement",this.element);this.selectmenuIcon=b('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement);
this.newelement.prepend('<span class="'+a.widgetBaseClass+'-status" />');this.element.bind({"click.selectmenu":function(b){a.newelement.focus();b.preventDefault()}});this.newelement.bind("mousedown.selectmenu",function(b){a._toggle(b,!0);"popup"==d.style&&(a._safemouseup=!1,setTimeout(function(){a._safemouseup=!0},300));return!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(d){var c=!1;switch(d.keyCode){case b.ui.keyCode.ENTER:c=!0;break;case b.ui.keyCode.SPACE:a._toggle(d);
break;case b.ui.keyCode.UP:d.altKey?a.open(d):a._moveSelection(-1);break;case b.ui.keyCode.DOWN:d.altKey?a.open(d):a._moveSelection(1);break;case b.ui.keyCode.LEFT:a._moveSelection(-1);break;case b.ui.keyCode.RIGHT:a._moveSelection(1);break;case b.ui.keyCode.TAB:c=!0;break;case b.ui.keyCode.PAGE_UP:case b.ui.keyCode.HOME:a.index(0);break;case b.ui.keyCode.PAGE_DOWN:case b.ui.keyCode.END:a.index(a._optionLis.length);break;default:c=!0}return c}).bind("keypress.selectmenu",function(b){0<b.which&&a._typeAhead(b.which,
"mouseup");return!0}).bind("mouseover.selectmenu",function(){d.disabled||b(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",function(){d.disabled||b(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){d.disabled||b(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){d.disabled||b(this).removeClass("ui-state-focus")});b(document).bind("mousedown.selectmenu-"+this.ids[0],function(b){a.isOpen&&a.close(b)});this.element.bind("click.selectmenu",function(){a._refreshValue()}).bind("focus.selectmenu",
function(){a.newelement&&a.newelement[0].focus()});d.width||(d.width=this.element.outerWidth());this.newelement.width(d.width);this.element.hide();this.list=b("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]});this.listWrap=b("<div />",{"class":a.widgetBaseClass+"-menu"}).append(this.list).appendTo(d.appendTo);this.list.bind("keydown.selectmenu",function(d){var c=false;switch(d.keyCode){case b.ui.keyCode.UP:d.altKey?a.close(d,
true):a._moveFocus(-1);break;case b.ui.keyCode.DOWN:d.altKey?a.close(d,true):a._moveFocus(1);break;case b.ui.keyCode.LEFT:a._moveFocus(-1);break;case b.ui.keyCode.RIGHT:a._moveFocus(1);break;case b.ui.keyCode.HOME:a._moveFocus(":first");break;case b.ui.keyCode.PAGE_UP:a._scrollPage("up");break;case b.ui.keyCode.PAGE_DOWN:a._scrollPage("down");break;case b.ui.keyCode.END:a._moveFocus(":last");break;case b.ui.keyCode.ENTER:case b.ui.keyCode.SPACE:a.close(d,true);b(d.target).parents("li:eq(0)").trigger("mouseup");
break;case b.ui.keyCode.TAB:c=true;a.close(d,true);b(d.target).parents("li:eq(0)").trigger("mouseup");break;case b.ui.keyCode.ESCAPE:a.close(d,true);break;default:c=true}return c}).bind("keypress.selectmenu",function(b){b.which>0&&a._typeAhead(b.which,"focus");return true}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return false});b(window).bind("resize.selectmenu-"+this.ids[0],b.proxy(a.close,this))},_init:function(){var a=this,d=this.options,c=[];this.element.find("option").each(function(){var e=
b(this);c.push({value:e.attr("value"),text:a._formatText(e.text()),selected:e.attr("selected"),disabled:e.attr("disabled"),classes:e.attr("class"),typeahead:e.attr("typeahead"),parentOptGroup:e.parent("optgroup"),bgImage:d.bgImage.call(e)})});var f="popup"==a.options.style?" ui-state-active":"";this.list.html("");if(c.length)for(var e=0;e<c.length;e++){var g={role:"presentation"};c[e].disabled&&(g["class"]=this.namespace+"-state-disabled");var h={html:c[e].text||"&nbsp;",href:"#nogo",tabindex:-1,
role:"option","aria-selected":!1};c[e].disabled&&(h["aria-disabled"]=c[e].disabled);c[e].typeahead&&(h.typeahead=c[e].typeahead);h=b("<a/>",h);g=b("<li/>",g).append(h).data("index",e).addClass(c[e].classes).data("optionClasses",c[e].classes||"").bind("mouseup.selectmenu",function(d){if(a._safemouseup&&!a._disabled(d.currentTarget)&&!a._disabled(b(d.currentTarget).parents("ul>li."+a.widgetBaseClass+"-group "))){var c=b(this).data("index")!=a._selectedIndex();a.index(b(this).data("index"));a.select(d);
c&&a.change(d);a.close(d,true)}return false}).bind("click.selectmenu",function(){return false}).bind("mouseover.selectmenu focus.selectmenu",function(d){if(!b(d.currentTarget).hasClass(a.namespace+"-state-disabled")&&!b(d.currentTarget).parent("ul").parent("li").hasClass(a.namespace+"-state-disabled")){a._selectedOptionLi().addClass(f);a._focusedOptionLi().removeClass(a.widgetBaseClass+"-item-focus ui-state-hover");b(this).removeClass("ui-state-active").addClass(a.widgetBaseClass+"-item-focus ui-state-hover")}}).bind("mouseout.selectmenu blur.selectmenu",
function(){b(this).is(a._selectedOptionLi().selector)&&b(this).addClass(f);b(this).removeClass(a.widgetBaseClass+"-item-focus ui-state-hover")});c[e].parentOptGroup.length?(h=a.widgetBaseClass+"-group-"+this.element.find("optgroup").index(c[e].parentOptGroup),this.list.find("li."+h).length?this.list.find("li."+h+":last ul").append(g):b(' <li role="presentation" class="'+a.widgetBaseClass+"-group "+h+(c[e].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+
'><span class="'+a.widgetBaseClass+'-group-label">'+c[e].parentOptGroup.attr("label")+"</span><ul></ul></li> ").appendTo(this.list).find("ul").append(g)):g.appendTo(this.list);if(d.icons)for(var j in d.icons)g.is(d.icons[j].find)&&(g.data("optionClasses",c[e].classes+" "+a.widgetBaseClass+"-hasIcon").addClass(a.widgetBaseClass+"-hasIcon"),h=d.icons[j].icon||"",g.find("a:eq(0)").prepend('<span class="'+a.widgetBaseClass+"-item-icon ui-icon "+h+'"></span>'),c[e].bgImage&&g.find("span").css("background-image",
c[e].bgImage))}else b('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);e="dropdown"==d.style;this.newelement.toggleClass(a.widgetBaseClass+"-dropdown",e).toggleClass(a.widgetBaseClass+"-popup",!e);this.list.toggleClass(a.widgetBaseClass+"-menu-dropdown ui-corner-bottom",e).toggleClass(a.widgetBaseClass+"-menu-popup ui-corner-all",!e).find("li:first").toggleClass("ui-corner-top",!e).end().find("li:last").addClass("ui-corner-bottom");this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",
e).toggleClass("ui-icon-triangle-2-n-s",!e);"dropdown"==d.style?this.list.width(d.menuWidth?d.menuWidth:d.width):this.list.width(d.menuWidth?d.menuWidth:d.width-d.handleWidth);this.list.css("height","auto");e=this.listWrap.height();j=b(window).height();j=d.maxHeight?Math.min(d.maxHeight,j):j/3;e>j&&this.list.height(j);this._optionLis=this.list.find("li:not(."+a.widgetBaseClass+"-group)");this.element.attr("disabled")?this.disable():this.enable();this.index(this._selectedIndex());this._selectedOptionLi().addClass(this.widgetBaseClass+
"-item-focus");clearTimeout(this.refreshTimeout);this.refreshTimeout=window.setTimeout(function(){a._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu");b(window).unbind(".selectmenu-"+this.ids[0]);b(document).unbind(".selectmenu-"+this.ids[0]);this.newelementWrap.remove();this.listWrap.remove();this.element.unbind(".selectmenu").show();
b.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(a,b){var c=this,f=String.fromCharCode(a).toLowerCase(),e=null,g=null;c._typeAhead_timer&&(window.clearTimeout(c._typeAhead_timer),c._typeAhead_timer=void 0);c._typeAhead_chars=(void 0===c._typeAhead_chars?"":c._typeAhead_chars).concat(f);2>c._typeAhead_chars.length||c._typeAhead_chars.substr(-2,1)===f&&c._typeAhead_cycling?(c._typeAhead_cycling=!0,e=f):(c._typeAhead_cycling=!1,e=c._typeAhead_chars);for(var f=("focus"!==b?this._selectedOptionLi().data("index"):
this._focusedOptionLi().data("index"))||0,h=0;h<this._optionLis.length;h++)if(this._optionLis.eq(h).text().substr(0,e.length).toLowerCase()===e)if(c._typeAhead_cycling){if(null===g&&(g=h),h>f){g=h;break}}else g=h;null!==g&&this._optionLis.eq(g).find("a").trigger(b);c._typeAhead_timer=window.setTimeout(function(){c._typeAhead_timer=void 0;c._typeAhead_chars=void 0;c._typeAhead_cycling=void 0},c.options.typeAhead)},_uiHash:function(){var a=this.index();return{index:a,option:b("option",this.element).get(a),
value:this.element[0].value}},open:function(a){var b=this.options;if("true"!=this.newelement.attr("aria-disabled")){this._closeOthers(a);this.newelement.addClass("ui-state-active");this.list.attr("aria-hidden",!1);this.listWrap.addClass(this.widgetBaseClass+"-open");var c=this._selectedOptionLi();"dropdown"==b.style?this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):this.list.css("left",-5E3).scrollTop(this.list.scrollTop()+c.position().top-this.list.outerHeight()/2+c.outerHeight()/
2).css("left","auto");this._refreshPosition();b=c.find("a");b.length&&b[0].focus();this.isOpen=!0;this._trigger("open",a,this._uiHash())}},close:function(a,b){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass(this.widgetBaseClass+"-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),b&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",
a,this._uiHash()))},change:function(a){this.element.trigger("change");this._trigger("change",a,this._uiHash())},select:function(a){if(this._disabled(a.currentTarget))return!1;this._trigger("select",a,this._uiHash())},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(a){b("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){b(this).data("selectelement").selectmenu("close",a)});b("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},
_toggle:function(a,b){this.isOpen?this.close(a,b):this.open(a)},_formatText:function(a){this.options.format?a=this.options.format(a):this.options.escapeHtml&&(a=b("<div />").text(a).html());return a},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(a,b){if(!this.options.disabled){var c=parseInt(this._selectedOptionLi().data("index")||
0,10)+a;0>c&&(c=0);c>this._optionLis.size()-1&&(c=this._optionLis.size()-1);if(c===b)return!1;this._optionLis.eq(c).hasClass(this.namespace+"-state-disabled")?(0<a?++a:--a,this._moveSelection(a,c)):this._optionLis.eq(c).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(a,b){var c=isNaN(a)?parseInt(this._optionLis.filter(a).data("index"),10):parseInt(this._focusedOptionLi().data("index")||0,10)+a;0>c&&(c=0);c>this._optionLis.size()-1&&(c=this._optionLis.size()-1);if(c===b)return!1;var f=
this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id","");this._optionLis.eq(c).hasClass(this.namespace+"-state-disabled")?(0<a?++a:--a,this._moveFocus(a,c)):this._optionLis.eq(c).find("a:eq(0)").attr("id",f).focus();this.list.attr("aria-activedescendant",f)},_scrollPage:function(a){var b=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());this._moveFocus("up"==a?-b:b)},_setOption:function(a,b){this.options[a]=b;"disabled"==
a&&(b&&this.close(),this.element.add(this.newelement).add(this.list)[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",b))},disable:function(a,b){"undefined"==typeof a?this._setOption("disabled",!0):"optgroup"==b?this._disableOptgroup(a):this._disableOption(a)},enable:function(a,b){"undefined"==typeof a?this._setOption("disabled",!1):"optgroup"==b?this._enableOptgroup(a):this._enableOption(a)},_disabled:function(a){return b(a).hasClass(this.namespace+
"-state-disabled")},_disableOption:function(a){var b=this._optionLis.eq(a);b&&(b.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(a).attr("disabled","disabled"))},_enableOption:function(a){var b=this._optionLis.eq(a);b&&(b.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(a).removeAttr("disabled"))},_disableOptgroup:function(a){var b=this.list.find("li."+this.widgetBaseClass+"-group-"+
a);b&&(b.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(a).attr("disabled","disabled"))},_enableOptgroup:function(a){var b=this.list.find("li."+this.widgetBaseClass+"-group-"+a);b&&(b.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(a).removeAttr("disabled"))},index:function(a){if(arguments.length){if(this._disabled(b(this._optionLis[a])))return!1;this.element[0].selectedIndex=a;this._refreshValue()}else return this._selectedIndex()},
value:function(a){if(arguments.length)this.element[0].value=a,this._refreshValue();else return this.element[0].value},_refreshValue:function(){var a="popup"==this.options.style?" ui-state-active":"",b=this.widgetBaseClass+"-item-"+Math.round(1E3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected","false").attr("id","");this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected",
"true").attr("id",b);var a=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",c=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(a).data("optionClasses",c).addClass(c).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",b)},_refreshPosition:function(){var a=this.options;if("popup"==a.style&&!a.positionOptions.offset)var b=
this._selectedOptionLi(),b="0 "+(this.list.offset().top-b.offset().top-(this.newelement.outerHeight()+b.outerHeight())/2);this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+1).position({of:a.positionOptions.of||this.newelement,my:a.positionOptions.my,at:a.positionOptions.at,offset:a.positionOptions.offset||b,collision:a.positionOptions.collision||"popup"==a.style?"fit":"flip"})}})})(jQuery);
var TypeHelpers=new function(){var b=this;b.hasSmoothing=function(){if("undefined"!=typeof screen.fontSmoothingEnabled)return screen.fontSmoothingEnabled;try{var a=document.createElement("canvas");a.width="35";a.height="35";a.style.display="none";document.body.appendChild(a);var b=a.getContext("2d");b.textBaseline="top";b.font="32px Arial";b.fillStyle="black";b.strokeStyle="black";b.fillText("O",0,0);for(a=8;32>=a;a++)for(var c=1;32>=c;c++){var f=b.getImageData(c,a,1,1).data[3];if(255!=f&&0!=f)return!0}return!1}catch(e){return null}};
b.insertClasses=function(){var a=b.hasSmoothing(),d=document.getElementsByTagName("html")[0];d.className=!0==a?d.className+" hasFontSmoothing-true":!1==a?d.className+" hasFontSmoothing-false":d.className+" hasFontSmoothing-unknown"}},drawerOpen=!1,colors={"0":"#999999",1:"#ff5121",2:"#f4961c",3:"#d6b317",4:"#77b826",5:"#059346"},map,parser,proj4326,resilienceLayer,current_l0,current_l1,current_l2,current_l3,current_l4;S3.i18n.gis_requires_login="Requires Login";
yepnope({load:[S3.Ap.concat("/static/scripts/gis/OpenLayers.js")],complete:function(){showMap()}});
$(document).ready(function(){$("#dataTopBar").hover(function(){$("#dataTopBar img").css("background-color","#f7941d");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#dataOptions").fadeIn(150);$("#defaultDataLink").css("color","#c47a21")},function(){$("#dataTopBar img").css("background-color","transparent");$("#dataTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));$("#dataOptions").fadeOut(150);
$("#defaultDataLink").css("color","#f7941d")});$("#reportsTopBar").hover(function(){$("#reportsTopBar img").css("background-color","#f7941d");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowOverPng8.png"));$("#reportsOptions").fadeIn(150);$("#defaultReportsLink").css("color","#c47a21")},function(){$("#reportsTopBar img").css("background-color","transparent");$("#reportsTopBar img").attr("src",S3.Ap.concat("/static/themes/Vulnerability/img/dropdownArrowPng8.png"));
$("#reportsOptions").fadeOut(150);$("#defaultReportsLink").css("color","#f7941d")});var b=$("#dummy_location_search").val(),a=!1,d=function(a){switch(a.level){case "L0":return a.name;case "L1":return a.name+","+a.L0;case "L2":return a.name+","+a.L1+","+a.L0;case "L3":return a.name+","+a.L2+","+a.L1+","+a.L0;case "L4":return a.name+","+a.L3+","+a.L2+","+a.L1+","+a.L0;case "None":return a.label}},c=$.ui.autocomplete.prototype._response;$.ui.autocomplete.prototype._response=function(a){c.apply(this,
[a]);this.element.trigger("autocompletesearchcomplete",[a])};$("#dummy_location_search").autocomplete({source:S3.Ap.concat("/gis/location/search.json?location.level__ne=None&filter=~&field=name&simple=1"),delay:450,minLength:2,position:{my:"left bottom",at:"left top"},search:function(){$("#dummy_location_search_throbber").removeClass("hidden").show();return!0},response:function(a,b,c){$("#dummy_location_search_throbber").hide();0==b.content.length&&($().autocomplete("widget"),a=$("#dummy_location_search").autocomplete("option",
"source"),$("#dummy_location_search").autocomplete("option","source",[{label:"No matching result",value:0,id:0,name:"No matching result",level:"None"}]),$("#dummy_location_search").autocomplete("search","No"),c=[{label:"No matching result",value:0,level:"None",id:0,name:"No matching result"}],$("#dummy_location_search").autocomplete("option","source",a));return c},focus:function(a,b){$("#dummy_location_search").val(b.item.name);return!1},select:function(b,c){var d=c.item.id;$("#dummy_location_search").val(c.item.name);
$("#location_search").val(d);$("#location_search").change();a=!0;$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),success:function(){for(var a in n)vdata[a]=n[a];n=null;v_select_region(parseInt(c.item.level[1]),d)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"script"});return!1}}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+d(b)+"</a>").appendTo(a)};$("#dummy_location_search").blur(function(){$("#dummy_location_search").val()||
($("#location_search").val(""),a=!0);a?b=$("#dummy_location_search").val():$("#dummy_location_search").val(b);a=!1});$("#dummy_location_search").bind("autocompletesearchcomplete",function(a,b){0==b.length&&$("#dummy_location_search").autocomplete("widget").show()});var f=[],e,g;for(g in idata)e="        <li>            <div class='indicatorRatingLabel'>                <div class='listText'>"+idata[g].n+"</div>                <div class='popup'>                    <div class='popupContent'>                        <h3>"+
idata[g].n+"</h3>                        <p>"+idata[g].d+"</p>                    </div>                    <div class='popupBottom'></div>                </div>            </div>            <div class='visRange'>                <div class='indicatorRange' id='visRange"+g+"'>                    <div class='leftBox'></div>                    <div class='medianDot'></div>                    <div class='rightBox'></div>                </div>            </div>        </li>",f.push(e);$("#indicatorRatingChart ul").html(f.join(""));
for(var h in vdata){switch(vdata[h].r){case 1:f="one";break;case 2:f="two";break;case 3:f="three";break;case 4:f="four";break;case 5:f="five";break;default:f="none"}e=h==start?' selected="selected"':"";0==vdata[h].l?($("#l0_select").append('<option value="'+h+'" class="'+f+'"'+e+">"+vdata[h].n+"</option>"),$("#l0_reports").append('<option value="'+h+'" class="'+f+'"'+e+">"+vdata[h].n+"</option>")):1==vdata[h].l&&($("#l1_select").append('<option value="'+h+'" class="'+f+'">'+vdata[h].n+"</option>"),
$("#l1_reports").append('<option value="'+h+'" class="'+f+'">'+vdata[h].n+"</option>"))}$("#l0_select, #l0_reports").change(function(){var a=this.value,b=hdata[a];$("#l1_select").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");$("#l1_reports").html('<option value="" selected="selected" class="none">Choose '+b.l1+"</option>");try{lx_select(a,0)}catch(c){readHierarchy(a,0)}});$("#l1_select, #l1_reports").change(function(){var a=this.value,b=hdata[$("#l0_select").val()];
$("#l2_select").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");$("#l2_reports").html('<option value="" selected="selected" class="none">Choose '+b.l2+"</option>");try{lx_select(a,1)}catch(c){readHierarchy(a,1)}});$("#l2_select, #l2_reports").change(function(){var a=this.value,b=hdata[$("#l0_select").val()];$("#l3_select").html('<option value="" selected="selected" class="none">Choose '+b.l3+"</option>");$("#l3_reports").html('<option value="" selected="selected" class="none">Choose '+
b.l3+"</option>");try{lx_select(a,2)}catch(c){readHierarchy(a,2)}});$("#l3_select, #l3_reports").change(function(){var a=this.value,b=hdata[$("#l0_select").val()];$("#l4_select").html('<option value="" selected="selected" class="none">Choose '+b.l4+"</option>");$("#l4_reports").html('<option value="" selected="selected" class="none">Choose '+b.l4+"</option>");try{lx_select(a,3)}catch(c){readHierarchy(a,3)}});TypeHelpers.insertClasses();$(".closechromeframe").click(function(){$(".chromeframe").hide()});
$("#show-hide").click(function(){drawerSlide()});$("#risingTab").click(function(){drawerSlide()});$(".calculationLink").click(function(){$("#lightbox, #calculationView").fadeIn(300)});$("#calculationView .closePanel").click(function(){$("#lightbox, #calculationView").fadeOut(300)});$("#lightbox").click(function(){$("#lightbox, #reportsSection, #calculationView, #photoPanel").fadeOut(300)});$("#reportsSection .closePanel").click(function(){$("#lightbox, #reportsSection").fadeOut(300)});$(".listText").hover(function(){$(this).siblings(".popup").show()},
function(){$(this).siblings(".popup").hide()});$(".headerRow").click(function(){$(".rowForApproval").hide();$(".rowForApproval").prev().find(".closeReviewButton").hide();$(".rowForApproval").prev().find(".reviewButton").show();$(".headerRow.activeSection td.arrowCell .arrow").html("&rarr;");$(".headerRow.activeSection").removeClass("activeSection");$(this).addClass("activeSection");$(".headerRow.activeSection .arrow").html("&darr;");$(".activeContent").hide("slow");$(".activeContent").removeClass("activeContent");
$(this).next().addClass("activeContent");$(this).parent().next().addClass("activeContent");$(".activeContent").fadeIn(200);resizeReports()});$("#filterSubmit").click(function(){displayThanks("Loading report details.",null);$("#table-container").empty();hideReportDetails(id);var a=getFilteredReport();$.ajax({type:"POST",url:"report/filter",data:a}).done(function(a){$(".approvalScreen").hide();displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()})})});
function readHierarchy(b,a){$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+b),success:function(){for(var d in n)vdata[d]=n[d];n=null;lx_select(b,a)},error:function(a,b,f){msg="UNAUTHORIZED"==f?S3.i18n.gis_requires_login:a.responseText},dataType:"script"})}
function lx_select(b,a){if(0==a){var d=hdata[b];$("#l1 label").html(capitalize(d.l1)+":");$("#l2 label").html(capitalize(d.l2)+":");$("#l3 label").html(capitalize(d.l3)+":");$("#l4 label").html(capitalize(d.l4)+":");$("#l1_report label").html(capitalize(d.l1)+":");$("#l2_report label").html(capitalize(d.l2)+":");$("#l3_report label").html(capitalize(d.l3)+":");$("#l4_report label").html(capitalize(d.l4)+":")}a+=1;$("#l"+a).show();$("#l"+a+"_report").show();var c,f;for(f in vdata)if(d=vdata[f],null!=
d.f&&d.f==b){switch(d.r){case 1:c="one";break;case 2:c="two";break;case 3:c="three";break;case 4:c="four";break;case 5:c="five";break;default:c="none"}$("#l"+a+"_select").append('<option value="'+f+'" class="'+c+'">'+d.n+"</option>");$("#l"+a+"_reports").append('<option value="'+f+'" class="'+c+'">'+d.n+"</option>")}updateSelectMenus()}
function updateSelectMenus(){$("#browseOtherRegions select").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]});$(".locationFilters select").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},{find:".three"},{find:".four"},{find:".five"}]});$("#chartSwitcher").selectmenu("destroy").selectmenu({style:"popup",maxHeight:280,width:125,menuWidth:125})}
function showMap(){OpenLayers.ImgPath=S3.Ap.concat("/static/img/gis/openlayers/");proj4326=new OpenLayers.Projection("EPSG:4326");map=new OpenLayers.Map("map",{theme:null});var b=new OpenLayers.Layer.WMS("VMap0","http://vmap0.tiles.osgeo.org/wms/vmap0",{layers:"basic"});map.addLayer(b);parser=new OpenLayers.Format.GeoJSON({});b=new OpenLayers.Style({fillColor:"${fill}",fillOpacity:"${fillOpacity}",strokeColor:"#ffffff",strokeWidth:"${strokeWidth}",strokeOpacity:1,graphicWidth:14,graphicHeight:14,
graphicXOffset:-7,graphicYOffset:-14,graphicOpacity:1,externalGraphic:"${externalGraphic}"},{context:{fill:function(a){return colors[a.attributes.r]},fillOpacity:function(a){return a.attributes.outline?0.1:0.5},strokeWidth:function(a){return a.attributes.outline?3:1},externalGraphic:function(a){a=a.attributes.r;if(5==a)a="/static/themes/Vulnerability/img/rating5.png";else if(4==a)a="/static/themes/Vulnerability/img/rating4.png";else if(3==a)a="/static/themes/Vulnerability/img/rating3.png";else if(2==
a)a="/static/themes/Vulnerability/img/rating2.png";else if(1==a)a="/static/themes/Vulnerability/img/rating1.png";else return"";return S3.Ap.concat(a)}}});b=new OpenLayers.StyleMap({"default":b,select:{fillOpacity:1}});strategy=new OpenLayers.Strategy.Fixed;protocol=new OpenLayers.Protocol.HTTP({url:S3.Ap.concat("/static/cache/countries.geojson"),format:parser});resilienceLayer=new OpenLayers.Layer.Vector("Resilience",{strategies:[strategy],protocol:protocol,styleMap:b});map.addLayer(resilienceLayer);
resilienceLayer.events.on({beforefeatureadded:addAttributes,featureselected:onResilienceFeatureSelect,featureunselected:onFeatureUnselect});""==start?globalView():v_select_region(0,start);b=new OpenLayers.Control.SelectFeature(resilienceLayer,{toggle:!0});b.handlers.feature.callbacks.dblclick=function(a){closePopups();v_select_region(a.attributes.l,a.attributes.id)};map.addControl(b);b.activate()}
function addAttributes(b){var a=b.feature,d=a.attributes.id,c;try{c=vdata[d].l}catch(f){$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+d),async:!1,success:function(){for(var a in n)vdata[a]=n[a];n=null;c=vdata[d].l},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"script"})}b=vdata[d].r;a.attributes.l=c;a.attributes.r=b;a=a.geometry;0!=a.getArea()&&(b=new OpenLayers.Feature.Vector(a.getCentroid(),{id:parseInt(d),l:c,r:b}),resilienceLayer.addFeatures([b]))}
function onFeatureUnselect(b){b=b.feature;b.popup&&(map.removePopup(b.popup),b.popup.destroy(),delete b.popup)}
function onResilienceFeatureSelect(b){drawerOpen&&drawerSlide;var b=b.feature,a=b.attributes.id,d=b.attributes.l,c="    <h3>DATA QUALITY:</h3>     <div class='windowQualityRatings'>        <div class='poor'>POOR            <div class='popup'>                <div class='popupContent'>                    <h3>POOR</h3>                    <p>0&ndash;25% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='fair'>FAIR            <div class='popup'>                <div class='popupContent'>                    <h3>FAIR</h3>                    <p>25&ndash;50% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='moderate'>MODERATE            <div class='popup'>                <div class='popupContent'>                    <h3>MODERATE</h3>                    <p>50&ndash;75% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div> |         <div class='strong'>STRONG            <div class='popup'>                <div class='popupContent'>                    <h3>STRONG</h3>                    <p>75&ndash;100% of total data reported.</p>                </div>                <div class='popupBottom'></div>            </div>        </div>    </div>",f=
vdata[a];switch(d){case 0:var e=hdata[a],g="Country",h="COUNTRY",j=capitalize(e.l1),i=e.l4,j="            <h3>"+j+"S IN THIS "+h+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+j+" <span class='arrow'>&rarr;</span></a>";break;case 1:e=hdata[current_l0];g=e.l1;h=capitalize(g);j=capitalize(e.l2);i=e.l4;j="            <h3>"+j+"S IN THIS "+h+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+
j+" <span class='arrow'>&rarr;</span></a>";break;case 2:e=hdata[current_l0];g=e.l2;h=capitalize(g);j=capitalize(e.l3);i=e.l4;j="            <h3>"+j+"S IN THIS "+h+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+j+" <span class='arrow'>&rarr;</span></a>";break;case 3:e=hdata[current_l0];g=e.l3;h=capitalize(g);j=capitalize(e.l4);i=e.l4;j="            <h3>"+j+"S IN THIS "+h+":</h3>            <select class='subGeoSelect'></select>\t\t\t<a id='goToSubRegion' class='goToSubRegion'>GO TO THE "+
j+" <span class='arrow'>&rarr;</span></a>";break;case 4:e=hdata[current_l0],g=e.l4,h=capitalize(g),j="",c="<div class='lastCollected'></div>"}var k=f.n,e=f.r;0==e&&(e="");i&&(c+="<div class='subGeoCommunesReported'> out of  "+capitalize(i)+"S Reported</div>");var g="    <section class='infoWindow'>\t\t<div class='infoWindowMain'>\t\t\t<div id='subGeoIndicator'>"+e+"</div>\t\t\t<h2 class='subGeoName'>"+k+"</h2>\t\t\t<h2 class='subGeoType'>"+g+"</h2>\t\t\t<a id='goToRegion' class='goToSubRegion'>GO TO THE "+
h+" <span class='arrow'>&rarr;</span></a>\t\t\t"+c+"\t\t\t<h3 id='population'>POPULATION: </h3>\t\t\t"+j+"\t\t\t<div class='infoWindowButtons'>\t\t\t\t<div class='subGeoSubmitDataButton'>Submit Data</div>\t\t\t\t<div class='subGeoAnalysisButton'>Analysis</div>\t\t\t\t<div class='subGeoReportsButton'>Reports</div>\t\t\t</div>\t\t</div>\t</section>",h=b.geometry.getBounds().getCenterLonLat(),l=new OpenLayers.Popup.FramedCloud(a,h,new OpenLayers.Size(200,200),g,null,!0,closePopups);b.popup=l;map.addPopup(l);
$("#goToRegion").click(function(){v_select_region(d,a)});$.ajax({url:S3.Ap.concat("/vulnerability/vdata/"+a),success:function(){for(var b in n)vdata[b]=n[b];n=null;f=vdata[a];i?$(".subGeoCommunesReported").html(f.c+" out of "+f.t+" "+i+"s Reported"):$(".windowQualityRatings").html("Last Data Collected on "+f.t+" by "+f.c);var c=f.p;null!=c&&$("#population").html("POPULATION: "+c);switch(f.q){case "p":$(".poor").addClass("currentQuality");break;case "f":$(".fair").addClass("currentQuality");break;
case "m":$(".moderate").addClass("currentQuality");break;case "s":$(".strong").addClass("currentQuality")}for(b in vdata)if(vdata[b].l==d+1&&vdata[b].f==a){switch(vdata[b].r){case 1:c="one";break;case 2:c="two";break;case 3:c="three";break;case 4:c="four";break;case 5:c="five";break;default:c="none"}$(".subGeoSelect").append('<option value="'+b+'" class="'+c+'">'+vdata[b].n+"</option>")}$(".subGeoSelect").selectmenu({style:"popup",maxHeight:280,width:160,menuWidth:160,icons:[{find:".one"},{find:".two"},
{find:".three"},{find:".four"},{find:".five"}]});$("#goToSubRegion").click(function(){var a=$(".subGeoSelect").val();v_select_region(d+1,a)});l.updateSize()},error:function(b,c,d){msg="UNAUTHORIZED"==d?S3.i18n.gis_requires_login:b.responseText;$("#"+a+"_contentDiv").html(msg);l.updateSize()},dataType:"script"});""==e?$("#subGeoIndicator").css("background-color",colors[0]):$("#subGeoIndicator").css("background-color",colors[e])}
function closePopups(){for(;map.popups.length;)map.removePopup(map.popups[0])}function hideFeature(b){var b=resilienceLayer.getFeaturesByAttribute("id",parseInt(b)),a;for(a in b)try{var d=b[a];0==d.geometry.getArea()?d.destroy():(d.attributes.outline=1,resilienceLayer.drawFeature(d))}catch(c){}}
function showFeature(b){if(null!=b){var a=resilienceLayer.getFeaturesByAttribute("id",parseInt(b)),d;for(d in a)try{var c=a[d];c.attributes.outline=0;resilienceLayer.drawFeature(c);var f=new OpenLayers.Feature.Vector(c.geometry.getCentroid(),{id:parseInt(b),l:c.attributes.l,r:c.attributes.r});resilienceLayer.addFeatures([f])}catch(e){}}}
function removeFeatures(b){var a,d=[],c;for(c in resilienceLayer.features){a=resilienceLayer.features[c];try{a.attributes.l>=b&&d.push(a)}catch(f){}}resilienceLayer.destroyFeatures(d)}
var globalView=function(){closePopups();removeFeatures(1);var b=(new OpenLayers.LonLat(80,-50)).transform(proj4326,map.getProjectionObject()),a=(new OpenLayers.LonLat(180,50)).transform(proj4326,map.getProjectionObject());map.zoomToExtent([b.lon,b.lat,a.lon,a.lat]);showFeature(current_l0);showFeature(current_l1);showFeature(current_l2);showFeature(current_l3);showFeature(current_l4);$("#l0_breadcrumb, #l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb, #show-hide, #divider, #analysisLink, #indicator, #risingTab").hide();
$(".geoName").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select a country");$(".geoType").html("");$(".year").html("");markersOff();current_l4=current_l3=current_l2=current_l1=current_l0=null},v_select_region=function(b,a){closePopups();var d=vdata[a];switch(b){case 0:current_l0!=a&&showFeature(current_l0);current_l0=a;var c=hdata[a],f=d.n;$("#l1_breadcrumb, #l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+a+");");
$("#l0_breadcrumb span").html(" &raquo; "+f);$("#geoName").html(f);$(".geoType").html("Country in");$("#l0_select").val(a);$("#l0_reports").val(a);$("#l1_select, #l2_select, #l3_select, #l4_select, #l5_select").val("");$("#l1_report, #l2_report, #l3_report, #l4_report, #l5_report").val("");$("#l2, #l3, #l4, #l5").hide();$("#l2_report, #l3_report, #l4_report, #l5_report").hide();markersOff();removeFeatures(1);hideFeature(a);$.ajax({url:S3.Ap.concat("/static/cache/1_"+a+".geojson"),success:function(a){var a=
parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});break;case 1:current_l1!=a&&showFeature(current_l1);current_l1=a;current_l0!=d.f&&showFeature(current_l0);current_l0=d.f;var c=hdata[current_l0],f=vdata[current_l0].n,e=d.n;$("#l2_breadcrumb, #l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();
$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+f);$("#l1_breadcrumb").show().attr("href","javascript:v_select_region(1,"+a+");");$("#l1_breadcrumb span").html(" &raquo; "+e);$("#geoName").html(e);f=c.l1;$(".geoType").html(f+" in");$("#l0_select").val(current_l0);$("#l0_reports").val(current_l0);$("#l1_select").val(a);$("#l1_reports").val(a);$("#l2_select, #l3_select, #l4_select, #l5_select").val("");$("#l2_reports, #l3_reports, #l4_reports, #l5_reports").val("");
$("#l2").show();$("#l2_report").show();$("#l3, #l4, #l5").hide();$("#l3_report, #l4_report, #l5_report").hide();markersOff();removeFeatures(2);f=resilienceLayer.getFeaturesByAttribute("id",parseInt(a));(f=[])&&$.ajax({url:S3.Ap.concat("/static/cache/1_"+current_l0+".geojson"),async:!1,success:function(b){var b=parser.read(b),c=[],d;for(d in b)try{b[d].attributes.id==a&&(b[d].geometry.transform(proj4326,map.getProjectionObject()),c.push(b[d]))}catch(e){}resilienceLayer.addFeatures(c)},error:function(a,
b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});hideFeature(a);$.ajax({url:S3.Ap.concat("/static/cache/2_"+a+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});break;case 2:current_l2!=a&&
showFeature(current_l2);current_l2=a;current_l1!=d.f&&showFeature(current_l1);current_l1=d.f;current_l0!=vdata[current_l1].f&&showFeature(current_l0);current_l0=vdata[current_l1].f;var c=hdata[current_l0],f=vdata[current_l0].n,e=vdata[current_l1].n,g=d.n;$("#l3_breadcrumb, #l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+f);$("#l1_breadcrumb").show().attr("href","javascript:v_select_region(1,"+
current_l1+");");$("#l1_breadcrumb span").html(" &raquo; "+e);$("#l2_breadcrumb").show().attr("href","javascript:v_select_region(2,"+a+");");$("#l2_breadcrumb span").html(" &raquo; "+g);$("#geoName").html(g);f=c.l2;$(".geoType").html(f+" in");$("#l0_select").val(current_l0);$("#l0_reports").val(current_l0);$("#l1_select").val(current_l1);$("#l1_reports").val(current_l1);$("#l2_select").val(a);$("#l2_reports").val(a);$("#l3_report, #l4_report, #l5_report").val("");$("#l2, #l3").show();$("#l2_reports, #l3_reports").show();
$("#l4, #l5").hide();$("#l4_report, #l5_report").hide();markersOn();removeFeatures(3);f=resilienceLayer.getFeaturesByAttribute("id",parseInt(a));(f=[])&&$.ajax({url:S3.Ap.concat("/static/cache/2_"+current_l1+".geojson"),async:!1,success:function(b){var b=parser.read(b),c=[],d;for(d in b)try{b[d].id==a&&(b[d].geometry.transform(proj4326,map.getProjectionObject()),c.push(b[d]))}catch(e){}resilienceLayer.addFeatures(c)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;
console.log(msg)},dataType:"json"});hideFeature(a);$.ajax({url:S3.Ap.concat("/static/cache/3_"+a+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});break;case 3:current_l3!=a&&showFeature(current_l3);current_l3=a;current_l2!=d.f&&showFeature(current_l2);
current_l2=d.f;current_l1!=vdata[current_l2].f&&showFeature(current_l1);current_l1=vdata[current_l2].f;current_l0!=vdata[current_l1].f&&showFeature(current_l0);current_l0=vdata[current_l1].f;var c=hdata[current_l0],f=vdata[current_l0].n,e=vdata[current_l1].n,g=vdata[current_l2].n,h=d.n;$("#l4_breadcrumb, #l5_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+f);$("#l1_breadcrumb").show().attr("href",
"javascript:v_select_region(1,"+current_l1+");");$("#l1_breadcrumb span").html(" &raquo; "+e);$("#l2_breadcrumb").show().attr("href","javascript:v_select_region(2,"+current_l2+");");$("#l2_breadcrumb span").html(" &raquo; "+g);$("#l3_breadcrumb").show().attr("href","javascript:v_select_region(3,"+a+");");$("#l3_breadcrumb span").html(" &raquo; "+h);$("#geoName").html(h);f=c.l3;$(".geoType").html(f+" in");$("#l0_select").val(current_l0);$("#l0_reports").val(current_l0);$("#l1_select").val(current_l1);
$("#l1_reports").val(current_l1);$("#l2_select").val(current_l2);$("#l2_reports").val(current_l2);$("#l3_select").val(a);$("#l3_reports").val(a);$("#l4, #l5").val("");$("#l2, #l3, #l4").show();$("#l2_report, #l3_report, #l4_report").show();$("#l5").hide();$("#l5_report").hide();markersOn();removeFeatures(4);f=resilienceLayer.getFeaturesByAttribute("id",parseInt(a));(f=[])&&$.ajax({url:S3.Ap.concat("/static/cache/3_"+current_l2+".geojson"),async:!1,success:function(b){var b=parser.read(b),c=[],d;for(d in b)try{b[d].id==
a&&(b[d].geometry.transform(proj4326,map.getProjectionObject()),c.push(b[d]))}catch(e){}resilienceLayer.addFeatures(c)},error:function(a,b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});hideFeature(a);$.ajax({url:S3.Ap.concat("/static/cache/4_"+a+".geojson"),success:function(a){var a=parser.read(a),b;for(b in a)try{a[b].geometry&&a[b].geometry.transform(proj4326,map.getProjectionObject())}catch(c){}resilienceLayer.addFeatures(a)},error:function(a,
b,c){msg="UNAUTHORIZED"==c?S3.i18n.gis_requires_login:a.responseText;console.log(msg)},dataType:"json"});break;case 4:current_l4=a;current_l3!=d.f&&showFeature(current_l3);current_l3=d.f;current_l2!=vdata[current_l3].f&&showFeature(current_l2);current_l2=vdata[current_l3].f;current_l1!=vdata[current_l2].f&&showFeature(current_l1);current_l1=vdata[current_l2].f;current_l0!=vdata[current_l1].f&&showFeature(current_l0);current_l0=vdata[current_l1].f;current_l4=a;var f=vdata[current_l0].n,e=vdata[current_l1].n,
g=vdata[current_l2].n,h=vdata[current_l3].n,j=d.n;$("#l5_breadcrumb").hide();$("#l0_breadcrumb").show().attr("href","javascript:v_select_region(0,"+current_l0+");");$("#l0_breadcrumb span").html(" &raquo; "+f);$("#l1_breadcrumb").show().attr("href","javascript:v_select_region(1,"+current_l1+");");$("#l1_breadcrumb span").html(" &raquo; "+e);$("#l2_breadcrumb").show().attr("href","javascript:v_select_region(2,"+current_l2+");");$("#l2_breadcrumb span").html(" &raquo; "+g);$("#l3_breadcrumb").show().attr("href",
"javascript:v_select_region(3,"+current_l3+");");$("#l3_breadcrumb span").html(" &raquo; "+h);$("#l4_breadcrumb").show().attr("href","javascript:v_select_region(4,"+a+");");$("#l4_breadcrumb span").html(" &raquo; "+j);$("#geoName").html(j);f=c.l4;$(".geoType").html(f+" in");$("#l0_select").val(current_l0);$("#l0_reports").val(current_l0);$("#l1_select").val(current_l1);$("#l1_reports").val(current_l1);$("#l2_select").val(current_l2);$("#l2_reports").val(current_l2);$("#l3_select").val(current_l3);
$("#l3_reports").val(current_l3);$("#l4_select").val(a);$("#l4_reports").val(a);$("#l5_select").val("");$("#l5_reports").val("");$("#l2, #l3, #l4, #l5").show();$("#l2_report, #l3_report, #l4_report, #l5_report").show();markersOn()}var f=resilienceLayer.getFeaturesByAttribute("id",parseInt(a)),i;for(i in f)try{var k=f[i];if(0!=k.geometry.getArea()){var l=k.geometry.getBounds();map.zoomToExtent(l)}}catch(m){}$(".year").html("2012");k=d.r;null==k?($("#indicator").css("background-color",colors[0]),$("#mainRating").css("background-color",
colors[0])):($("#indicator").html(k),$("#mainRating").html(k),$("#indicator").css("background-color",colors[k]),$("#mainRating").css("background-color",colors[k]));$("#show-hide").html('<span class="arrow">&uarr;</span> SHOW MORE').show();$("#divider").show();$("#analysisLink").show();k=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png");$("#risingTab").css("background-image","url("+k+")").show();k=d.i;for(i in k)a=i,e=k[i],l=e.min,f=e.max,e=e.med,g="#visRange"+a,$(g).css("left",58*l+
"px"),$(g).css("width",58*(f-l)+"px"),$(g+" .medianDot").css("left",58*(e-l)+"px"),e==l?$(g+" .leftBox").hide():$(g+" .leftBox").show(),e==f?$(g+" .rightBox").hide():$(g+" .rightBox").show();$("#qualityCommunes").html(d.c+" out of "+d.t+" "+c.l4+"s Reported");switch(d.q){case "p":$("#poor").addClass("currentQuality");break;case "f":$("#fair").addClass("currentQuality");break;case "m":$("#moderate").addClass("currentQuality");break;case "s":$("#strong").addClass("currentQuality")}$("#populationCount .listText").html(d.p);
$("#populationCount .popupContent p").html(d.s);if(4==b)for(i in d.b)k=d.b[i],$("#dataBreakdown ul").append("            <li>                <p>"+k.n+":</p>                <div class='statistic'>                    <div class='listText'>"+k.v+"</div>                    <div class='popup'>                        <div class='popupContent'>                            <p>Source: "+k.s+"</p>                        </div>                        <div class='popupBottom'></div>                    </div>                </div>            </li>            ");
current_l1?($("#l1_select").html('<option value="" class="none">Choose '+c.l1+"</option>"),$("#l1_reports").html('<option value="" class="none">Choose '+c.l1+"</option>")):($("#l1_select").html('<option value="" selected="selected" class="none">Choose '+c.l1+"</option>"),$("#l1_reports").html('<option value="" selected="selected" class="none">Choose '+c.l1+"</option>"));current_l2?($("#l2_select").html('<option value="" class="none">Choose '+c.l2+"</option>"),$("#l2_reports").html('<option value="" class="none">Choose '+
c.l2+"</option>")):($("#l2_select").html('<option value="" selected="selected" class="none">Choose '+c.l2+"</option>"),$("#l2_reports").html('<option value="" selected="selected" class="none">Choose '+c.l2+"</option>"));current_l3?($("#l3_select").html('<option value="" class="none">Choose '+c.l3+"</option>"),$("#l3_reports").html('<option value="" class="none">Choose '+c.l3+"</option>")):($("#l3_select").html('<option value="" selected="selected" class="none">Choose '+c.l3+"</option>"),$("#l3_reports").html('<option value="" selected="selected" class="none">Choose '+
c.l3+"</option>"));current_l4?($("#l4_select").html('<option value="" class="none">Choose '+c.l4+"</option>"),$("#l4_reports").html('<option value="" class="none">Choose '+c.l4+"</option>")):($("#l4_select").html('<option value="" selected="selected" class="none">Choose '+c.l4+"</option>"),$("#l4_reports").html('<option value="" selected="selected" class="none">Choose '+c.l4+"</option>"));for(i in vdata){switch(vdata[i].r){case 1:res="one";break;case 2:res="two";break;case 3:res="three";break;case 4:res=
"four";break;case 5:res="five";break;default:res="none"}null!=vdata[i].f&&(vdata[i].f==current_l0?($("#l1_select").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>"),$("#l1_reports").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>")):vdata[i].f==current_l1?($("#l2_select").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>"),$("#l2_reports").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>")):vdata[i].f==current_l2?
($("#l3_select").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>"),$("#l3_reports").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>")):vdata[i].f==current_l3&&($("#l4_select").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>"),$("#l4_reports").append('<option value="'+i+'" class="'+res+'">'+vdata[i].n+"</option>")))}$("#l1 label").html(capitalize(c.l1)+":");$("#l2 label").html(capitalize(c.l2)+":");$("#l3 label").html(capitalize(c.l3)+
":");$("#l4 label").html(capitalize(c.l4)+":");$("#l1_report label").html(capitalize(c.l1)+":");$("#l2_report label").html(capitalize(c.l2)+":");$("#l3_report label").html(capitalize(c.l3)+":");$("#l4_report label").html(capitalize(c.l4)+":");updateSelectMenus()},drawerSlide=function(){switch(drawerOpen){case !0:$(".hidden").hide("slow");$("#show-hide").html('<span class="arrow">&uarr;</span> SHOW MORE');var b=S3.Ap.concat("/static/themes/Vulnerability/img/openTabPng8.png");$("#risingTab").css("background-image",
"url("+b+")");$(".olPopup").fadeIn(300);$("#dummy_location_search").autocomplete("option","position",{my:"left bottom",at:"left top"});drawerOpen=!1;break;case !1:$("#drawerInside").show("slow"),$("#drawerInside").data("fade",setTimeout(function(){$("#resilienceSummary, #drawerQuickActions, #indicatorRatingChart, #browseOtherRegions, #dataBreakdown").fadeIn(500);$(".communeOnly").hide()},500)),$("#show-hide").html('<span class="arrow">&darr;</span> SHOW LESS'),b=S3.Ap.concat("/static/themes/Vulnerability/img/closeTabPng8.png"),
$("#risingTab").css("background-image","url("+b+")"),$(".olPopup").fadeOut(300),$("#dummy_location_search").autocomplete("option","position",{my:"left top",at:"left bottom"}),drawerOpen=!0}},setLevel=function(){var b;(b=$("#l5_select").val())?v_select_region(5,b):(b=$("#l4_select").val())?v_select_region(4,b):(b=$("#l3_select").val())?v_select_region(3,b):(b=$("#l2_select").val())?v_select_region(2,b):(b=$("#l1_select").val())?v_select_region(1,b):(b=$("#l0_select").val())&&v_select_region(0,b)},
markersOn=function(){var b=S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOnPng8.png");$("#mapSection").css("background","url("+b+") no-repeat center top transparent");b=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOnPng8.png");$("#volunteerSection").css("background","url("+b+") no-repeat center top transparent");$(".iconSection").css("color","#565656")},markersOff=function(){var b=S3.Ap.concat("/static/themes/Vulnerability/img/mapIconOffPng8.png");$("#mapSection").css("background",
"url("+b+") no-repeat center top transparent");b=S3.Ap.concat("/static/themes/Vulnerability/img/volunteerIconOffPng8.png");$("#volunteerSection").css("background","url("+b+") no-repeat center top transparent");$(".iconSection").css("color","#ccc")};function capitalize(b){for(var a=[],d=0;d<b.length;d++)a.push(b[d].toUpperCase());return a.join("")}S3.dataTables=[];S3.dataTables.id=["report"];
resizeReports=function(){reportsHeight=window.innerHeight-111;activeContentHeight=0;$(".activeContent.contentTable .content").children("tr:visible").each(function(){activeContentHeight+=$(this).innerHeight()});507>reportsHeight&&(reportsHeight=507);activeContentHeight>reportsHeight-180&&(activeContentHeight=reportsHeight-180);$("#lightbox").css("height",$("#vulnerability").innerHeight()+"px");$("#reportsContent, #reportFilters").css("height",reportsHeight+"px");$(".activeContent.contentTable").css("height",
activeContentHeight+"px").css("display","block")};
var rep_section="pending",showReports=function(b){$("#table-container").empty();displayThanks("Loading report details.",null);rep_section=b;$.ajax({type:"GET",url:"report/"}).done(function(a){prepareReport(a)}).fail(function(){alert("error")})},getFilteredReport=function(){var b={},a=-1;"na"!=$("#l4_reports").val()?a=$("#l4_reports").val():"na"!=$("#l3_reports").val()?a=$("#l3_reports").val():"na"!=$("#l2_reports").val()?a=$("#l2_reports").val():"na"!=$("#l1_reports").val()?a=$("#l1_reports").val():
"na"!=$("#l0_reports").val()&&(a=$("#l0_reports").val());b.location_id=a;b.from_date=$("#dateFromReports").val();b.to_date=$("#dateToReports").val();$("#indicatorsCheckbox").is(":checked")&&(b.indicator=!0);$("#mapCheckbox").is(":checked")&&(b.map=!0);$("#imagesCheckbox").is(":checked")&&(b.images=!0);$("#reportsCheckbox").is(":checked")&&(b.reports=!0);$("#demographicsCheckbox").is(":checked")&&(b.demographics=!0);return b},prepareReport=function(b){console.log(b);$("#dateFromReports").datepicker({dateFormat:"yy-mm-dd",
changeYear:!0,changeMonth:!0,maxDate:"+0d",minDate:"-20y"});$("#dateToReports").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,maxDate:"+0d",minDate:"-20y"});$(".rowForApproval").hide();$(".rowForApproval").prev().find(".closeReviewButton").hide();$(".rowForApproval").prev().find(".reviewButton").show();$(".headerRow.activeSection td.arrowCell .arrow").html("&rarr;");$(".headerRow.activeSection").removeClass("activeSection");$("."+rep_section+"Header").addClass("activeSection");$(".headerRow.activeSection .arrow").html("&darr;");
$(".activeContent").hide();$(".activeContent").removeClass("activeContent");$(".activeSection").next().addClass("activeContent");$(".activeSection").parent().next().addClass("activeContent");$(".activeContent").css("display","block");$(".approvalScreen").hide();$("#lightbox, #reportsSection").fadeIn(300);$("#table-container").empty();b?($("#table-container").append(b.report),fnInitDataTable($("#report"),0,!0),formatTable(b),openReportRow("group_011")):$("#numberReports").html("No Entries Found");
resizeReports()},displayReport=function(b){$("#table-container").empty();b?($("#table-container").append(b),fnInitDataTable($("#report"),0,!0),formatTable(b),openReportRow("group_011")):$("#numberReports").html("No Entries Found");resizeReports()};
function openReportRow(b){-1!=shownReport&&hideReportDetails(shownReport);-1==$("."+b).html().indexOf("(0)")?accordionRow(0,"level_1",b):-1==$(".group_011").html().indexOf("(0)")?accordionRow(0,"level_1","group_011"):-1==$(".group_012").html().indexOf("(0)")?accordionRow(0,"level_1","group_012"):accordionRow(0,"level_1","group_013")}
var formatTable=function(){$("#report").addClass("reportsTable");$("#report").addClass("headerTable");$(".group").each(function(){$(this).addClass("headerLabel")});$("#report th");$("#report tr").each(function(){$(this).hasClass("even")&&$(this).addClass("gray");var b=$(this).find("td:first");0==b.length&&(b=$(this).find("th:first"));b.addClass("date");b=b.next();b.addClass("communeName");b=b.next();b.addClass("type");b=b.next();b.addClass("submittedBy");b=b.next();b.addClass("status");b=b.next();
b.addClass("action")});$("#numberReports").html($("#reportCount").val());$(".expandable").click(function(){-1!=shownReport&&hideReportDetails(shownReport);thisAccordionRow(0,this)})},shownReport=-1;function showReportDetails(b){$.getJSON("report/review",{id:b}).done(function(a){displayReportDetails(b,a)}).fail(function(){alert("error")})}function viewReportDetails(b){$.getJSON("report/view",{id:b}).done(function(a){displayReportDetails(b,a)}).fail(function(){alert("error")})}
function hideReportDetails(b){var a=$("#"+b).parent().parent();$("#show"+b).remove();$(a).find(".reviewButton").show();$(a).find(".viewButton").show();$(a).find(".closeReviewButton").hide()}
function displayReportDetails(b,a){var d=$("#"+b).parent().parent(),c=document.createElement("tr"),f=document.createElement("td");-1!=shownReport&&hideReportDetails(shownReport);shownReport=b;f.colSpan=6;f.innerHTML=a;c.appendChild(f);$(c).addClass("showReport");$(c).attr("id","show"+b);$(c).insertAfter(d);$(d).find(".reviewButton").hide();$(d).find(".viewButton").hide();$(d).find(".closeReviewButton").show();$(".approveButton, .declineButton").click(processReportDetails)}
function displayThanks(b,a){$(".approvalScreen .thanks").html(b);$(".approvalScreen").fadeIn(300);$(".approvalScreen .return2reports").hide();a&&($(".approvalScreen").data("approvalTimeout",setTimeout(function(){$(".approvalScreen").fadeOut(300)},a)),$(".approvalScreen .return2reports").show());resizeReports()}
function processReportDetails(){id=this.name.substr(7);$("#table-container").empty();hideReportDetails(id);var b=$("#form"+id).serialize(),a=getFilteredReport();a.id=id;a.report=b;$("#"+id).parent().parent();$(this).hasClass("approveButton")?(displayThanks("Approval request submitted.",null),$.ajax({type:"POST",url:"report/approve",data:a}).done(function(a){$(".approvalScreen").hide();displayThanks("Thank you for your approval.",5E3);displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()})):
(displayThanks("Reject request submitted.",null),$.ajax({type:"POST",url:"report/decline",data:a}).done(function(a){$(".approvalScreen").hide();displayThanks("Thank you, the submission<br />has been declined.",5E3);displayReport(a)}).fail(function(){alert("error");$(".approvalScreen").hide()}))}
var toggleReports=function(b){switch(b){case "myReports":$(".allReports").removeClass("active").html("<a href=\"javascript:toggleReports('allReports')\" title='All Reports'>ALL REPORTS</a>");$(".myReports").addClass("active").html("MY REPORTS");break;case "allReports":$(".myReports").removeClass("active").html("<a href=\"javascript:toggleReports('myReports')\" title='My Reports'>MY REPORTS</a>"),$(".allReports").addClass("active").html("ALL REPORTS")}};

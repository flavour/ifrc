(function(c,q){function k(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function p(){return 0<c(".cap_info_template_form").length}function n(a){return"cap_alert"==a?"sender sent status msg_type source scope restriction addresses codes note reference incidents".split(" "):"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function r(a){function m(d,e){var b=k(a),f=n(b),l,g={};"undefined"==typeof e&&(e=!1);d?"cap_alert"==b?(l=d.$_cap_alert&&d.$_cap_alert[0]||{},g=c.parseJSON(l.template_settings)||{},c(".cap_alert_form").addClass("template_loaded")):"cap_info"==b&&(l=d.$_cap_info&&d.$_cap_info[0]||{},g={}):(l={},g={});c.each(f,function(d,b){try{var f=a.find("[name="+b+"]"),k=g.locked&&g.locked[b];switch(typeof l[b]){case "string":"restriction"==b&&(f.val(l[b]||""),""!=f.val()&&h.show());case "undefined":if(f.is(":text")||
f.is("textarea")||f.is("select"))(e||k)&&f.val(l[b]||""),k?f.prop("disabled",!0).attr("title","This field is locked by the template"):f.prop("disabled",!1).attr("title","");break;case "object":var m=["scope","addresses","codes"];for(d=0;d<m.length;d++)b==m[d]&&f.val(l[b]["@value"]||"");"incidents"==b&&(e||k)&&(f.val(l[b]["@value"]||""),c("select#cap_alert_incidents").multiselect("refresh"))}}catch(n){s3_debug("ERROR",n)}})}function g(a,e,b){if(a){"undefined"==typeof b&&(b="template");var f=new RegExp(".*\\"+
S3.Ap+"\\/"),f=(new String(self.location)).replace(f,"").split("?")[0].split("/")[0];a=[S3.Ap,f,b,a].join("/")+".s3json";c.ajax({url:a,type:"GET",dataType:"json",success:function(a){m(a,e)},error:function(a){alert("There was an unexpected error loading template data")}})}}var h=c("#cap_alert_restriction__row, #cap_alert_restriction__row1"),e=c("#cap_alert_addresses__row, #cap_alert_addresses__row1");"Restricted"==c("#cap_alert_scope").val()?h.show():h.hide();c("#cap_alert_scope").change(function(){switch(c(this).val()){case "Public":h.hide();
c("#cap_alert_restriction").val()&&c("#cap_alert_restriction").val("");e.show();break;case "Restricted":h.show();e.hide();break;case "Private":h.hide(),c("#cap_alert_restriction").val()&&c("#cap_alert_restriction").val(""),e.show()}});c("#cap_info_priority").change(function(){if(c(this).val()){var d=S3.cap_priorities,e=d.length;"Undefined"==c(this).find("option:selected").text()&&(c(this).css("border","2px solid gray"),a.find("[name=urgency]").val(""),a.find("[name=severity]").val(""),a.find("[name=certainty]").val(""));
for(var b=0;b<e;b++)d[b][0]==c(this).find("option:selected").text()&&(a.find("[name=urgency]").val(d[b][1]),a.find("[name=severity]").val(d[b][2]),a.find("[name=certainty]").val(d[b][3]),c(this).css("border","2px solid #"+d[b][4]))}else c(this).css("border","1px solid gray")});a.find("[name=urgency],[name=severity],[name=certainty]").change(function(){for(var d=S3.cap_priorities,e=d.length,b=0;b<e;b++){if(a.find("[name=urgency]").val()==d[b][1]&&a.find("[name=severity]").val()==d[b][2]&&a.find("[name=certainty]").val()==
d[b][3]){c("#cap_info_priority option").each(function(){c(this).text()==d[b][0]?(c(this).prop("selected","selected"),a.find("[name=priority]").css("border","2px solid #"+d[b][4])):(a.find("[name=priority]").val(""),a.find("[name=priority]").css("border","2px solid gray"))});return}a.find("[name=priority]").val("");a.find("[name=priority]").css("border","2px solid gray")}a.find("[name=priority]").val("Undefined").css("border","2px solid gray")});a.find("[name=template_id]").change(function(){g(c(this).val(),
!0)});"cap_alert"!=k(a)||0<c(".cap_template_form").length||g(a.find("[name=template_id]").val());"cap_info"!=k(a)||p()||g(a.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=g}function t(a){function m(){try{return c.parseJSON(a.find("[name=template_settings]").val())||{}}catch(h){return s3_debug("Error occured parsing: ",a.find("[name=template_settings]").val()),{}}}function g(h,e){var d="can_edit-"+h,g=c('<label for="'+d+'">'+(i18n.cap_locked||"Locked")+"</label>"),d=c('<input type="checkbox" name="'+
d+'"/>');d.change(function(){var b=m();b.locked=b.locked||{};b.locked[h]=c(this).is(":checked");a.find("[name=template_settings]").val(q.stringify(b))});var b=m();b.locked&&b.locked[h]&&d.prop("checked","checked");e.append(g);e.append(d)}a.find("[name=is_template]").prop("checked","checked");tablename=k(a);fields=n(tablename);a.find("tr").each(function(){var a=c(this),e=a.attr("id");e&&e.match("__row$")&&(e=e.replace(tablename+"_","").replace("__row",""),a=a.find("td.w2p_fc")||a.find("td").eq(1),
0<=fields.indexOf(e)&&g(e,a))})}window.fields=n;c(document).ready(function(){c("form").each(function(){""!==k(c(this))&&(r(c(this)),(0<c(".cap_template_form").length||p())&&t(c(this)))})})})(jQuery,JSON,void 0);

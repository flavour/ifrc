OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:4,zoomStopHeight:9,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!1,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,
arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];this._addButton("zoomin","zoomin.png",a,{w:18,h:17});centered=this._addZoomBar(a.add(0,17));this._addButton("zoomout","zoomout.png",centered,{w:18,h:18});return this.div},_addButton:function(a,c,b,e){c=
S3.Ap.concat("/static/themes/Vulnerability/img/gis/"+c);b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,b,e,c,"absolute");b.style.cursor="pointer";this.div.appendChild(b);b.action=a;b.className="olButton";this.buttons.push(b);return b},_addZoomBar:function(a){var c=S3.Ap.concat("/static/themes/Vulnerability/img/gis/slider.png"),b=this.id+"_"+this.map.id,e=this.map.getMinZoom(),d=this.map.getNumZoomLevels()-1-this.map.getZoom(),d=OpenLayers.Util.createAlphaImageDiv(b,a.add(-1,d*this.zoomStopHeight),
{w:18,h:10},c,"absolute");d.style.cursor="move";this.slider=d;this.sliderEvents=new OpenLayers.Events(this,d,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var f={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-e)},c=S3.Ap.concat("/static/themes/Vulnerability/img/gis/bar.png"),b=null;OpenLayers.Util.alphaHack()?(b=this.id+
"_"+this.map.id,b=OpenLayers.Util.createAlphaImageDiv(b,a.add(6,0),{w:f.w,h:this.zoomStopHeight},c,"absolute",null,"crop"),b.style.height=f.h+"px"):b=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a.add(6,0),f,c);b.style.cursor="pointer";b.className="olButton";this.zoombarDiv=b;this.div.appendChild(b);this.startTop=parseInt(b.style.top);this.div.appendChild(d);this.map.events.register("zoomend",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-
e))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){switch(a.buttonElement.action){case "zoomin":this.map.zoomIn();break;
case "zoomout":this.map.zoomOut();break;case "zoombarDiv":a=a.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom)a=Math.floor(a);a=this.map.getNumZoomLevels()-1-a;a=Math.min(Math.max(a,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(a)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,
mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var c=this.mouseDragStart.y-a.xy.y,b=OpenLayers.Util.pagePosition(this.zoombarDiv);0<a.clientY-b[1]&&a.clientY-b[1]<parseInt(this.zoombarDiv.style.height)-2&&(this.slider.style.top=parseInt(this.slider.style.top)-c+"px",this.mouseDragStart=a.xy.clone());this.deltaY=
this.zoomStart.y-a.xy.y;OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=this.deltaY/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)):(c+=this.deltaY/this.zoomStopHeight,
c=Math.max(Math.round(c),0));this.map.zoomTo(c);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(a)}},moveZoomBar:function(){this.slider.style.top=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});

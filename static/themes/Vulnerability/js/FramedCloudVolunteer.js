/* Copyright (c) 2006-2012 by OpenLayers Contributors (see authors.txt for 
 * full list of contributors). Published under the 2-clause BSD license.
 * See license.txt in the OpenLayers distribution or repository for the
 * full text of the license. */

/**
 * requires OpenLayers/Popup/Framed.js
 * requires OpenLayers/Popup/FramedCloud.js
 * requires OpenLayers/Util.js
 * requires OpenLayers/BaseTypes/Bounds.js
 * requires OpenLayers/BaseTypes/Pixel.js
 * requires OpenLayers/BaseTypes/Size.js
 */

/**
 * Class: OpenLayers.Popup.FramedCloudVolunteer
 * 
 * Inherits from: 
 *  - <OpenLayers.Popup.FramedCloud>
 */
OpenLayers.Popup.FramedCloudVolunteer = 
  OpenLayers.Class(OpenLayers.Popup.FramedCloud, {

    imageSize: new OpenLayers.Size(12, 12),

    maxSize: new OpenLayers.Size(200, 200),

    fixedRelativePosition: true,

    relativePosition: 'tr',

    positionBlocks: {
        'tr': {
            'offset': new OpenLayers.Pixel(0, 0),
            'padding': new OpenLayers.Bounds(20, 0, 0, 55),
            'blocks': [
                { // stem
                    size: new OpenLayers.Size(12, 12),
                    anchor: new OpenLayers.Bounds(null, 0, 0, null),
                    position: new OpenLayers.Pixel(0, 0)
                }
            ]
        }
    },

    initialize: function(id, lonlat, contentSize, contentHTML, anchor, closeBox, closeBoxCallback) {
        this.imageSrc = S3.Ap.concat('/static/themes/Vulnerability/img/mapPopupStemVolunteer.png');
        OpenLayers.Popup.Framed.prototype.initialize.apply(this, arguments);
        this.contentDiv.className = this.contentDisplayClass;
    },

    addCloseBox: function(callback) {
        this.closeDiv = OpenLayers.Util.createDiv(
            this.id + '_close', null, {w: 17, h: 17}
        );
        this.closeDiv.className = 'olVolPopupCloseBox'; 
        
        // use the content div's css padding to determine if we should
        //  padd the close div
        var contentDivPadding = this.getContentDivPadding();
         
        this.closeDiv.style.right = contentDivPadding.right + 'px';
        this.closeDiv.style.top = contentDivPadding.top + 'px';
        this.groupDiv.appendChild(this.closeDiv);

        var closePopup = callback || function(e) {
            this.hide();
            OpenLayers.Event.stop(e);
        };
        OpenLayers.Event.observe(this.closeDiv, 'touchend', 
                OpenLayers.Function.bindAsEventListener(closePopup, this));
        OpenLayers.Event.observe(this.closeDiv, 'click', 
                OpenLayers.Function.bindAsEventListener(closePopup, this));
    },

    CLASS_NAME: 'OpenLayers.Popup.FramedCloudVolunteer'
});
